<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Machine management</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Machine management</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="deploying-machine-health-checks">Deploying machine health checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure and deploy a machine health check to automatically repair
damaged machines in a machine pool.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Machine health checks is a Technology Preview release only. Technology Preview releases
are not supported with Red Hat production service-level agreements (SLAs) and
might not be functionally complete, and Red Hat does not recommend using them
for production. These features provide early access to upcoming product
features, enabling customers to test functionality and provide feedback during
the development process. For more information see
<a href="https://access.redhat.com/support/offerings/techpreview/">Red Hat Technology
Preview Features Support Scope</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="machine-health-checks-about-deploying-machine-health-checks">About MachineHealthChecks</h3>
<div class="paragraph">
<p>MachineHealthChecks automatically repairs unhealthy Machines in a particular
MachinePool.</p>
</div>
<div class="paragraph">
<p>To monitor machine health, you create a resource to define the
configuration for a controller. You set a condition to check for, such as
staying in the <code>NotReady</code> status for 15 minutes or displaying a permanent condition
in the node-problem-detector, and a label for the set of machines to monitor.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot apply a MachineHealthCheck to a machine with the master role.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The controller that observes a MachineHealthCheck resource checks for the status
that you defined. If a machine fails the health check, it is automatically deleted
and a new one is created to take its place. When a machine is deleted, you
see a <code>machine deleted</code> event. To limit disruptive impact of the machine
deletion, the controller drains and deletes only one node at a time.</p>
</div>
<div class="paragraph">
<p>To stop the check, you remove the resource.</p>
</div>
</div>
<div class="sect2">
<h3 id="machine-health-checks-resource-deploying-machine-health-checks">Sample MachineHealthCheck resource</h3>
<div class="paragraph">
<p>The MachineHealthCheck resource resembles the following YAML file:</p>
</div>
<div class="listingblock">
<div class="title">MachineHealthCheck</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: healthchecking.openshift.io/v1alpha1
kind: MachineHealthCheck
metadata:
 name: example <b class="conum">(1)</b>
 namespace: openshift-machine-api
Spec:
  Selector:
    matchLabels:
      sigs.k8s.io/cluster-api-cluster: &lt;cluster_name&gt; <b class="conum">(2)</b>
      sigs.k8s.io/cluster-api-machine-role: &lt;label&gt; <b class="conum">(3)</b>
      sigs.k8s.io/cluster-api-machine-type: &lt;label&gt; <b class="conum">(3)</b>
      sigs.k8s.io/cluster-api-machineset: &lt;cluster_name&gt;-&lt;label&gt;-&lt;AWS-zone&gt; <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specify the name of the MachineHealthCheck to deploy. Include the name of the
MachinePool to track.</p>
</li>
<li>
<p>Specify the name of your cluster.</p>
</li>
<li>
<p>Specify a label for the MachinePool that you want to check.</p>
</li>
<li>
<p>Specify the MachineSet to track in <code>&lt;cluster_name&gt;-&lt;label&gt;-&lt;AWS-zone&gt;</code>
format. For example, <code>prod-node-us-east-1a</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="machine-health-checks-creating-deploying-machine-health-checks">Creating a MachineHealthCheck resource</h3>
<div class="paragraph">
<p>You can create a MachineHealthCheck resource for all MachinePools in your
cluster except the <code>master</code> pool.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install the <code>oc</code> command line interface.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>healthcheck.yml</code> file that contains the definition of your
MachineHealthCheck.</p>
</li>
<li>
<p>Apply the <code>healthcheck.yml</code> file to your cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc apply -f healthcheck.yml</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="applying-autoscaling-to-a-cluster">Applying autoscaling to an OpenShift Enterprise cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Applying autoscaling to an OpenShift Enterprise cluster involves deploying a
ClusterAutoscaler and then deploying MachineAutoscalers for each Machine type
in your cluster.</p>
</div>
<div class="sect2">
<h3 id="cluster-autoscaler-about-applying-autoscaling">About the ClusterAutoscaler</h3>
<div class="paragraph">
<p>The ClusterAutoscaler adjusts the size of an OpenShift Enterprise cluster to meet
its current deployment needs. It uses declarative, Kubernetes-style arguments to
provide infrastructure management that does not rely on objects of a specific
cloud provider. The ClusterAutoscaler has a cluster scope, and is not associated
with a particular namespace.</p>
</div>
<div class="paragraph">
<p>The ClusterAutoscaler increases the size of the cluster when there are pods
that failed to schedule on any of the current nodes due to insufficient
resources or when another node is necessary to meet deployment needs. The
ClusterAutoscaler does not increase the cluster resources beyond the limits
that you specify.</p>
</div>
<div class="paragraph">
<p>The ClusterAutoscaler decreases the size of the cluster when some nodes are
consistently not needed for a significant period, such as when it has low
resource use and all of its important pods can fit on other nodes.</p>
</div>
<div class="paragraph">
<p>If the following types of pods are present on a node, the ClusterAutoscaler
will not remove the node:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pods with restrictive PodDisruptionBudgets (PDBs).</p>
</li>
<li>
<p>Kube-system pods that do not run on the node by default.</p>
</li>
<li>
<p>Kube-system pods that do not have a PDBB or have a PDB that is too restrictive.</p>
</li>
<li>
<p>Pods that are not backed by a controller object such as a Deployment,
ReplicaSet, or StatefulSet.</p>
</li>
<li>
<p>Pods with local storage.</p>
</li>
<li>
<p>Pods that cannot be moved elsewhere because of a lack of resources,
incompatible node selectors or affinity, matching anti-affinity, and so on.</p>
</li>
<li>
<p>Unless they also have a <code>"cluster-autoscaler.kubernetes.io/safe-to-evict": "true"</code>
annotation, pods that have a <code>"cluster-autoscaler.kubernetes.io/safe-to-evict": "false"</code>
annotation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you configure the ClusterAutoscaler, additional usage restrictions apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Do not modify the nodes that are in autoscaled node groups directly. All nodes
within the same node group have the same capacity and labels and run the same
system pods.</p>
</li>
<li>
<p>Specify requests for your pods.</p>
</li>
<li>
<p>If you need to prevent pods from being deleted too quickly, configure
appropriate PDBs.</p>
</li>
<li>
<p>Confirm that your cloud provider quota is large enough to support the
maximum node pools that you configure.</p>
</li>
<li>
<p>Do not run additional node group autoscalers, especially the ones offered by
your cloud provider.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Horizontal Pod Autoscaler (HPA) and the ClusterAutoscaler modify cluster
resources in different ways. The HPA changes the deployment&#8217;s or ReplicaSet&#8217;s
number of replicas based on the current CPU load.
If the load increases, the HPA creates new replicas, regardless of the amount
of resources available to the cluster.
If there are not enough resources, the ClusterAutoscaler adds resources so that
the HPA-created pods can run.
If the load decreases, the HPA stops some replicas. If this action causes some
nodes to be underutilized or completely empty, the ClusterAutoscaler deletes
the unnecessary nodes.</p>
</div>
<div class="paragraph">
<p>The ClusterAutoscaler takes pod priorities into account. The Pod Priority and
Preemption feature enables scheduling pods based on priorities if the cluster
does not have enough resources, but the ClusterAutoscaler ensures that the
cluster has resources to run all pods. To honor the intention of both features,
the ClusterAutoscaler inclues a priority cutoff. You can use this cutoff to
schedule "best-effort" pods, which do not cause the ClusterAutoscaler to
increase resources but instead run only when spare resources are available.</p>
</div>
<div class="paragraph">
<p>Pods with priority lower than the cutoff value do not cause the cluster to scale
up or prevent the cluster from scaling down. No new nodes are added to run the
pods, and nodes running these pods might be deleted to free resources.</p>
</div>
</div>
<div class="sect2">
<h3 id="machine-autoscaler-about-applying-autoscaling">About the MachineAutoscaler</h3>
<div class="paragraph">
<p>The MachineAutoscaler adjusts the number of Machines in the MachineSets that you
deploy in an OpenShift Enterprise cluster. You can scale both the default <code>worker</code>
MachineSet and any other MachineSets that you create. The MachineAutoscaler
makes more Machines when the cluster runs out of resources to support more
deployments.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-clusterautoscaler">Configuring the ClusterAutoscaler</h3>
<div class="paragraph">
<p>First, deploy the ClusterAutoscaler to manage automatic resource scaling in
your OpenShift Enterprise cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Because the ClusterAutoscaler is scoped to the entire cluster, you can make only
one ClusterAutoscaler for the cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="cluster-autoscaler-cr-applying-autoscaling">ClusterAutoscaler resource definition</h4>
<div class="paragraph">
<p>This <code>ClusterAutoscaler</code> resource definition shows the parameters and sample
values for the ClusterAutoscaler.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: "autoscaling.openshift.io/v1alpha1"
kind: "ClusterAutoscaler"
metadata:
  name: "default"
spec:
  podPriorityThreshold: -10 <b class="conum">(1)</b>
  resourceLimits:
    maxNodesTotal: 24 <b class="conum">(2)</b>
    cores:
      min: 8 <b class="conum">(3)</b>
      max: 128 <b class="conum">(4)</b>
    memory:
      min: 4 <b class="conum">(5)</b>
      max: 256 <b class="conum">(6)</b>
    gpus:
      - type: nvidia.com/gpu <b class="conum">(7)</b>
        min: 0 <b class="conum">(8)</b>
        max: 16 <b class="conum">(9)</b>
      - type: amd.com/gpu <b class="conum">(7)</b>
        min: 0 <b class="conum">(8)</b>
        max: 4 <b class="conum">(9)</b>
  scaleDown:
    enabled: true <b class="conum">(10)</b>
    delayAfterAdd: 10s <b class="conum">(11)</b>
    delayAfterDelete: 10s <b class="conum">(12)</b>
    delayAfterFailure: 10s <b class="conum">(13)</b>
    unneededTime: 10s <b class="conum">(14)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specify the priority that a pod must exceed to cause the ClusterAutoscaler
to deploy additional nodes. Enter a 32-bit integer value. The
<code>podPriorityThreshold</code> value is compared to the value of the <code>PriorityClass</code> that
you assign to each pod.</p>
</li>
<li>
<p>Specify the maximum number of nodes to deploy.</p>
</li>
<li>
<p>Specify the minimum number of cores to deploy.</p>
</li>
<li>
<p>Specify the maximum number of cores to deploy.</p>
</li>
<li>
<p>Specify the minimum amount of memory, in GiB, per node.</p>
</li>
<li>
<p>Specify the maximum amount of memory, in GiB, per node.</p>
</li>
<li>
<p>Specify the type of GPU node to deploy. Only <code>nvidia.com/gpu</code> and <code>amd.com/gpu</code>
are valid types.</p>
</li>
<li>
<p>Specify the minimum number of GPU cores to deploy.</p>
</li>
<li>
<p>Specify the maxiumum number of GPU cores to deploy.</p>
</li>
<li>
<p>Specify whether the ClusterAutoscaler can remove unnecessary nodes.</p>
</li>
<li>
<p>Specify the period, in seconds, to wait before deploying another node.</p>
</li>
<li>
<p>Specify the period, in seconds, to wait before deleting another node.</p>
</li>
<li>
<p>Specify the period, in seconds, to wait to deploy another node if the
current deployment fails.</p>
</li>
<li>
<p>Specify the period, in seconds, before an unnecessary node is deleted.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="ClusterAutoscaler-deploying-applying-autoscaling">Deploying the ClusterAutoscaler</h4>
<div class="paragraph">
<p>To deploy the ClusterAutoscaler, you create an instance of the <code>ClusterAutoscaler</code>
resource.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a YAML file for the <code>ClusterAutoscaler</code> resource that contains the
customized resource definition.</p>
</li>
<li>
<p>Create the resource in the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create -f &lt;filename&gt;.yaml <b class="conum">(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>&lt;filename&gt;</code> is the name of the resource file that you customized.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-machineautoscaler">Configuring the MachineAutoscalers</h3>
<div class="paragraph">
<p>After you deploy the ClusterAutoscaler, you can
deploy MachineAutoscaler resources for each of the machine types in your
cluster to manage deployments of individual machines.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You must configure separate resources for each MachineSet. Remember that
MachineSets are different in each AWS region, so consider whether you want to
enable machine scaling in multiple regions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="machine-autoscaler-cr-applying-autoscaling">MachineAutoscaler resource definition</h4>
<div class="paragraph">
<p>This MachineAutoscaler resource definition shows the parameters and sample
values for the MachineAutoscaler.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: "autoscaling.openshift.io/v1alpha1"
kind: "MachineAutoscaler"
metadata:
  name: "worker" <b class="conum">(1)</b>
  namespace: "openshift-machine-api"
spec:
  minReplicas: 1 <b class="conum">(2)</b>
  maxReplicas: 12 <b class="conum">(3)</b>
  scaleTargetRef: <b class="conum">(4)</b>
    apiVersion: machine.openshift.io/v1beta1
    kind: MachineSet
    name: worker</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specify the <code>MachineAutoscaler</code> name. To make it easier to identify
which MachineSet this MachineAutoscaler scales, specify or include the name of
the MachineSet to scale. The MachineSet name takes the following form:
<code>&lt;clusterid&gt;-&lt;machineset&gt;-&lt;aws-region-az&gt;</code></p>
</li>
<li>
<p>Specify the minimum number Machines of the specified type to deploy in the
specified AWS zone.</p>
</li>
<li>
<p>Specify the maxiumum number Machines of the specified type to deploy in the
specified AWS zone.</p>
</li>
<li>
<p>In this section, provide values that describe the existing MachineSet to
scale. The <code>kind</code> parameter value is always <code>MachineSet</code>, and the <code>name</code> value
must match the name of an existing MachineSet.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="MachineAutoscaler-deploying-applying-autoscaling">Deploying the MachineAutoscaler</h4>
<div class="paragraph">
<p>To deploy the MachineAutoscaler, you create an instance of the <code>MachineAutoscaler</code>
resource.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a YAML file for the <code>MachineAutoscaler</code> resource that contains the
customized resource definition.</p>
</li>
<li>
<p>Create the resource in the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create -f &lt;filename&gt;.yaml <b class="conum">(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>&lt;filename&gt;</code> is the name of the resource file that you customized.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_additional-resources">Additional resources</h3>
<div class="ulist">
<ul>
<li>
<p>For more information about pod priority, see
<a href="https://access.redhat.com/documentation/en-us/openshift_enterprise/4.0/html-single/nodes/#nodes-pods-priority">Including pod priority in pod scheduling decisions in OpenShift Enterprise</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="manually-scaling-a-machineset">Manually scaling a MachineSet</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="machineset-manually-scaling-manually-scaling-machineset">Scaling a MachineSet manually</h3>
<div class="paragraph">
<p>If you need to add or remove an instance of a machine in a MachineSet, you can
manually scale the MachineSet.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install an OpenShift Enterprise cluster and the <code>oc</code> command line.</p>
</li>
<li>
<p>Log into <code>oc</code> as a user with &lt;some permission&gt;.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>View the MachineSets that are in the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get machinesets -n openshift-machine-api</pre>
</div>
</div>
<div class="paragraph">
<p>The MachineSets are listed in the form of <code>&lt;clusterid&gt;-worker-&lt;aws-region-az&gt;</code>.</p>
</div>
</li>
<li>
<p>Scale the MachineSet:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc scale --replicas=2 machineset &lt;machineset&gt; -n openshift-machine-api</pre>
</div>
</div>
<div class="paragraph">
<p>Or:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc edit &lt;machineset&gt; -n openshift-machine-api</pre>
</div>
</div>
<div class="paragraph">
<p>You can scale the MachineSet up or down. It takes several minutes for the new
machines to be available.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, the OpenShift Enterprise router pods are deployed on workers.
Because the router is required to access some cluster resources, including the
web console, do not scale the worker MachineSet to <code>0</code> unless you first relocate
the router pods.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-machineset">Creating a MachineSet</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="machineset-creating-creating-machineset">Creating a MachineSet</h3>
<div class="paragraph">
<p>You can create more MachineSets. Because the MachineSet definition contains
details that are specific to the AWS region that the cluster is deployed in,
you copy an existing MachineSet from your cluster and modify it.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Deploy an OpenShift Enterprise cluster.</p>
</li>
<li>
<p>Install the <code>oc</code> command line and log in as a user with &lt;some permissions&gt;.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>View the current MachineSets.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get machinesets -n openshift-machine-api

NAME                         DESIRED   CURRENT   READY     AVAILABLE   AGE
190125-3-worker-us-west-1b   2         2         2         2           3h
190125-3-worker-us-west-1c   1         1         1         1           3</pre>
</div>
</div>
</li>
<li>
<p>Export the source of a MachineSet to a text file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get machineset &lt;machineset_name&gt; -n \
     openshift-machine-api -o yaml &gt; &lt;file_name&gt;.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>In this command, <code>&lt;machineset_name&gt;</code> is the name of the current MachineSet that
is in the AWS region you want to place your new MachineSet in, such
as <code>190125-3-worker-us-west-1c</code>, and <code>&lt;file_name&gt;</code> is the name of your new
MachineSet definition.</p>
</div>
</li>
<li>
<p>Update the <code>metadata</code> section of <code>&lt;file_name&gt;.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">metadata:
  creationTimestamp: 2019-02-15T16:32:56Z <b class="conum">(1)</b>
  generation: 1 <b class="conum">(1)</b>
  labels:
    sigs.k8s.io/cluster-api-cluster: &lt;cluster_name&gt; <b class="conum">(2)</b>
    sigs.k8s.io/cluster-api-machine-role: &lt;machine_label&gt; <b class="conum">(3)</b>
    sigs.k8s.io/cluster-api-machine-type: &lt;machine_label&gt; <b class="conum">(3)</b>
  name: &lt;cluster_name&gt;-&lt;machine_label&gt;-&lt;AWS-availability-zone&gt; <b class="conum">(3)</b> <b class="conum">(4)</b>
  namespace: openshift-machine-api
  resourceVersion: "9249" <b class="conum">(1)</b>
  selfLink: /apis/cluster.k8s.io/v1alpha1/namespaces/openshift-machine-api/machinesets/&lt;cluster_name&gt;-&lt;machine_label&gt;-&lt;AWS-availability-zone&gt; <b class="conum">(1)</b>
  uid: 59ba0425-313f-11e9-861e-0a18047f0a28 <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Remove this line.</p>
</li>
<li>
<p>Do not change the <code>&lt;cluster_name&gt;</code>.</p>
</li>
<li>
<p>For each <code>&lt;machine_label&gt;</code> instance, specify the name of the new MachineSet.</p>
</li>
<li>
<p>Ensure that the AWS availability zone is correct in each instance of the
<code>&lt;AWS-availability-zone&gt;</code> parameter.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>metadata</code> section resembles the following YAML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">metadata:
  labels:
    sigs.k8s.io/cluster-api-cluster: &lt;cluster_name&gt;
    sigs.k8s.io/cluster-api-machine-role: &lt;new_machine_label&gt;
    sigs.k8s.io/cluster-api-machine-type: &lt;new_machine_label&gt;
  name: &lt;cluster_name&gt;-&lt;new_machine_label&gt;-&lt;AWS-availability-zone&gt;
  namespace: openshift-machine-api</code></pre>
</div>
</div>
</li>
<li>
<p>In <code>&lt;file_name&gt;.yaml</code>, delete the <code>status</code> stanza:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">status:
  availableReplicas: 1
  fullyLabeledReplicas: 1
  observedGeneration: 1
  readyReplicas: 1
  replicas: 1</code></pre>
</div>
</div>
</li>
<li>
<p>In <code>&lt;file_name&gt;.yaml</code>, update both instances of the <code>sigs.k8s.io/cluster-api-machineset</code> parameter
values in the <code>spec</code> section to match the <code>name</code> that you defined in the <code>metadata</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">spec:
  replicas: 1
  selector:
    matchLabels:
      sigs.k8s.io/cluster-api-cluster: cluster_name
      sigs.k8s.io/cluster-api-machineset: &lt;cluster_name&gt;-&lt;machine_label&gt;-&lt;AWS-availability-zone&gt; <b class="conum">(1)</b>
  template:
    metadata:
      creationTimestamp: null
      labels:
        sigs.k8s.io/cluster-api-cluster: &lt;cluster_name&gt;
        sigs.k8s.io/cluster-api-machine-role: &lt;machine_label&gt;
        sigs.k8s.io/cluster-api-machine-type: &lt;machine_label&gt;
        sigs.k8s.io/cluster-api-machineset: &lt;cluster_name&gt;-&lt;machine_label&gt;-&lt;AWS-availability-zone&gt; <b class="conum">(1)</b>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Ensure that both the <code>sigs.k8s.io/cluster-api-machineset</code> parameter values
match the <code>name</code> that you defined in the <code>metadata</code> section.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In <code>&lt;file_name&gt;.yaml</code>, add the node label definition to the spec. The label
definition resembles the following stanza:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">  spec:
    metadata:
      labels:
        node-role.kubernetes.io/&lt;label_name&gt;: "" <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>In this definition, <code>&lt;label_name&gt;</code> is the node label to add. For example, to
add the <code>infra</code> label to the nodes, specify <code>node-role.kubernetes.io/infra</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The updated <code>spec</code> section resembles this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">spec:
  replicas: 1
  selector:
    matchLabels:
      sigs.k8s.io/cluster-api-cluster: cluster_name
      sigs.k8s.io/cluster-api-machineset: &lt;cluster_name&gt;-&lt;machine_label&gt;-&lt;AWS-availability-zone&gt;
  template:
    metadata:
      creationTimestamp: null
      labels:
        sigs.k8s.io/cluster-api-cluster: &lt;cluster_name&gt;
        sigs.k8s.io/cluster-api-machine-role: &lt;machine_label&gt;
        sigs.k8s.io/cluster-api-machine-type: &lt;machine_label&gt;
        sigs.k8s.io/cluster-api-machineset: &lt;cluster_name&gt;-&lt;machine_label&gt;-&lt;AWS-availability-zone&gt;
    spec: <b class="conum">(1)</b>
      metadata:
        labels:
          node-role.kubernetes.io/&lt;label_name&gt;: ""
...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Place the <code>spec</code> stanza here.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Optionally, modify the EC2 instance type and modify the storage volumes.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Take care to modify only the parameters that describe the EC2 instance type
and storage volumes. You must not change the other parameters value in the
<code>providerSpec</code> section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">providerSpec:
  value:
    ami:
      id: ami-0e2bcd33dfff9c73e <b class="conum">(1)</b>
    apiVersion: awsproviderconfig.k8s.io/v1alpha1
    blockDevices: <b class="conum">(2)</b>
    - ebs:
        iops: 0
        volumeSize: 120
        volumeType: gp2
    deviceIndex: 0
    iamInstanceProfile: <b class="conum">(3)</b>
      id: &lt;cluster_name&gt;-&lt;machine_label&gt;-profile
    instanceType: m4.large <b class="conum">(4)</b>
    kind: AWSMachineProviderConfig
    metadata:
      creationTimestamp: null
    placement: <b class="conum">(3)</b>
      availabilityZone: &lt;AWS-availability-zone&gt;
      region: &lt;AWS-region&gt;
    publicIp: null
    securityGroups:
    - filters:
      - name: tag:Name
        values:
        - testcluster2_worker_sg
    subnet: <b class="conum">(3)</b>
      filters:
      - name: tag:Name
        values:
        - &lt;cluster_name&gt;-&lt;machine_label&gt;-&lt;AWS-availability-zone&gt;
    tags:
    - name: openshiftClusterID
      value: 5a21bfc0-1c56-4400-81bb-7fd66644f871
    - name: kubernetes.io/cluster/&lt;cluster_name&gt;
      value: owned
    userDataSecret: <b class="conum">(3)</b>
      name: &lt;machine_label&gt;-user-data</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>You can specify a different valid AMI.</p>
</li>
<li>
<p>You can customize the volume characteristics for the MachineSet. See the AWS
documentation.</p>
</li>
<li>
<p>Do not modify this section.</p>
</li>
<li>
<p>Specify a valid <code>instanceType</code> for the AMI that you specified.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create the new <code>MachineSet</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create -f &lt;file_name&gt;.yaml</pre>
</div>
</div>
</li>
<li>
<p>View the list of MachineSets:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get machineset -n openshift-machine-api


NAME                         DESIRED   CURRENT   READY     AVAILABLE   AGE
190125-3-worker-us-west-1b   2         2         2         2           4h
190125-3-worker-us-west-1c   1         1         1         1           4h
infrastructure-us-west-1b    1         1                               4s</pre>
</div>
</div>
<div class="paragraph">
<p>When the new MachineSet is available, the <code>DESIRED</code> and <code>CURRENT</code> values match.
If the MachineSet is not available, wait a few minutes and run the command again.</p>
</div>
</li>
<li>
<p>After the new MachineSet is available, check the machine status:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get machine -n openshift-machine-api</pre>
</div>
</div>
</li>
<li>
<p>View the new node:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get node</pre>
</div>
</div>
<div class="paragraph">
<p>The new node is the one with the lowest <code>AGE</code>.  ip-10-0-128-138.us-west-1.compute.internal</p>
</div>
</li>
<li>
<p>Confirm that the new node has the label that you specified:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get node &lt;node_name&gt; --show-labels</pre>
</div>
</div>
<div class="paragraph">
<p>Review the command output and confirm that <code>node-role.kubernetes.io/&lt;your_label&gt;</code>
is in the <code>LABELS</code> list.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Next steps</div>
<p>If you need MachineSets in other availability zones, repeat this
process to create more MachineSets.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-infrastructure-machinesets">Creating infrastructure MachineSets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can create a MachineSet to host only infrastructure components.
You apply specific Kubernetes labels to these Machines and then
update the infrastructure components to run on only those Machines.These
infrastructure nodes are not counted toward the total number of subscriptions
that are required to run the environment.</p>
</div>
<div class="sect2">
<h3 id="infrastructure-components-creating-infrastructure-machinesets">OpenShift Enterprise infrastructure components</h3>
<div class="paragraph">
<p>The following OpenShift Enterprise components are infrastructure components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kubernetes and OpenShift Enterprise control plane services that run on masters</p>
</li>
<li>
<p>The default router</p>
</li>
<li>
<p>The container image registry</p>
</li>
<li>
<p>The cluster metrics collection, or monitoring service</p>
</li>
<li>
<p>Cluster aggregated logging</p>
</li>
<li>
<p>Service brokers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any node that runs any other container, pod, or component is a worker node that
your subscription must cover.</p>
</div>
</div>
<div class="sect2">
<h3 id="machine-api-overview-creating-infrastructure-machinesets">Machine API overview</h3>
<div class="paragraph">
<p>The Machine API is a combination of primary resources that are based on the
upstream Cluster API project and custom OpenShift Enterprise resources.</p>
</div>
<div class="paragraph">
<p>The two primary resources are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Machines</code></dt>
<dd>
<p>A fundamental unit that describes a <code>Node</code>. A <code>machine</code> has a
providerSpec, which describes the types of compute nodes that are offered for different
cloud platforms. For example, a <code>machine</code> type for a worker node on Amazon Web
Services (AWS) might define a specific machine type and required metadata.</p>
</dd>
<dt class="hdlist1"><code>MachineSets</code></dt>
<dd>
<p>Groups of machines. <code>MachineSets</code> are to <code>machines</code> as
<code>ReplicaSets</code> are to <code>Pods</code>. If you need more <code>machines</code> or need to scale them down,
you change the <strong>replicas</strong> field on the <code>MachineSet</code> to meet your compute need.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following custom resources add more capabilities to your cluster:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>MachineAutoscaler</code></dt>
<dd>
<p>This resource automatically scales <code>machines</code> in
a cloud. You can set the minimum and maximum scaling boundaries for nodes in a
specified <code>MachineSet</code>, and the <code>MachineAutoscaler</code> maintains that range of nodes.
The <code>MachineAutoscaler</code> object takes effect after a <code>ClusterAutoscaler</code> object
exists. Both <code>ClusterAutoscaler</code> and <code>MachineAutoscaler</code> resources are made
available by the <code>ClusterAutoscalerOperator</code>.</p>
</dd>
<dt class="hdlist1"><code>ClusterAutoscaler</code></dt>
<dd>
<p>This resource is based on the upstream ClusterAutoscaler
project. In the OpenShift Enterprise implementation, it is integrated with the
Cluster API by extending the <code>MachineSet</code> API. You can set cluster-wide
scaling limits for resources such as cores, nodes, memory, GPU,
and so on. You can set the priority so that the cluster prioritizes pods so that
new nodes are not brought online for less important pods. You can also set the
ScalingPolicy so you can scale up nodes but not scale them down.</p>
</dd>
<dt class="hdlist1"><code>MachineHealthCheck</code></dt>
<dd>
<p>This resource detects when a machine is unhealthy,
deletes it, and, on supported platforms, makes a new machine.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In OpenShift Enterprise version 3.11, you could not roll out a multi-zone
architecture easily because the cluster did not manage machine provisioning.
Beginning with 4.1 this process is easier. Each <code>MachineSet</code> is scoped to a
single zone, so the installation program sends out <code>MachineSets</code> across
availability zones on your behalf. And then because your compute is dynamic, and
in the face of a zone failure, you always have a zone for when you need to
rebalance your machines. The autoscaler provides best-effort balancing over the
life of a cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-infrastructure-machinesets-production">Creating infrastructure MachineSets for production environments</h3>
<div class="paragraph">
<p>In a production deployment, deploy at least three MachineSets to hold
infrastructure components. Both the logging aggregation solution and
the service mesh deploy ElasticSearch, and ElasticSearch requires three
instances that are installed on different nodes. For high availability, install
deploy these nodes to different availability zones. Since you need different
MachineSets for each availability zone, create at least three MachineSets.</p>
</div>
<div class="sect3">
<h4 id="machineset-creating-creating-infrastructure-machinesets">Creating a MachineSet</h4>
<div class="paragraph">
<p>You can create more MachineSets. Because the MachineSet definition contains
details that are specific to the AWS region that the cluster is deployed in,
you copy an existing MachineSet from your cluster and modify it.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Deploy an OpenShift Enterprise cluster.</p>
</li>
<li>
<p>Install the <code>oc</code> command line and log in as a user with &lt;some permissions&gt;.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>View the current MachineSets.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get machinesets -n openshift-machine-api

NAME                         DESIRED   CURRENT   READY     AVAILABLE   AGE
190125-3-worker-us-west-1b   2         2         2         2           3h
190125-3-worker-us-west-1c   1         1         1         1           3</pre>
</div>
</div>
</li>
<li>
<p>Export the source of a MachineSet to a text file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get machineset &lt;machineset_name&gt; -n \
     openshift-machine-api -o yaml &gt; &lt;file_name&gt;.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>In this command, <code>&lt;machineset_name&gt;</code> is the name of the current MachineSet that
is in the AWS region you want to place your new MachineSet in, such
as <code>190125-3-worker-us-west-1c</code>, and <code>&lt;file_name&gt;</code> is the name of your new
MachineSet definition.</p>
</div>
</li>
<li>
<p>Update the <code>metadata</code> section of <code>&lt;file_name&gt;.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">metadata:
  creationTimestamp: 2019-02-15T16:32:56Z <b class="conum">(1)</b>
  generation: 1 <b class="conum">(1)</b>
  labels:
    sigs.k8s.io/cluster-api-cluster: &lt;cluster_name&gt; <b class="conum">(2)</b>
    sigs.k8s.io/cluster-api-machine-role: &lt;machine_label&gt; <b class="conum">(3)</b>
    sigs.k8s.io/cluster-api-machine-type: &lt;machine_label&gt; <b class="conum">(3)</b>
  name: &lt;cluster_name&gt;-&lt;machine_label&gt;-&lt;AWS-availability-zone&gt; <b class="conum">(3)</b> <b class="conum">(4)</b>
  namespace: openshift-machine-api
  resourceVersion: "9249" <b class="conum">(1)</b>
  selfLink: /apis/cluster.k8s.io/v1alpha1/namespaces/openshift-machine-api/machinesets/&lt;cluster_name&gt;-&lt;machine_label&gt;-&lt;AWS-availability-zone&gt; <b class="conum">(1)</b>
  uid: 59ba0425-313f-11e9-861e-0a18047f0a28 <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Remove this line.</p>
</li>
<li>
<p>Do not change the <code>&lt;cluster_name&gt;</code>.</p>
</li>
<li>
<p>For each <code>&lt;machine_label&gt;</code> instance, specify the name of the new MachineSet.</p>
</li>
<li>
<p>Ensure that the AWS availability zone is correct in each instance of the
<code>&lt;AWS-availability-zone&gt;</code> parameter.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>metadata</code> section resembles the following YAML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">metadata:
  labels:
    sigs.k8s.io/cluster-api-cluster: &lt;cluster_name&gt;
    sigs.k8s.io/cluster-api-machine-role: &lt;new_machine_label&gt;
    sigs.k8s.io/cluster-api-machine-type: &lt;new_machine_label&gt;
  name: &lt;cluster_name&gt;-&lt;new_machine_label&gt;-&lt;AWS-availability-zone&gt;
  namespace: openshift-machine-api</code></pre>
</div>
</div>
</li>
<li>
<p>In <code>&lt;file_name&gt;.yaml</code>, delete the <code>status</code> stanza:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">status:
  availableReplicas: 1
  fullyLabeledReplicas: 1
  observedGeneration: 1
  readyReplicas: 1
  replicas: 1</code></pre>
</div>
</div>
</li>
<li>
<p>In <code>&lt;file_name&gt;.yaml</code>, update both instances of the <code>sigs.k8s.io/cluster-api-machineset</code> parameter
values in the <code>spec</code> section to match the <code>name</code> that you defined in the <code>metadata</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">spec:
  replicas: 1
  selector:
    matchLabels:
      sigs.k8s.io/cluster-api-cluster: cluster_name
      sigs.k8s.io/cluster-api-machineset: &lt;cluster_name&gt;-&lt;machine_label&gt;-&lt;AWS-availability-zone&gt; <b class="conum">(1)</b>
  template:
    metadata:
      creationTimestamp: null
      labels:
        sigs.k8s.io/cluster-api-cluster: &lt;cluster_name&gt;
        sigs.k8s.io/cluster-api-machine-role: &lt;machine_label&gt;
        sigs.k8s.io/cluster-api-machine-type: &lt;machine_label&gt;
        sigs.k8s.io/cluster-api-machineset: &lt;cluster_name&gt;-&lt;machine_label&gt;-&lt;AWS-availability-zone&gt; <b class="conum">(1)</b>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Ensure that both the <code>sigs.k8s.io/cluster-api-machineset</code> parameter values
match the <code>name</code> that you defined in the <code>metadata</code> section.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In <code>&lt;file_name&gt;.yaml</code>, add the node label definition to the spec. The label
definition resembles the following stanza:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">  spec:
    metadata:
      labels:
        node-role.kubernetes.io/&lt;label_name&gt;: "" <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>In this definition, <code>&lt;label_name&gt;</code> is the node label to add. For example, to
add the <code>infra</code> label to the nodes, specify <code>node-role.kubernetes.io/infra</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The updated <code>spec</code> section resembles this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">spec:
  replicas: 1
  selector:
    matchLabels:
      sigs.k8s.io/cluster-api-cluster: cluster_name
      sigs.k8s.io/cluster-api-machineset: &lt;cluster_name&gt;-&lt;machine_label&gt;-&lt;AWS-availability-zone&gt;
  template:
    metadata:
      creationTimestamp: null
      labels:
        sigs.k8s.io/cluster-api-cluster: &lt;cluster_name&gt;
        sigs.k8s.io/cluster-api-machine-role: &lt;machine_label&gt;
        sigs.k8s.io/cluster-api-machine-type: &lt;machine_label&gt;
        sigs.k8s.io/cluster-api-machineset: &lt;cluster_name&gt;-&lt;machine_label&gt;-&lt;AWS-availability-zone&gt;
    spec: <b class="conum">(1)</b>
      metadata:
        labels:
          node-role.kubernetes.io/&lt;label_name&gt;: ""
...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Place the <code>spec</code> stanza here.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Optionally, modify the EC2 instance type and modify the storage volumes.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Take care to modify only the parameters that describe the EC2 instance type
and storage volumes. You must not change the other parameters value in the
<code>providerSpec</code> section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">providerSpec:
  value:
    ami:
      id: ami-0e2bcd33dfff9c73e <b class="conum">(1)</b>
    apiVersion: awsproviderconfig.k8s.io/v1alpha1
    blockDevices: <b class="conum">(2)</b>
    - ebs:
        iops: 0
        volumeSize: 120
        volumeType: gp2
    deviceIndex: 0
    iamInstanceProfile: <b class="conum">(3)</b>
      id: &lt;cluster_name&gt;-&lt;machine_label&gt;-profile
    instanceType: m4.large <b class="conum">(4)</b>
    kind: AWSMachineProviderConfig
    metadata:
      creationTimestamp: null
    placement: <b class="conum">(3)</b>
      availabilityZone: &lt;AWS-availability-zone&gt;
      region: &lt;AWS-region&gt;
    publicIp: null
    securityGroups:
    - filters:
      - name: tag:Name
        values:
        - testcluster2_worker_sg
    subnet: <b class="conum">(3)</b>
      filters:
      - name: tag:Name
        values:
        - &lt;cluster_name&gt;-&lt;machine_label&gt;-&lt;AWS-availability-zone&gt;
    tags:
    - name: openshiftClusterID
      value: 5a21bfc0-1c56-4400-81bb-7fd66644f871
    - name: kubernetes.io/cluster/&lt;cluster_name&gt;
      value: owned
    userDataSecret: <b class="conum">(3)</b>
      name: &lt;machine_label&gt;-user-data</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>You can specify a different valid AMI.</p>
</li>
<li>
<p>You can customize the volume characteristics for the MachineSet. See the AWS
documentation.</p>
</li>
<li>
<p>Do not modify this section.</p>
</li>
<li>
<p>Specify a valid <code>instanceType</code> for the AMI that you specified.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create the new <code>MachineSet</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create -f &lt;file_name&gt;.yaml</pre>
</div>
</div>
</li>
<li>
<p>View the list of MachineSets:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get machineset -n openshift-machine-api


NAME                         DESIRED   CURRENT   READY     AVAILABLE   AGE
190125-3-worker-us-west-1b   2         2         2         2           4h
190125-3-worker-us-west-1c   1         1         1         1           4h
infrastructure-us-west-1b    1         1                               4s</pre>
</div>
</div>
<div class="paragraph">
<p>When the new MachineSet is available, the <code>DESIRED</code> and <code>CURRENT</code> values match.
If the MachineSet is not available, wait a few minutes and run the command again.</p>
</div>
</li>
<li>
<p>After the new MachineSet is available, check the machine status:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get machine -n openshift-machine-api</pre>
</div>
</div>
</li>
<li>
<p>View the new node:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get node</pre>
</div>
</div>
<div class="paragraph">
<p>The new node is the one with the lowest <code>AGE</code>.  ip-10-0-128-138.us-west-1.compute.internal</p>
</div>
</li>
<li>
<p>Confirm that the new node has the label that you specified:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get node &lt;node_name&gt; --show-labels</pre>
</div>
</div>
<div class="paragraph">
<p>Review the command output and confirm that <code>node-role.kubernetes.io/&lt;your_label&gt;</code>
is in the <code>LABELS</code> list.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Next steps</div>
<p>If you need MachineSets in other availability zones, repeat this
process to create more MachineSets.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="moving-resources-to-infrastructure-machinesets">Moving resources to infrastructure MachineSets</h3>
<div class="paragraph">
<p>Some of the infrastructure resources are deployed in your cluster by default.
You can move them to the infrastructure MachineSets that you created.</p>
</div>
<div class="sect3">
<h4 id="infrastructure-moving-router-creating-infrastructure-machinesets">Moving the router</h4>
<div class="paragraph">
<p>You can deploy the router Pod to a different MachineSet. By default, the Pod
is displayed to a worker node.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure additional MachineSets in your OpenShift Enterprise cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>View the <code>clusteringress</code> Custom Resource for the router Operator:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get clusteringress default -n openshift-ingress-operator -o yaml <b class="conum">(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The router is managed by an Operator that is named
<code>openshift-ingress-operator</code>, and its Pod is in the <code>openshift-ingress-operator</code>
project.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The command output resembles the following text:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: ingress.openshift.io/v1alpha1
kind: ClusterIngress
metadata:
  creationTimestamp: 2019-01-28T17:23:39Z
  finalizers:
  - ingress.openshift.io/default-cluster-ingress
  generation: 2
  name: default
  namespace: openshift-ingress-operator
  resourceVersion: "1294295"
  selfLink: /apis/ingress.openshift.io/v1alpha1/namespaces/openshift-ingress-operator/clusteringresses/default
  uid: 73ff7bfd-2321-11e9-8ff2-026a37856868
spec:
  defaultCertificateSecret: null
  highAvailability:
    type: Cloud
  ingressDomain: apps.beta-190128-2.ocp4testing.openshiftdemos.com
  namespaceSelector: null
  nodePlacement:
    nodeSelector:
      matchLabels:
        node-role.kubernetes.io/worker: "" <b class="conum">(1)</b>
  replicas: 1
  routeSelector: null
  unsupportedExtensions: null
status:
  labelSelector: app=router,router=router-default
  replicas: 1</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Note that the <code>nodeSelector</code> is configured to match the <code>worker</code> label.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Edit the <code>clusteringress</code> resource and change the <code>nodeSelector</code> to use the
<code>infra</code> label:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc edit clusteringress default -n openshift-ingress-operator -o yaml</pre>
</div>
</div>
<div class="paragraph">
<p>Update the <code>nodeSelector</code> stanza to reference the <code>infra</code> label as shown:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">  nodeSelector:
    matchLabels:
      node-role.kubernetes.io/infra: ""
...</code></pre>
</div>
</div>
</li>
<li>
<p>Confirm that the router pod is running on the <code>infra</code> node.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>View the list of router pods and note the node name of the running pod:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get pod -n openshift-ingress

NAME                              READY     STATUS        RESTARTS   AGE       IP           NODE                           NOMINATED NODE
router-default-86798b4b5d-bdlvd   1/1       Running       0          28s       10.130.2.4   ip-10-0-217-226.ec2.internal   &lt;none&gt;
router-default-955d875f4-255g8    0/1       Terminating   0          19h       10.129.2.4   ip-10-0-148-172.ec2.internal   &lt;none&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the running pod is on the <code>ip-10-0-217-226.ec2.internal</code> node.</p>
</div>
</li>
<li>
<p>View the node status of the running pod:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get node &lt;node_name&gt; <b class="conum">(1)</b>

NAME                           STATUS    ROLES          AGE       VERSION
ip-10-0-217-226.ec2.internal   Ready     infra,worker   17h       v1.11.0+406fc897d8</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specify the <code>&lt;node_name&gt;</code> that you obtained from the pod list.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Because the role list includes <code>infra</code>, the pod is running on the correct node.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="infrastructure-moving-registry-creating-infrastructure-machinesets">Moving the default registry</h4>
<div class="paragraph">
<p>You configure the registry Operator to deploy its pods to different nodes.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure additional MachineSets in your OpenShift Enterprise cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>View the <code>config/instance</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get config/instance -o yaml</pre>
</div>
</div>
<div class="paragraph">
<p>The output resembles the following text:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: imageregistry.operator.openshift.io/v1
kind: Config
metadata:
  creationTimestamp: 2019-02-05T13:52:05Z
  finalizers:
  - imageregistry.operator.openshift.io/finalizer
  generation: 1
  name: instance
  resourceVersion: "56174"
  selfLink: /apis/imageregistry.operator.openshift.io/v1/configs/instance
  uid: 36fd3724-294d-11e9-a524-12ffeee2931b
spec:
  httpSecret: d9a012ccd117b1e6616ceccb2c3bb66a5fed1b5e481623
  logging: 2
  managementState: Managed
  proxy: {}
  replicas: 1
  requests:
    read: {}
    write: {}
  storage:
    s3:
      bucket: image-registry-us-east-1-c92e88cad85b48ec8b312344dff03c82-392c
      region: us-east-1
status:
...</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>config/instance</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc edit config/instance</pre>
</div>
</div>
</li>
<li>
<p>Add the following lines of text the <code>spec</code> section of the object:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">  nodeSelector:
    node-role.kubernetes.io/infra: ""</code></pre>
</div>
</div>
<div class="paragraph">
<p>After you save and exit you can see the registry pod being moving to the
infrastructure node.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="infrastructure-moving-monitoring-creating-infrastructure-machinesets">Moving the monitoring solution</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The monitoring solution uses Cluster Version Operator (CVO) to create the
ConfigMap that the monitoring Operator uses to determine how to deploy its
resources. Because it uses the CVO and users cannot modify the CVO, you cannot
change where the Operator deploys resources.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="infrastructure-moving-logging-creating-infrastructure-machinesets">Moving the logging aggregation solution</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The log aggregation solution in OpenShift Enterprise is not installed by default and
cannot currently be deployed.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-04-12 23:56:12 UTC
</div>
</div>
</body>
</html>
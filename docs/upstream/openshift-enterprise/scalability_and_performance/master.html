<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Scalability and performance</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Scalability and performance</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="recommended-host-practices">Recommended host practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This topic provides recommended host practices for OpenShift Enterprise.</p>
</div>
<div class="sect2">
<h3 id="recommended-node-host-practices-">Recommended node host practices</h3>
<div class="paragraph">
<p>The OpenShift Enterprise node configuration file contains important options. For
example, two parameters control the maximum number of pods that can be scheduled
to a node: <code>podsPerCore</code> and <code>maxPods</code>.</p>
</div>
<div class="paragraph">
<p>When both options are in use, the lower of the two values limits the number of
pods on a node. Exceeding these values can result in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Increased CPU utilization.</p>
</li>
<li>
<p>Slow pod scheduling.</p>
</li>
<li>
<p>Potential out-of-memory scenarios, depending on the amount of memory in the node.</p>
</li>
<li>
<p>Exhausting the pool of IP addresses.</p>
</li>
<li>
<p>Resource overcommitting, leading to poor user application performance.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>In Kubernetes, a pod that is holding a single container actually uses two
containers. The second container is used to set up networking prior to the
actual container starting. Therefore, a system running 10 pods will actually
have 20 containers running.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>podsPerCore</code> sets the number of pods the node can run based on the number of
processor cores on the node. For example, if <code>podsPerCore</code> is set to <code>10</code> on a
node with 4 processor cores, the maximum number of pods allowed on the node will
be <code>40</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubeletConfig:
  podsPerCore: 10</pre>
</div>
</div>
<div class="paragraph">
<p>Setting <code>podsPerCore</code> to <code>0</code> disables this limit. The default is <code>0</code>.
<code>podsPerCore</code> cannot exceed <code>maxPods</code>.</p>
</div>
<div class="paragraph">
<p><code>maxPods</code> sets the number of pods the node can run to a fixed value, regardless
of the properties of the node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> kubeletConfig:
    maxPods: 250</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-a-kubeletconfig-crd-to-edit-kubelet-parameters-">Create a KubeletConfig CRD to edit kubelet parameters</h3>
<div class="paragraph">
<p>The kubelet configuration is currently serialized as an ignition configuration,
so it can be directly edited. However, there is also a new
kubelet-config-controller added to the Machine Config Controller (MCC). This
allows you to create a KubeletConfig custom resource (CR) to edit the
kubelet parameters.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get machineconfig</pre>
</div>
</div>
<div class="paragraph">
<p>This provides a list of the available machine configuration objects you can
select. By default, the two kubelet-related configs are <code>01-master-kubelet</code> and
<code>01-worker-kubelet</code>.</p>
</div>
</li>
<li>
<p>To check the current value of max Pods per node, run:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># oc describe node &lt;node-ip&gt; | grep Allocatable -A6</pre>
</div>
</div>
<div class="paragraph">
<p>Look for <code>value: pods: &lt;value&gt;</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># oc describe node ip-172-31-128-158.us-east-2.compute.internal | grep Allocatable -A6
Allocatable:
 attachable-volumes-aws-ebs:  25
 cpu:                         3500m
 hugepages-1Gi:               0
 hugepages-2Mi:               0
 memory:                      15341844Ki
 pods:                        250</pre>
</div>
</div>
</li>
<li>
<p>To set the max Pods per node on the worker nodes, create a YAML file that
contains the kubelet configuration. For example, <code>max-worker-pods.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">apiVersion: machineconfiguration.openshift.io/v1
kind: KubeletConfig
metadata:
  name: set-max-pods
spec:
  machineConfigSelector: 01-worker-kubelet
  kubeletConfig:
    maxPods: 250</pre>
</div>
</div>
</li>
<li>
<p>Apply the file by running:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc apply -f max-worker-pods.yaml</pre>
</div>
</div>
</li>
<li>
<p>Verify the change by running:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get kubeletconfigs set-max-pods -o yaml</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_additional-resources">Additional resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#planning-your-environment-according-to-object-limits">OpenShift Enterprise
cluster limits</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-node-tuning-operator">Using the Node Tuning Operator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Learn about the Node Tuning Operator and how you can use it to manage node-level
tuning by orchestrating the tuned daemon.</p>
</div>
<div class="sect2">
<h3 id="about-node-tuning-operator-node-tuning-operator">About the Node Tuning Operator</h3>
<div class="paragraph">
<p>The Node Tuning Operator helps you manage node-level tuning by orchestrating the
tuned daemon. The majority of high-performance applications require some level of
kernel tuning. The Node Tuning Operator provides a unified management interface
to users of node-level sysctls and more flexibility to add custom tuning, which
is currently a Technology Preview feature, specified by user needs. The Operator
manages the containerized tuned daemon for OpenShift Enterprise as a Kubernetes
DaemonSet. It ensures the custom tuning specification is passed to all
containerized tuned daemons running in the cluster in the format that the
daemons understand. The daemons run on all nodes in the cluster, one per node.</p>
</div>
<div class="paragraph">
<p>The Node Tuning Operator is part of a standard OpenShift Enterprise installation in
version 4.0 and later.</p>
</div>
</div>
<div class="sect2">
<h3 id="accessing-an-example-node-tuning-operator-specification-node-tuning-operator">Accessing an example Node Tuning Operator specification</h3>
<div class="paragraph">
<p>Use this process to access an example Node Tuning Operator specification.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get Tuned/default -o yaml -n openshift-cluster-node-tuning-operator</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="custom-tuning-default-profiles-set-node-tuning-operator">Default profiles set on a cluster</h3>
<div class="paragraph">
<p>The following are the default profiles set on a cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">apiVersion: tuned.openshift.io/v1alpha1
kind: Tuned
metadata:
  name: default
  namespace: openshift-cluster-node-tuning-operator
spec:
  profile:
  - name: "openshift"
    data: |
      [main]
      summary=Optimize systems running OpenShift (parent profile)
      include=${f:virt_check:virtual-guest:throughput-performance}
      [selinux]
      avc_cache_threshold=8192
      [net]
      nf_conntrack_hashsize=131072
      [sysctl]
      net.ipv4.ip_forward=1
      kernel.pid_max=&gt;131072
      net.netfilter.nf_conntrack_max=1048576
      net.ipv4.neigh.default.gc_thresh1=8192
      net.ipv4.neigh.default.gc_thresh2=32768
      net.ipv4.neigh.default.gc_thresh3=65536
      net.ipv6.neigh.default.gc_thresh1=8192
      net.ipv6.neigh.default.gc_thresh2=32768
      net.ipv6.neigh.default.gc_thresh3=65536
      [sysfs]
      /sys/module/nvme_core/parameters/io_timeout=4294967295
      /sys/module/nvme_core/parameters/max_retries=10
  - name: "openshift-control-plane"
    data: |
      [main]
      summary=Optimize systems running OpenShift control plane
      include=openshift
      [sysctl]
      # ktune sysctl settings, maximizing i/o throughput
      #
      # Minimal preemption granularity for CPU-bound tasks:
      # (default: 1 msec#  (1 + ilog(ncpus)), units: nanoseconds)
      kernel.sched_min_granularity_ns=10000000
      # The total time the scheduler will consider a migrated process
      # "cache hot" and thus less likely to be re-migrated
      # (system default is 500000, i.e. 0.5 ms)
      kernel.sched_migration_cost_ns=5000000
      # SCHED_OTHER wake-up granularity.
      #
      # Preemption granularity when tasks wake up.  Lower the value to
      # improve wake-up latency and throughput for latency critical tasks.
      kernel.sched_wakeup_granularity_ns=4000000
  - name: "openshift-node"
    data: |
      [main]
      summary=Optimize systems running OpenShift nodes
      include=openshift
      [sysctl]
      net.ipv4.tcp_fastopen=3
      fs.inotify.max_user_watches=65536
  - name: "openshift-control-plane-es"
    data: |
      [main]
      summary=Optimize systems running ES on OpenShift control-plane
      include=openshift-control-plane
      [sysctl]
      vm.max_map_count=262144
  - name: "openshift-node-es"
    data: |
      [main]
      summary=Optimize systems running ES on OpenShift nodes
      include=openshift-node
      [sysctl]
      vm.max_map_count=262144
  recommend:
  - profile: "openshift-control-plane-es"
    priority: 10
    match:
    - label: "tuned.openshift.io/elasticsearch"
      type: "pod"
      match:
      - label: "node-role.kubernetes.io/master"
      - label: "node-role.kubernetes.io/infra"

  - profile: "openshift-node-es"
    priority: 20
    match:
    - label: "tuned.openshift.io/elasticsearch"
      type: "pod"

  - profile: "openshift-control-plane"
    priority: 30
    match:
    - label: "node-role.kubernetes.io/master"
    - label: "node-role.kubernetes.io/infra"

  - profile: "openshift-node"
priority: 40</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Custom profiles for custom tuning specification is a Technology Preview release only. Technology Preview releases
are not supported with Red Hat production service-level agreements (SLAs) and
might not be functionally complete, and Red Hat does not recommend using them
for production. These features provide early access to upcoming product
features, enabling customers to test functionality and provide feedback during
the development process. For more information see
<a href="https://access.redhat.com/support/offerings/techpreview/">Red Hat Technology
Preview Features Support Scope</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="custom-tuning-specification-node-tuning-operator">Custom tuning specification</h3>
<div class="paragraph">
<p>The custom resource (CR) for the operator has two major sections. The first
section, <code>profile:</code>, is a list of tuned profiles and their names. The second,
<code>recommend:</code>, defines the profile selection logic.</p>
</div>
<div class="paragraph">
<p>Multiple custom tuning specifications can co-exist as multiple CRs in the
operator&#8217;s namespace. The existence of new CRs or the deletion of old CRs is
detected by the Operator. All existing custom tuning specifications are merged
and appropriate objects for the containerized tuned daemons are updated.</p>
</div>
<div class="paragraph">
<p><strong>Profile data</strong></p>
</div>
<div class="paragraph">
<p>The <code>profile:</code> section lists tuned profiles and their names.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">profile:
- name: tuned_profile_1
  data: |
    # Tuned profile specification
    [main]
    summary=Description of tuned_profile_1 profile

    [sysctl]
    net.ipv4.ip_forward=1
    # ... other sysctl's or other tuned daemon plugins supported by the containerized tuned

# ...

- name: tuned_profile_n
  data: |
    # Tuned profile specification
    [main]
    summary=Description of tuned_profile_n profile

    # tuned_profile_n profile settings</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Recommended profiles</strong></p>
</div>
<div class="paragraph">
<p>The <code>profile:</code> selection logic is defined by the <code>recommend:</code> section of the CR:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">recommend:
- match:                              # optional; if omitted, profile match is assumed unless a profile with a higher matches first
  &lt;match&gt;                             # an optional array
  priority: &lt;priority&gt;                # profile ordering priority, lower numbers mean higher priority (0 is the highest priority)
  profile: &lt;tuned_profile_name&gt;       # e.g. tuned_profile_1

# ...

- match:
  &lt;match&gt;
  priority: &lt;priority&gt;
  profile: &lt;tuned_profile_name&gt;       # e.g. tuned_profile_n</pre>
</div>
</div>
<div class="paragraph">
<p>If <code>&lt;match&gt;</code> is omitted, a profile match (for example, <code>true</code>) is assumed.</p>
</div>
<div class="paragraph">
<p><code>&lt;match&gt;</code> is an optional array recursively defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">- label: &lt;label_name&gt;     # node or pod label name
  value: &lt;label_value&gt;    # optional node or pod label value; if omitted, the presence of &lt;label_name&gt; is enough to match
  type: &lt;label_type&gt;      # optional node or pod type ("node" or "pod"); if omitted, "node" is assumed
  &lt;match&gt;                 # an optional &lt;match&gt; array</pre>
</div>
</div>
<div class="paragraph">
<p>If <code>&lt;match&gt;</code> is not omitted, all nested <code>&lt;match&gt;</code> sections must also evaluate to
<code>true</code>. Otherwise, <code>false</code> is assumed and the profile with the respective
<code>&lt;match&gt;</code> section will not be applied or recommended. Therefore, the nesting
(child <code>&lt;match&gt;</code> sections) works as logical AND operator. Conversely, if any
item of the <code>&lt;match&gt;</code> array matches, the entire <code>&lt;match&gt;</code> array evaluates to
<code>true</code>. Therefore, the array acts as logical OR operator.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="nowrap">- match:
  - label: tuned.openshift.io/elasticsearch
    match:
    - label: node-role.kubernetes.io/master
    - label: node-role.kubernetes.io/infra
    type: pod
  priority: 10
  profile: openshift-control-plane-es
- match:
  - label: node-role.kubernetes.io/master
  - label: node-role.kubernetes.io/infra
  priority: 20
  profile: openshift-control-plane
- priority: 30
  profile: openshift-node</pre>
</div>
</div>
<div class="paragraph">
<p>The CR above is translated for the containerized tuned daemon into its
<code>recommend.conf</code> file based on the profile priorities. The profile with the
highest priority (<code>10</code>) is <code>openshift-control-plane-es</code> and, therefore, it is
considered first. The containerized tuned daemon running on a given node looks
to see if there is a pod running on the same node with the
<code>tuned.openshift.io/elasticsearch</code> label set. If not, the entire <code>&lt;match&gt;</code>
section evaluates as <code>false</code>. If there is such a pod with the label, in order for
the <code>&lt;match&gt;</code> section to evaluate to <code>true</code>, the node label also needs to be
<code>node-role.kubernetes.io/master</code> or <code>node-role.kubernetes.io/infra</code>.</p>
</div>
<div class="paragraph">
<p>If the labels for the profile with priority <code>10</code> matched,
<code>openshift-control-plane-es</code> profile is applied and no other profile is
considered. If the node/pod label combination did not match, the second highest
priority profile (<code>openshift-control-plane</code>) is considered. This profile is
applied if the containerized tuned pod runs on a node with labels
<code>node-role.kubernetes.io/master</code> or <code>node-role.kubernetes.io/infra</code>.</p>
</div>
<div class="paragraph">
<p>Finally, the profile <code>openshift-node</code> has the lowest priority of <code>30</code>. It lacks
the <code>&lt;match&gt;</code> section and, therefore, will always match. It acts as a profile
catch-all to set <code>openshift-node</code> profile, if no other profile with higher
priority matches on a given node.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/node-tuning-operator-workflow-revised.png" alt="Decision workflow">
</div>
</div>
</div>
<div class="sect2">
<h3 id="supported-tuned-daemon-plug-ins-node-tuning-operator">Supported Tuned daemon plug-ins</h3>
<div class="paragraph">
<p>Excluding the <code>[main]</code> section, the following Tuned plug-ins are supported when
using custom profiles defined in the <code>profile:</code> section of the Tuned CR:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>audio</p>
</li>
<li>
<p>cpu</p>
</li>
<li>
<p>disk</p>
</li>
<li>
<p>eeepc_she</p>
</li>
<li>
<p>modules</p>
</li>
<li>
<p>mounts</p>
</li>
<li>
<p>net</p>
</li>
<li>
<p>scheduler</p>
</li>
<li>
<p>scsi_host</p>
</li>
<li>
<p>selinux</p>
</li>
<li>
<p>sysctl</p>
</li>
<li>
<p>sysfs</p>
</li>
<li>
<p>usb</p>
</li>
<li>
<p>video</p>
</li>
<li>
<p>vm</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is some dynamic tuning functionality provided by some of these plug-ins
that is not supported. The following Tuned plug-ins are currently not supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>bootloader</p>
</li>
<li>
<p>script</p>
</li>
<li>
<p>systemd</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-cluster-loader">Using Cluster Loader</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cluster Loader is a tool that deploys large numbers of various objects to a
cluster, which creates user-defined cluster objects. Build, configure, and run
Cluster Loader to measure performance metrics of your OpenShift Enterprise deployment
at various cluster states.</p>
</div>
<div class="sect2">
<h3 id="installing_cluster_loader-">Installing Cluster Loader</h3>
<div class="paragraph">
<p>Cluster Loader is included in the <code>origin-tests</code> container image.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To pull the <code>origin-tests</code> container image, run:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo podman pull quay.io/openshift/origin-tests:v4.0</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="running_cluster_loader-">Running Cluster Loader</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Execute Cluster Loader using the built-in test configuration, which deploys five
template builds and waits for them to complete:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo podman run -v ${LOCAL_KUBECONFIG}:/root/.kube/config -i
quay.io/openshift/origin-tests:v4.0 /bin/bash -c 'export KUBECONFIG=/root/.kube/config &amp;&amp; \
openshift-tests run-test "[Feature:Performance][Serial][Slow] Load cluster should load the \
cluster [Suite:openshift]"'</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, execute Cluster Loader with a user-defined configuration by
setting the environment variable for <code>VIPERCONFIG</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo podman run -v ${LOCAL_KUBECONFIG}:/root/.kube/config -i
quay.io/openshift/origin-tests:v4.0 /bin/bash -c 'export KUBECONFIG=/root/.kube/config &amp;&amp; \
export VIPERCONFIG=config/test &amp;&amp; \
openshift-tests run-test "[Feature:Performance][Serial][Slow] Load cluster should load the \
cluster [Suite:openshift]"'</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, there is a subdirectory called <strong><em>config/</em></strong> with a configuration
file called <strong><em>test.yml</em></strong>. In the command line, exclude the extension of the
configuration file, as the tool will automatically determine the file type and
extension.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring_cluster_loader-">Configuring Cluster Loader</h3>
<div class="paragraph">
<p>The tool creates multiple namespaces (projects), which contain multiple templates or pods.</p>
</div>
<div class="paragraph">
<p>Locate the configuration files for Cluster Loader in the <code>config/</code> subdirectory.
The pod files and template files referenced in these configuration examples are
found in the <code>content/</code> subdirectory.</p>
</div>
<div class="sect3">
<h4 id="_example-cluster-loader-configuration-file">Example Cluster Loader configuration file</h4>
<div class="paragraph">
<p>Cluster Loaders configuration file is a basic YAML file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">provider: local <b class="conum">(1)</b>
ClusterLoader:
  cleanup: true
  projects:
    - num: 1
      basename: clusterloader-cakephp-mysql
      tuning: default
      ifexists: reuse
      templates:
        - num: 1
          file: ./examples/quickstarts/cakephp-mysql.json

    - num: 1
      basename: clusterloader-dancer-mysql
      tuning: default
      ifexists: reuse
      templates:
        - num: 1
          file: ./examples/quickstarts/dancer-mysql.json

    - num: 1
      basename: clusterloader-django-postgresql
      tuning: default
      ifexists: reuse
      templates:
        - num: 1
          file: ./examples/quickstarts/django-postgresql.json

    - num: 1
      basename: clusterloader-nodejs-mongodb
      tuning: default
      ifexists: reuse
      templates:
        - num: 1
          file: ./examples/quickstarts/nodejs-mongodb.json

    - num: 1
      basename: clusterloader-rails-postgresql
      tuning: default
      templates:
        - num: 1
          file: ./examples/quickstarts/rails-postgresql.json

  tuningset: <b class="conum">(2)</b>
    - name: default
      pods:
        stepping: <b class="conum">(3)</b>
          stepsize: 5
          pause: 0 s
        rate_limit: <b class="conum">(4)</b>
          delay: 0 ms</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Optional setting for end-to-end tests. Set to <code>local</code> to avoid extra log messages.</p>
</li>
<li>
<p>The tuning sets allow rate limiting and stepping, the ability to create several
batches of pods while pausing in between sets. Cluster Loader monitors
completion of the previous step before continuing.</p>
</li>
<li>
<p>Stepping will pause for <code>M</code> seconds after each <code>N</code> objects are created.</p>
</li>
<li>
<p>Rate limiting will wait <code>M</code> milliseconds between the creation of objects.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_configuration-fields">Configuration fields</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Top-level Cluster Loader Fields</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cleanup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to <code>true</code> or <code>false</code>. One definition per configuration. If set to <code>true</code>,
<code>cleanup</code> deletes all namespaces (projects) created by Cluster Loader at the
end of the test.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>projects</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A sub-object with one or many definition(s). Under <code>projects</code>, each
namespace to create is defined and <code>projects</code> has several mandatory subheadings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tuningset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A sub-object with one definition per configuration. <code>tuningset</code> allows the user
to define a tuning set to add configurable timing to project or object creation
(pods, templates, and so on).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sync</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional sub-object with one definition per configuration. Adds synchronization
possibilities during object creation.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Fields under <code>projects</code></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>num</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An integer. One definition of the count of how many projects to create.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>basename</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string. One definition of the base name for the project. The count of
identical namespaces will be appended to <code>Basename</code> to prevent collisions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tuning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string. One definition of what tuning set you want to apply to the objects,
which you deploy inside this namespace.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ifexists</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string containing either <code>reuse</code> or <code>delete</code>. Defines what the tool does if
it finds a project or namespace that has the same name of the project or
namespace it creates during execution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>configmaps</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of key-value pairs. The key is the ConfigMap name and the value is a
path to a file from which you create the ConfigMap.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>secrets</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of key-value pairs. The key is the secret name and the value is a path to
a file from which you create the secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pods</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A sub-object with one or many definition(s) of pods to deploy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>templates</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A sub-object with one or many definition(s) of templates to deploy.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Fields under <code>pods</code> and <code>templates</code></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>num</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An integer. The number of pods or templates to deploy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>image</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string. The docker image URL to a repository where it can be pulled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>basename</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string. One definition of the base name for the template (or pod) that you want to create.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>file</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string. The path to a local file, which is either a PodSpec or template to be created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>parameters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key-value pairs. Under <code>parameters</code>, you can specify a list of values to
override in the pod or template.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Fields under <code>tuningset</code></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string. The name of the tuning set which will match the name specified when
defining a tuning in a project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pods</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A sub-object identifying the <code>tuningset</code> that will apply to pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>templates</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A sub-object identifying the <code>tuningset</code> that will apply to templates.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Fields under <code>tuningset</code> <code>pods</code> or <code>tuningset</code> <code>templates</code></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>stepping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A sub-object. A stepping configuration used if you want to create an object in a
step creation pattern.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rate_limit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A sub-object. A rate-limiting tuning set configuration to limit the object
creation rate.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Fields under <code>tuningset</code> <code>pods</code> or <code>tuningset</code> <code>templates</code>, <code>stepping</code></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>stepsize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An integer. How many objects to create before pausing object creation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pause</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An integer. How many seconds to pause after creating the number of objects
defined in <code>stepsize</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An integer. How many seconds to wait before failure if the object creation is
not successful.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delay</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An integer. How many milliseconds (ms) to wait between creation requests.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Fields under <code>sync</code></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A sub-object with <code>enabled</code> and <code>port</code> fields. The boolean <code>enabled</code> defines
whether to start a HTTP server for pod synchronization. The integer <code>port</code>
defines the HTTP server port to listen on (<code>9090</code> by default).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>running</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A boolean. Wait for pods with labels matching <code>selectors</code> to go into <code>Running</code>
state.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>succeeded</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A boolean. Wait for pods with labels matching <code>selectors</code> to go into <code>Completed</code>
state.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>selectors</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of selectors to match pods in <code>Running</code> or <code>Completed</code> states.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string. The synchronization timeout period to wait for pods in <code>Running</code> or
<code>Completed</code> states. For values that are not <code>0</code>, use units:
[ns|us|ms|s|m|h].</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_known-issues">Known issues</h3>
<div class="paragraph">
<p>If the <code>IDENTIFIER</code> parameter is not defined in user templates, template
creation fails with <code>error: unknown parameter name "IDENTIFIER"</code>. If you deploy
templates, add this parameter to your template to avoid this error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{
  "name": "IDENTIFIER",
  "description": "Number to append to the name of resources",
  "value": "1"
}</pre>
</div>
</div>
<div class="paragraph">
<p>If you deploy pods, adding the parameter is unnecessary.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scaling-the-cluster-monitoring-operator">Scaling the Cluster Monitoring Operator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenShift Enterprise exposes metrics that the Cluster Monitoring Operator collects
and stores in the Prometheus-based monitoring stack. As an OpenShift Enterprise
administrator, you can view system resources, containers and components metrics
in one dashboard interface, Grafana.</p>
</div>
<div class="sect2">
<h3 id="prometheus-database-storage-requirements-cluster-monitoring-operator">Prometheus database storage requirements</h3>
<div class="paragraph">
<p>Red Hat performed various tests for different scale sizes.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Prometheus Database storage requirements based on number of nodes/pods in the cluster</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Number of Nodes</th>
<th class="tableblock halign-left valign-top">Number of Pods</th>
<th class="tableblock halign-left valign-top">Prometheus storage growth per day</th>
<th class="tableblock halign-left valign-top">Prometheus storage growth per 15 days</th>
<th class="tableblock halign-left valign-top">RAM Space (per scale size)</th>
<th class="tableblock halign-left valign-top">Network (per tsdb chunk)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1800</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.3 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">94 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3600</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">195 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">26 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">150</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">19 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">283 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">36 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">375 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">46 MB</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Approximately 20 percent of the expected size was added as overhead to ensure
that the storage requirements do not exceed the calculated value.</p>
</div>
<div class="paragraph">
<p>The above calculation is for the default OpenShift Enterprise Cluster Monitoring
Operator.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>CPU utilization has minor impact. The ratio is approximately 1 core out of 40
per 50 nodes and 1800 pods.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Lab environment</strong></p>
</div>
<div class="paragraph">
<p>In a previous release, all experiments were performed in an OpenShift Enterprise on
OpenStack environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Infra nodes (VMs) - 40 cores, 157 GB RAM.</p>
</li>
<li>
<p>CNS nodes (VMs) - 16 cores, 62 GB RAM, NVMe drives.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Currently, OpenStack environments are not supported for OpenShift Enterprise 4.0.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Recommendations for OpenShift Enterprise</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use at least three infrastructure (infra) nodes.</p>
</li>
<li>
<p>Use at least three <strong>openshift-container-storage</strong> nodes with non-volatile memory express (NVMe) drives.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Container Storage (OCS) is currently a Technology Preview feature.
Technology Preview features are not supported with Red Hat production service
level agreements (SLAs), might not be functionally complete, and Red Hat does
not recommend to use them for production. These features provide early access to
upcoming product features, enabling customers to test functionality and provide
feedback during the development process.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://access.redhat.com/support/offerings/techpreview/">Red Hat
Technology Preview features support scope</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="configuring-cluster-monitoring-cluster-monitoring-operator">Configuring cluster monitoring</h3>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To increase the storage capacity for Prometheus:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a YAML configuration file, `cluster-monitoring-config.yml. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">apiVersion: v1
kind: ConfigMap
data:
  config.yaml: |
    prometheusOperator:
      baseImage: quay.io/coreos/prometheus-operator
      prometheusConfigReloaderBaseImage: quay.io/coreos/prometheus-config-reloader
      configReloaderBaseImage: quay.io/coreos/configmap-reload
      nodeSelector:
        node-role.kubernetes.io/infra: ""
    prometheusK8s:
      retention: {{PROMETHEUS_RETENTION_PERIOD}} <b class="conum">(1)</b>
      baseImage: openshift/prometheus
      nodeSelector:
        node-role.kubernetes.io/infra: ""
      volumeClaimTemplate:
        spec:
          storageClassName: gp2
          resources:
            requests:
              storage: {{PROMETHEUS_STORAGE_SIZE}} <b class="conum">(2)</b>
    alertmanagerMain:
      baseImage: openshift/prometheus-alertmanager
      nodeSelector:
        node-role.kubernetes.io/infra: ""
      volumeClaimTemplate:
        spec:
          storageClassName: gp2
          resources:
            requests:
              storage: {{ALERTMANAGER_STORAGE_SIZE}} <b class="conum">(3)</b>
    nodeExporter:
      baseImage: openshift/prometheus-node-exporter
    kubeRbacProxy:
      baseImage: quay.io/coreos/kube-rbac-proxy
    kubeStateMetrics:
      baseImage: quay.io/coreos/kube-state-metrics
      nodeSelector:
        node-role.kubernetes.io/infra: ""
    grafana:
      baseImage: grafana/grafana
      nodeSelector:
        node-role.kubernetes.io/infra: ""
    auth:
      baseImage: openshift/oauth-proxy
    k8sPrometheusAdapter:
      nodeSelector:
        node-role.kubernetes.io/infra: ""
metadata:
  name: cluster-monitoring-config
namespace: openshift-monitoring</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A typical value is <code>PROMETHEUS_RETENTION_PERIOD=15d</code>. Units are measured in
time using one of these suffixes: s, m, h, d.</p>
</li>
<li>
<p>A typical value is <code>PROMETHEUS_STORAGE_SIZE=2000Gi</code>. Storage values can be a
plain integer or as a fixed-point integer using one of these suffixes: E, P, T,
G, M, K. You can also use the power-of-two equivalents: Ei, Pi, Ti, Gi, Mi, Ki.</p>
</li>
<li>
<p>A typical value is <code>ALERTMANAGER_STORAGE_SIZE=20Gi</code>. Storage values can be a
plain integer or as a fixed-point integer using one of these suffixes: E, P, T,
G, M, K. You can also use the power-of-two equivalents: Ei, Pi, Ti, Gi, Mi, Ki.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Set the values like the retention period and storage sizes.</p>
</li>
<li>
<p>Apply the changes by running:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create -f cluster-monitoring-config.yml</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="scaling-the-prometheus-components-cluster-monitoring-operator">Scaling the Prometheus components</h3>
<div class="paragraph">
<p>Scale up or down the number of OpenShift Enterprise Prometheus pods replicas.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Based on your scale destination, compute and set the relevant persistent volume
(PV) size for the Prometheus data store. Because the default for Prometheus pod
replicas is 2, for 100 nodes with 3600 pods you need 188 GB, as in this example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">94 GB (space per 15 days ) * 2 (pods) = 188 GB free</pre>
</div>
</div>
<div class="paragraph">
<p>Based on this equation, set
<code>openshift_cluster_monitoring_operator_prometheus_storage_capacity=94Gi</code>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Scaling up</strong></p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># oc scale -n openshift-monitoring --replicas=3 statefulset prometheus-k8s</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The default replicas are 2 Prometheus pods.</p>
</li>
<li>
<p>If you add a new node to or remove an existing node from a Prometheus cluster,
the data stored in the cluster rebalances across the cluster.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Scaling down</strong></p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># oc scale -n openshift-monitoring --replicas=0 statefulset prometheus-k8s</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="planning-your-environment-according-to-object-limits">Planning your environment according to object limits</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Consider the following object limits when you plan your OpenShift Enterprise cluster.</p>
</div>
<div class="paragraph">
<p>These limits are based on on the largest possible cluster. For smaller
clusters, the limits are proportionally lower. There are many factors that
influence the stated thresholds, including the etcd version or storage data
format.</p>
</div>
<div class="paragraph">
<p>In most cases, exceeding these limits results in lower overall performance. It
does not necessarily mean that the cluster will fail.</p>
</div>
<div class="sect2">
<h3 id="cluster-limits-object-limits">OpenShift Enterprise cluster limits</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Limit type</th>
<th class="tableblock halign-left valign-top">3.9 limit</th>
<th class="tableblock halign-left valign-top">3.10 limit</th>
<th class="tableblock halign-left valign-top">3.11 limit</th>
<th class="tableblock halign-left valign-top">4.0 limit</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of nodes <sup class="footnote" id="_footnote_numberofnodes">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TBD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of pods <sup class="footnote" id="_footnote_numberofpods">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">150,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">150,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TBD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of pods per node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">250</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">250</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">250</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TBD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of pods per core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 is the default value. The maximum supported value is the number of pods per node.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">There is no default value. The maximum supported value is the number of pods per node.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">There is no default value. The maximum supported value is the number of pods per node.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TBD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of namespaces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TBD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of builds: Pipeline Strategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10,000 (Default pod RAM 512 Mi)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10,000 (Default pod RAM 512 Mi)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10,000 (Default pod RAM 512 Mi)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TBD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of pods per namespace <sup class="footnote" id="_footnote_objectpernamespace">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TBD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of services <sup class="footnote" id="_footnote_servicesandendpoints">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TBD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of services per namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TBD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of back-ends per service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TBD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of deployments per namespace <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TBD</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In OpenShift Enterprise 4.0, half of a CPU core (500 millicore) is now reserved by
the system compared to OpenShift Enterprise 3.11 and previous versions.</p>
</div>
</div>
<div class="sect2">
<h3 id="how-to-plan-according-to-cluster-limits-object-limits">How to plan your environment according to cluster limits</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Oversubscribing the physical resources on a node affects resource guarantees the
Kubernetes scheduler makes during pod placement. Learn what measures you can
take to avoid memory swapping.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>While planning your environment, determine how many pods are expected to fit per
node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Maximum Pods per Cluster / Expected Pods per Node = Total Number of Nodes</pre>
</div>
</div>
<div class="paragraph">
<p>The number of pods expected to fit on a node is dependent on the application
itself. Consider the application&#8217;s memory, CPU, and storage requirements.</p>
</div>
<div class="paragraph">
<div class="title">Example scenario</div>
<p>If you want to scope your cluster for 2200 pods per cluster, you would need at
least nine nodes, assuming that there are 250 maximum pods per node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">2200 / 250 = 8.8</pre>
</div>
</div>
<div class="paragraph">
<p>If you increase the number of nodes to 20, then the pod distribution changes to
110 pods per node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">2200 / 20 = 110</pre>
</div>
</div>
<div class="paragraph">
<p>[id="how-to-plan-according-to-application-requirements-object-limits'
= How to plan your environment according to application requirements</p>
</div>
<div class="paragraph">
<p>Consider an example application environment:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pod type</th>
<th class="tableblock halign-left valign-top">Pod quantity</th>
<th class="tableblock halign-left valign-top">Max memory</th>
<th class="tableblock halign-left valign-top">CPU cores</th>
<th class="tableblock halign-left valign-top">Persistent storage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">node.js</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">postgresql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JBoss EAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 GB</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Extrapolated requirements: 550 CPU cores, 450GB RAM, and 1.4TB storage.</p>
</div>
<div class="paragraph">
<p>Instance size for nodes can be modulated up or down, depending on your
preference. Nodes are often resource overcommitted. In this deployment
scenario, you can choose to run additional smaller nodes or fewer larger nodes
to provide the same amount of resources. Factors such as operational agility and
cost-per-instance should be considered.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Node type</th>
<th class="tableblock halign-left valign-top">Quantity</th>
<th class="tableblock halign-left valign-top">CPUs</th>
<th class="tableblock halign-left valign-top">RAM (GB)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nodes (option 1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nodes (option 2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nodes (option 3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Some applications lend themselves well to overcommitted environments, and some
do not. Most Java applications and applications that use huge pages are examples
of applications that would not allow for overcommitment. That memory can not be
used for other applications. In the example above, the environment would be
roughly 30 percent overcommitted, a common ratio.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="optimizing-compute-resources">Optimizing compute resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Containers can specify compute resource requests and limits. Requests are used
for scheduling your container and provide a minimum service guarantee. Limits
constrain the amount of compute resource that may be consumed on your node.</p>
</div>
<div class="paragraph">
<p>The scheduler attempts to optimize the compute resource use across all nodes in
your cluster. It places pods onto specific nodes, taking the pods' compute
resource requests and nodes' available capacity into consideration.</p>
</div>
<div class="paragraph">
<p>Requests and limits enable administrators to allow and manage the overcommitment
of resources on a node, which may be desirable in development environments where
a tradeoff of guaranteed performance for capacity is acceptable.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>To avoid erratic cluster behavior due to scheduling collisions between the
hypervisor and Kubernetes, do not overcommit at the hypervisor level.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="how-to-debug-issues-with-rhel-tools-">Debugging scaling or performance issues using the RHEL Tools container image</h3>
<div class="paragraph">
<p>Red Hat distributes a <code>rhel-tools</code> container image, packaging tools that aid in
debugging scaling or performance problems. This container image:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Allows users to deploy minimal footprint container hosts by moving packages out
of the base distribution and into this support container.</p>
</li>
<li>
<p>Provides debugging capabilities for Red Hat Enterprise Linux 7 Atomic Host,
which has an immutable package tree. <code>rhel-tools</code> includes utilities such as
tcpdump, sosreport, git, gdb, perf, and many more common system administration
utilities.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To debug an issue, run:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># oc debug node/&lt;node-ip-address&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># oc debug node/ip-10-0-171-215.us-west-2.compute.internal
Starting pod/ip-10-0-171-215us-west-2computeinternal-debug ...</pre>
</div>
</div>
<div class="paragraph">
<p>This starts a tools pod on the node.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="optimizing-networking">Optimizing networking</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The OpenShift SDN uses Open vSwitch, Virtual Extensible LAN (VXLAN) tunnels,
OpenFlow rules, and iptables. This network can be tuned by using jumbo frames,
network interface cards (NIC) offloads, multi-queue, and ethtool settings.</p>
</div>
<div class="paragraph">
<p>VXLAN provides benefits over VLANs, such as an increase in networks from 4096 to
over 16 million, and layer 2 connectivity across physical networks. This allows
for all Pods behind a service to communicate with each other, even if they are
running on different systems.</p>
</div>
<div class="paragraph">
<p>VXLAN encapsulates all tunneled traffic in user datagram protocol (UDP) packets.
However, this leads to increased CPU utilization. Both these outer- and
inner-packets are subject to normal checksumming rules to guarantee data has not
been corrupted during transit. Depending on CPU performance, this additional
processing overhead can cause a reduction in throughput and increased latency
when compared to traditional, non-overlay networks.</p>
</div>
<div class="paragraph">
<p>Cloud, VM, and bare metal CPU performance can be capable of handling much more
than one Gbps network throughput. When using higher bandwidth links such as 10
or 40 Gbps, reduced performance can occur. This is a known issue in VXLAN-based
environments and is not specific to containers or OpenShift Enterprise. Any network
that relies on VXLAN tunnels performs similarly because of the VXLAN
implementation.</p>
</div>
<div class="paragraph">
<p>If you are looking to push beyond one Gbps, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Evaluate network plug-ins that implement different routing techniques, such as
border gateway protocol (BGP).</p>
</li>
<li>
<p>Use VXLAN-offload capable network adapters. VXLAN-offload moves the packet
checksum calculation and associated CPU overhead off of the system CPU and onto
dedicated hardware on the network adapter. This frees up CPU cycles for use by
Pods and applications, and allows users to utilize the full bandwidth of their
network infrastructure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>VXLAN-offload does not reduce latency. However, CPU utilization is reduced even
in latency tests.</p>
</div>
<div class="sect2">
<h3 id="Configuring-network-subnets-networking">Configuring network subnets</h3>
<div class="paragraph">
<p>All Pods are assigned IPs. This enables Pod to Pod communication and Pod to node
communication without network address translation (NAT). For a CIDR in the range
of 10.128.0.0/14, IPs in this range are, by default, assigned to the Pods. If
you want to change this, you must adjust the <code>ClusterNetwork</code>. If you want to
customize the IPs rolled out to services, then you must adjust the
<code>ServiceNetwork</code>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure a custom IP range, also called a <em>subnet</em>, complete the following.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ./openshift-install --dir=new-install create install-config</pre>
</div>
</div>
</li>
<li>
<p>Change to the <code>new-install</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ cd new-install</pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>install-config.yaml</code> file, setting the required fields under
<code>networking</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">networking:
      clusterNetwork:
        - cidr: 10.128.0.0/14
          hostPrefix: 23
      machineCIDR: 10.0.0.0/16
      serviceNetwork: 172.30.0.0/16
      networkType: OpenshiftSDN</pre>
</div>
</div>
</li>
<li>
<p>Consume the customized <code>install-config.yaml</code> file to deploy the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ./openshift-install --dir=new-install create cluster</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="optimizing-storage">Optimizing storage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Optimizing storage helps to minimize storage use across all resources. By
optimizing storage, administrators help ensure that existing storage resources
are working in an efficient manner.</p>
</div>
<div class="sect2">
<h3 id="available-persistent-storage-options-persistent-storage">Available persistent storage options</h3>
<div class="paragraph">
<p>Understand your persistent storage options so that you can optimize your
OpenShift Enterprise environment.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Available storage options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 50%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Storage type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Presented to the operating system (OS) as a block device</p>
</li>
<li>
<p>Suitable for applications that need full control of storage and operate at a low level on files
bypassing the file system</p>
</li>
<li>
<p>Also referred to as a Storage Area Network (SAN)</p>
</li>
<li>
<p>Non-shareable, which means that only one client at a time can mount an endpoint of this type</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ceph RBD, OpenStack Cinder, AWS EBS, Azure Disk, GCE persistent disk, and VMware vSphere support dynamic persistent volume (PV) provisioning natively in OpenShift Enterprise. iSCSI, Fibre Channel, Ceph RBD, OpenStack Cinder, AWS EBS , Dell/EMC Scale.IO, VMware vSphere Volume, GCE Persistent Disk, Azure Disk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">File</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Presented to the OS as a file system export to be mounted</p>
</li>
<li>
<p>Also referred to as Network Attached Storage (NAS)</p>
</li>
<li>
<p>Concurrency, latency, file locking mechanisms, and other capabilities vary widely between protocols, implementations, vendors, and scales.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RHEL NFS, NetApp NFS <sup class="footnote" id="_footnote_netappnfs">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup>, Azure File, Vendor NFS, Azure File, AWS EFS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Accessible through a REST API endpoint</p>
</li>
<li>
<p>Configurable for use in the OpenShift Enterprise Registry</p>
</li>
<li>
<p>Applications must build their drivers into the application and/or container.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ceph Object Storage (RADOS Gateway), OpenStack Swift, Aliyun OSS, AWS S3, Google Cloud Storage, Azure Blob Storage</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Currently, CNS is not supported in OpenShift Enterprise 4.0.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="recommended-configurable-storage-technology-persistent-storage">Recommended configurable storage technology</h3>
<div class="paragraph">
<p>The following table summarizes the recommended and configurable storage
technologies for the given OpenShift Enterprise cluster application.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Recommended and configurable storage technology</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Storage type</th>
<th class="tableblock halign-left valign-top">ROX <sup class="footnote" id="_footnote_rox">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup></th>
<th class="tableblock halign-left valign-top">RWX <sup class="footnote" id="_footnote_rwx">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup></th>
<th class="tableblock halign-left valign-top">Registry</th>
<th class="tableblock halign-left valign-top">Scaled registry</th>
<th class="tableblock halign-left valign-top">Metrics</th>
<th class="tableblock halign-left valign-top">Logging</th>
<th class="tableblock halign-left valign-top">Apps</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes <sup class="footnote" id="_footnote_disk">[<a id="_footnoteref_8" class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configurable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not configurable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recommended</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recommended</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recommended</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">File</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configurable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configurable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configurable <sup class="footnote" id="_footnote_metrics-warning">[<a id="_footnoteref_9" class="footnote" href="#_footnotedef_9" title="View footnote.">9</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configurable <sup class="footnote" id="_footnote_logging-warning">[<a id="_footnoteref_10" class="footnote" href="#_footnotedef_10" title="View footnote.">10</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recommended</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recommended</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recommended</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not configurable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not configurable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not configurable <sup class="footnote" id="_footnote_object">[<a id="_footnoteref_11" class="footnote" href="#_footnotedef_11" title="View footnote.">11</a>]</sup></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>A scaled registry is an OpenShift Enterprise registry where three or more pod replicas are running.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_specific-application-storage-recommendations">Specific application storage recommendations</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Testing shows issues with using the NFS server on RHEL as storage backend for
the container image registry. This includes the OpenShift Container Registry and Quay, Cassandra
for metrics storage, and ElasticSearch for logging storage. Therefore, using NFS
to back PVs used by core services is not recommended.</p>
</div>
<div class="paragraph">
<p>Other NFS implementations on the marketplace might not have these issues.
Contact the individual NFS implementation vendor for more information on any
testing that was possibly completed against these OpenShift core components.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_registry">Registry</h5>
<div class="paragraph">
<p>In a non-scaled/high-availability (HA) OpenShift Enterprise registry cluster deployment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The preferred storage technology is object storage followed by block storage. The
storage technology does not need to support RWX access mode.</p>
</li>
<li>
<p>The storage technology must ensure read-after-write consistency. All NAS storage are not
recommended for OpenShift Enterprise Registry cluster deployment with production workloads.</p>
</li>
<li>
<p>While <code>hostPath</code> volumes are configurable for a non-scaled/HA OpenShift Enterprise Registry, they are not recommended for cluster deployment.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_scaled-registry">Scaled registry</h5>
<div class="paragraph">
<p>In a scaled/HA OpenShift Enterprise registry cluster deployment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The preferred storage technology is object storage. The storage technology must support RWX access mode and must ensure read-after-write consistency.</p>
</li>
<li>
<p>File storage and block storage are not recommended for a scaled/HA OpenShift Enterprise registry cluster deployment with production workloads.</p>
</li>
<li>
<p>All NAS storage are not recommended for OpenShift Enterprise Registry cluster
deployment with production workloads.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_metrics">Metrics</h5>
<div class="paragraph">
<p>In an OpenShift Enterprise hosted metrics cluster deployment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The preferred storage technology is block storage.</p>
</li>
<li>
<p>It is not recommended to use NAS storage for a hosted metrics cluster deployment with production workloads.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Testing shows issues with using the NFS server on RHEL as storage backend for
the container image registry. This includes the Cassandra for metrics storage.
Therefore, using NFS to back PVs used by core services is not recommended.</p>
</div>
<div class="paragraph">
<p>Other NFS implementations on the marketplace might not have these issues.
Contact the individual NFS implementation vendor for more information on any
testing that was possibly completed against these OpenShift core components.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_logging">Logging</h5>
<div class="paragraph">
<p>In an OpenShift Enterprise hosted logging cluster deployment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The preferred storage technology is block storage.</p>
</li>
<li>
<p>It is not recommended to use NAS storage for a hosted metrics cluster deployment with production workloads.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Testing shows issues with using the NFS server on RHEL as storage backend for
the container image registry. This includes ElasticSearch for logging storage.
Therefore, using NFS to back PVs used by core services is not recommended.</p>
</div>
<div class="paragraph">
<p>Other NFS implementations on the marketplace might not have these issues.
Contact the individual NFS implementation vendor for more information on any
testing that was possibly completed against these OpenShift core components.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_applications">Applications</h5>
<div class="paragraph">
<p>Application use cases vary from application to application, as described in the following examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Storage technologies that support dynamic PV provisioning have low mount time latencies, and are not tied
to nodes to support a healthy cluster.</p>
</li>
<li>
<p>Application developers are responsible for knowing and understanding the storage
requirements for their application, and how it works with the provided storage
to ensure that issues do not occur when an application scales or interacts
with the storage layer.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_other-specific-application-storage-recommendations">Other specific application storage recommendations</h4>
<div class="ulist">
<ul>
<li>
<p>OpenShift Enterprise Internal <strong>etcd</strong>: For the best etcd reliability, the lowest consistent latency storage technology is preferable.</p>
</li>
<li>
<p>OpenStack Cinder: OpenStack Cinder tends to be adept in ROX access mode use cases.</p>
</li>
<li>
<p>Databases: Databases (RDBMSs, NoSQL DBs, etc.) tend to perform best with dedicated block storage.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="optimizing-routing">Optimizing routing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The OpenShift Enterprise HAProxy router scales to optimize performance.</p>
</div>
<div class="sect2">
<h3 id="baseline-router-performance-routing-optimization">Baseline router performance</h3>
<div class="paragraph">
<p>The OpenShift Enterprise router is the ingress point for all external traffic
destined for OpenShift Enterprise services.</p>
</div>
<div class="paragraph">
<p>When evaluating a single HAProxy router performance in terms of
HTTP requests handled per second, the performance varies depending
on many factors. In particular:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTTP keep-alive/close mode</p>
</li>
<li>
<p>route type</p>
</li>
<li>
<p>TLS session resumption client support</p>
</li>
<li>
<p>number of concurrent connections per target route</p>
</li>
<li>
<p>number of target routes</p>
</li>
<li>
<p>back end server page size</p>
</li>
<li>
<p>underlying infrastructure (network/SDN solution, CPU, and so on)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Router sharding should be used to serve more routes towards applications and
help horizontally scale the routing tier.</p>
</div>
</div>
<div class="sect2">
<h3 id="router-performance-optimizations-routing-optimization">Router performance optimizations</h3>
<div class="paragraph">
<p><strong>Setting the maximum number of connections</strong></p>
</div>
<div class="paragraph">
<p>One of the most important tunable parameters for HAProxy scalability is the
<code>maxconn</code> parameter, which sets the maximum per-process number of concurrent
connections to a given number. Adjust this parameter by editing the
<code>ROUTER_MAX_CONNECTIONS</code> environment variable in the OpenShift Enterprise HAProxy
router&#8217;s deployment configuration file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>A connection includes the front end and internal back end. This counts as two
connections. Be sure to set <code>ROUTER_MAX_CONNECTIONS</code> to double than the number
of connections you intend to create.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>CPU and interrupt affinity</strong></p>
</div>
<div class="paragraph">
<p>In OpenShift Enterprise, the HAProxy router runs as a single process. The
OpenShift Enterprise HAProxy router typically performs better on a system with fewer
but high frequency cores, rather than on an symmetric multiprocessing (SMP)
system with a high number of lower frequency cores.</p>
</div>
<div class="paragraph">
<p>Pinning the HAProxy process to one CPU core and the network interrupts to
another CPU core tends to increase network performance. Having processes and
interrupts on the same non-uniform memory access (NUMA) node helps avoid memory
accesses by ensuring a shared L3 cache. However, this level of control is
generally not possible on a public cloud environment.</p>
</div>
<div class="paragraph">
<p>CPU pinning is performed either by <code>taskset</code> or by using HAProxy&#8217;s <code>cpu-map</code>
parameter. This directive takes two arguments: the process ID and the CPU core
ID. For example, to pin HAProxy process <code>1</code> onto CPU core <code>0</code>, add the following
line to the global section of HAProxy&#8217;s configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    cpu-map 1 0</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Increasing the number of threads</strong></p>
</div>
<div class="paragraph">
<p>The HAProxy router comes with support for multithreading in OpenShift Enterprise. On
a multiple CPU core system, increasing the number of threads can help the
performance, especially when terminating SSL on the router.</p>
</div>
<div class="paragraph">
<p><strong>Impacts of buffer increases</strong></p>
</div>
<div class="paragraph">
<p>The OpenShift Enterprise HAProxy router request buffer configuration limits the size
of headers in incoming requests and responses from applications. The HAProxy
parameter <code>tune.bufsize</code> can be increased to allow processing of larger headers
and to allow applications with very large cookies to work, such as those
accepted by load balancers provided by many public cloud providers. However,
this affects the total memory use, especially when large numbers of connections
are open. With very large numbers of open connections, the memory usage will be
nearly proportionate to the increase of this tunable parameter.</p>
</div>
<div class="paragraph">
<p><strong>Optimizations for HAProxy reloads</strong></p>
</div>
<div class="paragraph">
<p>Long-lasting connections, such as WebSocket connections, combined with
long client/server HAProxy timeouts and short HAProxy
reload intervals, can cause instantiation of many HAProxy processes.
These processes must handle old connections, which were started
before the HAProxy configuration reload. A large number of these processes is
undesirable, as it will exert unnecessary load on the system and can
lead to issues, such as out of memory conditions.</p>
</div>
<div class="paragraph">
<p>Router environment variables affecting this
behavior are <code>ROUTER_DEFAULT_TUNNEL_TIMEOUT</code>, <code>ROUTER_DEFAULT_CLIENT_TIMEOUT</code>,
<code>ROUTER_DEFAULT_SERVER_TIMEOUT</code>, and <code>RELOAD_INTERVAL</code> in particular.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Clusters with more than the stated limit are not supported. Consider splitting into multiple clusters.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. The pod count displayed here is the number of test pods. The actual number of pods depends on the applications memory, CPU, and storage requirements.
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. There are a number of control loops in the system that need to iterate over all objects in a given namespace as a reaction to some changes in state. Having a large number of objects of a given type in a single namespace can make those loops expensive and slow down processing given state changes.
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. Each service port and each service back-end has a corresponding entry in iptables. The number of back-ends of a given service impact the size of the endpoints objects, which impacts the size of data that is being sent all over the system.
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. NetApp NFS supports dynamic PV provisioning when using the Trident plug-in.
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. ReadOnlyMany
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. ReadWriteMany
</div>
<div class="footnote" id="_footnotedef_8">
<a href="#_footnoteref_8">8</a>. This does not apply to physical disk, VM physical disk, VMDK, loopback over NFS, AWS EBS, and Azure Disk.
</div>
<div class="footnote" id="_footnotedef_9">
<a href="#_footnoteref_9">9</a>. For metrics, it is an anti-pattern to use any shared storage and a single volume (RWX). By default, metrics deploys with one volume per Cassandra Replica.
</div>
<div class="footnote" id="_footnotedef_10">
<a href="#_footnoteref_10">10</a>. For logging, using any shared storage would be an anti-pattern. One volume per elasticsearch is required.
</div>
<div class="footnote" id="_footnotedef_11">
<a href="#_footnoteref_11">11</a>. Object storage is not consumed through OpenShift Enterprise&#8217;s PVs/persistent volume claims (PVCs). Apps must integrate with the object storage REST API.
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-04-12 23:56:12 UTC
</div>
</div>
</body>
</html>
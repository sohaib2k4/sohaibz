<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Images</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Images</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="configuring-the-samples-operator">Configuring the Samples Operator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Samples Operator, which operates in the OpenShift namespace, installs and
updates the out of box imagestreams and templates provided with
OpenShift Enterprise. It also creates and manages the <code>imageimport</code> secret needed to
access the registry used by the samples.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Deploy an OpenShift Enterprise cluster.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="samples-operator-overview-configuring-samples-operator">Understanding the Samples Operator</h3>
<div class="paragraph">
<p>On initial startup, the operator creates the default configuration object for
itself and then creates the sample imagestreams and templates. The imagestreams
are RHEL OpenShift Enterprise based and point to images on registry.redhat.io. The
templates are those categorized as OpenShift Enterprise Templates. It also copies the
pull secret captured by the installation into the OpenShift namespace with the
name <code>samples-registry-credentials</code> to facilitate imagestream imports. A cluster
administrator can create any additional secrets containing the content of a
Docker <code>config.json</code> in the OpenShift namespace as needed to facilitate image
import.</p>
</div>
<div class="paragraph">
<p>The Samples Operator configuration is a cluster-wide resource, and the deployment
is contained within the <code>openshift-cluster-samples-operator</code> namespace.</p>
</div>
<div class="paragraph">
<p>The image for the Samples Operator contains imagestream and template definitions
for the associated OpenShift release. When each sample is created or updated,
the Samples Operator includes an annotation that denotes the version of
OpenShift Enterprise. The operator uses this annotation to ensure that each sample
matches the release version. Samples outside of its inventory are ignored, as
are skipped samples. Modifications to any samples that are managed by the
operator, where that version annotation is modified or deleted, will be reverted
automatically. The Jenkins images are actually part of the image payload from
installation and are tagged into the imagestreams directly.</p>
</div>
<div class="paragraph">
<p>The Samples Operator configuration resource includes a finalizer which cleans up
the following upon deletion:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Operator managed imagestreams.</p>
</li>
<li>
<p>Operator managed templates.</p>
</li>
<li>
<p>Operator generated configuration resources.</p>
</li>
<li>
<p>Cluster status resources.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Upon deletion of the samples resource, the Samples Operator recreates the
resource using the default configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="samples-operator-configuration-configuring-samples-operator">Samples Operator configuration</h3>
<div class="paragraph">
<p>The samples resource offers the following configuration fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Management State:</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Managed.</strong> The Samples Operator updates the samples as the configuration
dictates.</p>
</li>
<li>
<p><strong>Unmanaged.</strong> The Samples Operator ignores updates to its configuration
resource object and any imagestreams or templates in the OpenShift namespace.</p>
</li>
<li>
<p><strong>Removed.</strong> The Samples Operator removes the set of <code>Managed</code> imagestreams
and templates in the OpenShift namespace. It ignores new samples created by the
cluster administrator or any samples in the skipped lists. After the removals are
complete, the Samples Operator works like it is in the <code>Unmanaged</code> state and ignores
any watch events on the sample resources, imagestreams, or templates.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Neither deletion nor setting the <code>Management State</code> to <code>Removed</code> are completed
while imagestream imports are still in progress. Once progress has completed,
either in success or in error, the deletion or removal commences.</p>
</div>
<div class="paragraph">
<p>Secret, imagestream, and template watch events are ignored once deletion or
removal has started.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Samples Registry:</strong> Overrides the registry from which images are imported.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Creation or update of RHEL content does not commence if the secret for pull
access is not in place when either <code>Samples Registry</code> is not explicitly set (i.e.,
the empty string), or when it is set to registry.redhat.io. In both cases, image
imports will work off of registry.redhat.io, which requires credentials.</p>
</div>
<div class="paragraph">
<p>Creation or update of RHEL content is not gated by the existence of the pull
secret if the <code>Samples Registry</code> is overridden to a value other than the empty
string or registry.redhat.io.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>Architectures:</strong> Place holder to choose an architecture type. Currently only x86
is supported.</p>
</li>
<li>
<p><strong>Skipped Imagestreams:</strong> Imagestreams that are in the Samples Operator’s
inventory, but that the cluster administrator wants the operator to ignore or not manage.</p>
</li>
<li>
<p><strong>Skipped Templates:</strong> Templates that are in the Samples Operator&#8217;s inventory, but that
the cluster administrator wants the operator to ignore or not manage.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Secret, imagestream, and template watch events can come in before the initial
samples resource object is created, the Samples Operator detects and re-queues the
event.</p>
</div>
<div class="sect3">
<h4 id="_configuration-restrictions">Configuration restrictions</h4>
<div class="paragraph">
<p>When the Samples Operator starts supporting multiple architectures, the
architecture list is not allowed to be changed while in the <code>Managed</code> state.</p>
</div>
<div class="paragraph">
<p>In order to change the architectures values, a cluster administrator must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mark the <code>Management State</code> as <code>Removed</code>, saving the change.</p>
</li>
<li>
<p>In a subsequent change, edit the architecture and change the <code>Management State</code>
back to <code>Managed</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Samples Operator still processes secrets while in <code>Removed</code> state. You can
create the secret before switching to <code>Removed</code>, while in <code>Removed</code> before
switching to <code>Managed</code>, or after switching to <code>Managed</code> state (though there are
delays in creating the samples until the secret event is processed if you create
the secret after switching to <code>Managed</code>). This is done to help facilitate the
changing of the registry, where you choose to remove all the samples before
switching to insure a clean slate (removing before switching is not required).</p>
</div>
</div>
<div class="sect3">
<h4 id="_conditions">Conditions</h4>
<div class="paragraph">
<p>The samples resource maintains the following conditions in its status:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>SamplesExists.</strong> Indicates the samples are created in the OpenShift
namespace.</p>
</li>
<li>
<p><strong>ImageChangesInProgress.</strong></p>
<div class="ulist">
<ul>
<li>
<p><code>True</code> when imagestreams are created/updated, but
not all of the tag spec generations and tag status generations match.</p>
</li>
<li>
<p><code>False</code> when all of the generations match, or unrecoverable errors occurred during
import, the last seen error is in the message field. The list of pending
imagestreams is in the reason field.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>ImportCredentialsExist.</strong> A 'samples-registry-credentials' secret is
copied into the OpenShift namespace.</p>
</li>
<li>
<p><strong>ConfigurationValid.</strong> <code>True</code> or <code>false</code> based on whether any of the restricted
changes noted previously are submitted.</p>
</li>
<li>
<p><strong>RemovePending.</strong> Indicator that there is a`Management State` <code>Removed</code> setting
pending, but are waiting for in progress imagestreams to complete.</p>
</li>
<li>
<p><strong>ImportImageErrorsExist.</strong> Indicator of which imagestreams had errors during
the image import phase for one of their tags.</p>
<div class="ulist">
<ul>
<li>
<p><code>True</code> when an error has occurred. The list of imagestreams with an error is
in the reason field. The details of each error reported are in the
message field.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>MigrationInProgress.</strong> <code>True</code> when the Samples Operator detects that the
version is different than the Samples Operator version with which the current
samples set are installed.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-resource-overview-configuring-samples-operator">About Configuration Resources in OpenShift Enterprise</h3>
<div class="paragraph">
<p>You perform many customization and configuration tasks after you deploy your
cluster, including configuring networking and setting your identity provider.</p>
</div>
<div class="paragraph">
<p>In OpenShift Enterprise, you modify Configuration Resources to determine the behavior
of these integrations. The Configuration Resources are controlled by Operators
that are managed by the Cluster Version Operator, which manages all of the
Operators that run your cluster&#8217;s control plane.</p>
</div>
<div class="paragraph">
<p>You can customize the following Configuration Resources:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 72.7273%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration Resource</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Authentication</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>DNS</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Samples</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><strong>ManagementState:</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Managed.</strong> The operator updates the samples as the configuration dictates.</p>
</li>
<li>
<p><strong>Unmanaged.</strong> The operator ignores updates to the samples resource object and
any imagestreams or templates in the OpenShift namespace.</p>
</li>
<li>
<p><strong>Removed.</strong> The operator removes the set of managed imagestreams
and templates in the OpenShift namespace. It ignores new samples created by
the cluster administrator or any samples in the skipped lists. After the removals are
complete, the operator works like it is in the <code>Unmanaged</code> state and ignores
any watch events on the sample resources, imagestreams, or templates. It
operates on secrets to facilitate the CENTOS to RHEL switch. There are some
caveats around concurrent create and removal.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Samples Registry:</strong> Overrides the registry from which images are imported.</p>
</li>
<li>
<p><strong>Architecture:</strong> Place holder to choose an architecture type. Currently only x86
is supported.</p>
</li>
<li>
<p><strong>Skipped Imagestreams:</strong> Imagestreams that are in the operator’s
inventory, but that the cluster administrator wants the operator to ignore or not manage.</p>
</li>
<li>
<p><strong>Skipped Templates:</strong> Templates that are in the operator’s inventory, but that
the cluster administrator wants the operator to ignore or not manage.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Infrastructure</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Ingress</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Network</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OAuth</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>While you can complete many other customizations and configure other integrations
with an OpenShift Enterprise cluster, configuring these resources is a common first
step after you deploy a cluster.</p>
</div>
<div class="paragraph">
<p>Like all Operators, the Configuration Resources are governed by
Custom Resource Definitions (CRD). You customize the CRD for each
Configuration Resource that you want to modify in your cluster.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding-containers">Understanding containers, images, and imagestreams</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Containers, images, and imagestreams are important concepts
to understand when you set out to create and manage containerized software.
An image holds a set of software that is ready to run,
while a container is a running instance of a container image.
An imagestream provides a way of storing different versions of the
same basic image. Those different versions are represented by different
tags on the same image name.</p>
</div>
<div class="sect2">
<h3 id="images-about-images-understand">Images</h3>
<div class="paragraph">
<p>Containers in OpenShift Enterprise are based on OCI- or
Docker-formatted container <em>images</em>. An image is a
binary that includes all of the requirements for running a single
container, as well as metadata describing its needs and capabilities.</p>
</div>
<div class="paragraph">
<p>You can think of it as a packaging technology. Containers only have access to
resources defined in the image unless you give the container additional access
when creating it. By deploying the same image in multiple containers across
multiple hosts and load balancing between them, OpenShift Enterprise can provide
redundancy and horizontal scaling for a service packaged into an image.</p>
</div>
<div class="paragraph">
<p>You can use the
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux_atomic_host/7/html-single/managing_containers/#using_podman_to_work_with_containers">podman</a>
or <code>docker</code> CLI directly to build images, but OpenShift Enterprise also supplies
builder images that assist with creating new images by adding your code or
configuration to existing images.</p>
</div>
<div class="paragraph">
<p>Because applications develop over time, a single image name can actually
refer to many different versions of the same image. Each different
image is referred to uniquely by its hash (a long hexadecimal number
e.g., <code>fd44297e2ddb050ec4f&#8230;&#8203;</code>) which is usually shortened to 12
characters (e.g., <code>fd44297e2ddb</code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="containers-about-images-understand">Containers</h3>
<div class="paragraph">
<p>The basic units of OpenShift Enterprise applications are called <em>containers</em>.
<a href="https://access.redhat.com/articles/1353593">Linux container technologies</a>
are lightweight mechanisms for isolating running processes so that they are
limited to interacting with only their designated resources. The word
container is defined as a specific running or paused instance of a container
image.</p>
</div>
<div class="paragraph">
<p>Many application instances can be running in containers on a single host without
visibility into each others' processes, files, network, and so on. Typically,
each container provides a single service, often called a micro-service, such
as a web server or a database, though containers can be used for arbitrary
workloads.</p>
</div>
<div class="paragraph">
<p>The Linux kernel has been incorporating capabilities for container technologies
for years. The Docker project developed a convenient management interface for
Linux containers on a host. More recently, the
<a href="https://github.com/opencontainers/">Open Container Initiative</a> has developed
open standards for container formats and container runtimes. OpenShift Enterprise and
Kubernetes add the ability to orchestrate OCI- and Docker-formatted containers
across multi-host installations.</p>
</div>
<div class="paragraph">
<p>Though you do not directly interact with container runtimes when using
OpenShift Enterprise, understanding their capabilities and terminology is
important for understanding their role in OpenShift Enterprise and how your
applications function inside of containers.</p>
</div>
<div class="paragraph">
<p>Tools such as
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux_atomic_host/7/html-single/managing_containers/#using_podman_to_work_with_containers">podman</a>
can be used to replace <code>docker</code> command-line tools for running and managing
containers directly. Using <code>podman</code>, you can experiment with containers
separately from OpenShift Enterprise.</p>
</div>
</div>
<div class="sect2">
<h3 id="images-image-registry-about-images-understand">Image registry</h3>
<div class="paragraph">
<p>An <strong>image registry</strong> is a content server that can store and serve
container images. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">registry.redhat.io</pre>
</div>
</div>
<div class="paragraph">
<p>A registry contains a collection of one or more image repositories, which
contain one or more tagged images. Red Hat provides a registry at
<code>registry.redhat.io</code> for subscribers. OpenShift Enterprise can also supply its own
internal registry for managing custom container images.</p>
</div>
</div>
<div class="sect2">
<h3 id="images-container-repository-about-images-understand">Image repository</h3>
<div class="paragraph">
<p>An <strong>image repository</strong> is a collection of related container images and tags identifying them. For example, the OpenShift Jenkins images are in the repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">docker.io/openshift/jenkins-2-centos7</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="images-tag-about-images-understand">Image tags</h3>
<div class="paragraph">
<p>An image tag is a label applied to a container image in a repository that
distinguishes a specific image from other images in an imagestream. Typically,
the tag represents a version number of some sort. For example, here v3.11.59-2
is the tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">registry.access.redhat.com/openshift3/jenkins-2-rhel7:v3.11.59-2</pre>
</div>
</div>
<div class="paragraph">
<p>You can add additional tags to an image. For example, an image might be assigned
the tags :v3.11.59-2 and :latest.</p>
</div>
</div>
<div class="sect2">
<h3 id="images-id-images-understand">Image IDs</h3>
<div class="paragraph">
<p>An image ID is a SHA (Secure Hash Algorithm) code that can be used to
pull an image. A SHA image ID cannot change. A specific SHA identifier always
references the exact same container image content.  For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">docker.io/openshift/jenkins-2-centos7@sha256:ab312bda324</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="images-imagestream-use-images-understand">Using imagestreams</h3>
<div class="paragraph">
<p>An imagestream and its associated tags provide an abstraction for referencing
container images from within OpenShift Enterprise. The imagestream and its tags
allow you to see what images are available and ensure that you are using the
specific image you need even if the image in the repository changes.</p>
</div>
<div class="paragraph">
<p>imagestreams do not contain actual image data, but present a single virtual
view of related images, similar to an image repository.</p>
</div>
<div class="paragraph">
<p>You can  configure Builds and Deployments to watch an imagestream for
notifications when new images are added and react by performing a Build or
Deployment, respectively.</p>
</div>
<div class="paragraph">
<p>For example, if a Deployment is using a certain image and a new version of that
image is created, a Deployment could be automatically performed to pick up the
new version of the image.</p>
</div>
<div class="paragraph">
<p>However, if the imagestream tag used by the Deployment or Build is not updated,
then even if the container image in the container image registry is updated, the
Build or Deployment will continue using the previous, presumably known good
image.</p>
</div>
<div class="paragraph">
<p>The source images can be stored in any of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OpenShift Enterprise&#8217;s integrated registry.</p>
</li>
<li>
<p>An external registry, for example <code>registry.redhat.io</code> or <code>hub.docker.com</code>.</p>
</li>
<li>
<p>Other imagestreams in the OpenShift Enterprise cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you define an object that references an imagestream tag (such as a Build
or Deployment configuration), you point to an imagestream tag, not the Docker
repository. When you Build or Deploy your application, OpenShift Enterprise queries
the Docker repository using the imagestream tag to locate the associated ID of
the image and uses that exact image.</p>
</div>
<div class="paragraph">
<p>The imagestream metadata is stored in the etcd instance along with other
cluster information.</p>
</div>
<div class="paragraph">
<p>Using imagestreams has several significant benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can tag, rollback a tag, and quickly deal with images, without having to
re-push using the command line.</p>
</li>
<li>
<p>You can trigger Builds and Deployments when a new image is pushed to the
registry. Also, OpenShift Enterprise has generic triggers for other resources, such
as Kubernetes objects.</p>
</li>
<li>
<p>You can mark a tag for periodic re-import. If the source image has changed, that
change is picked up and reflected in the imagestream, which triggers the Build
and/or Deployment flow, depending upon the Build or Deployment configuration.</p>
</li>
<li>
<p>You can share images using fine-grained access control and quickly distribute
images across your teams.</p>
</li>
<li>
<p>If the source image changes, the imagestream tag will still point to a
known-good version of the image, ensuring that your application will not break
unexpectedly.</p>
</li>
<li>
<p>You can configure security around who can view and use the images through
permissions on the imagestream objects.</p>
</li>
<li>
<p>Users that lack permission to read or list images on the cluster level can still
retrieve the images tagged in a project using imagestreams.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="images-imagestream-tag-images-understand">Imagestream tags</h4>
<div class="paragraph">
<p>An imagestream tag is a named pointer to an image in an imagestream. An image
stream tag is similar to a container image tag.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="image-stream-image-about-images-understand">Imagestream images</h3>
<div class="paragraph">
<p>An imagestream image allows you to retrieve a specific
container image from a particular imagestream where it is tagged. An image
stream image is an API resource object that pulls together some metadata about a
particular image SHA identifier.</p>
</div>
</div>
<div class="sect2">
<h3 id="image-stream-trigger-images-understand">Imagestream triggers</h3>
<div class="paragraph">
<p>An imagestream trigger causes a specific action when an imagestream tag
changes. For example, importing can cause the value of the tag to change, which
causes a trigger to fire when there are Deployments, Builds, or other resources
listening for those.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information on using imagestreams, see
xref../image-streams-manage.adoc#image-streams-managing[Managing image
streams].</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-images">Creating images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Learn how to create your own container images, based on pre-built images that are ready to help you.
The process includes learning best practices for writing images,
defining metadata for images, testing images and using a custom builder workflow to create images
 that can be used on
OpenShift Enterprise.
Once you have created an image, you can push it to
the internal registry.</p>
</div>
<div class="sect2">
<h3 id="images-create-guidelines-create-images">Learning container best practices</h3>
<div class="paragraph">
<p>When creating container images to run on OpenShift Enterprise
there are a number of best
practices to consider as an image author to ensure a good experience for
consumers of those images. Because images are intended to be immutable and used
as-is, the following guidelines help ensure that your images are highly
consumable and easy to use on OpenShift Enterprise.</p>
</div>
<div class="sect3">
<h4 id="images-create-guide-general-create-images">General container image guidelines</h4>
<div class="paragraph">
<p>The following guidelines apply when creating a container image in general, and are
independent of whether the images are used on OpenShift Enterprise.</p>
</div>
<h5 id="_reuse-images" class="discrete">Reuse images</h5>
<div class="paragraph">
<p>Wherever possible, we recommend that you base your image on an appropriate
upstream image using the <code>FROM</code> statement. This ensures your image can easily
pick up security fixes from an upstream image when it is updated, rather than
you having to update your dependencies directly.</p>
</div>
<div class="paragraph">
<p>In addition, use tags in the <code>FROM</code> instruction (for example,  <code>rhel:rhel7</code>) to
make it clear to users exactly which version of an image your image is based on.
Using a tag other than <code>latest</code> ensures your image is not subjected to breaking
changes that might go into the <code>latest</code> version of an upstream image.</p>
</div>
<h5 id="_maintain-compatibility-within-tags" class="discrete">Maintain compatibility within tags</h5>
<div class="paragraph">
<p>When tagging your own images, we recommend that you try to maintain backwards
compatibility within a tag. For example, if you provide an image named
<em>foo</em> and it currently includes version 1.0, you might provide a tag of
<em>foo:v1</em>. When you update the image, as long as it continues to be compatible
with the original image, you can continue to tag the new image <em>foo:v1</em>, and
downstream consumers of this tag will be able to get updates without being
broken.</p>
</div>
<div class="paragraph">
<p>If you later release an incompatible update, then you should switch to a new
tag, for example <em>foo:v2</em>. This allows downstream consumers to move up to the
new version at will, but not be inadvertently broken by the new incompatible
image. Any downstream consumer using <em>foo:latest</em> takes on the risk of any
incompatible changes being introduced.</p>
</div>
<h5 id="_avoid-multiple-processes" class="discrete">Avoid multiple processes</h5>
<div class="paragraph">
<p>We recommend that you do not start multiple services, such as a database and
<strong>SSHD</strong>, inside one container. This is not necessary because containers
are lightweight and can be easily linked together for orchestrating multiple
processes. OpenShift Enterprise allows you to easily colocate and co-manage related images
by grouping them into a single pod.</p>
</div>
<div class="paragraph">
<p>This colocation ensures the containers share a network namespace and storage
for communication. Updates are also less disruptive as each image can be updated
less frequently and independently. Signal handling flows are also clearer with a
single process as you do not need to manage routing signals to spawned
processes.</p>
</div>
<h5 id="_use-exec-in-wrapper-scripts" class="discrete">Use <code>exec</code> in wrapper scripts</h5>
<div class="paragraph">
<p>Many images use wrapper scripts to do some setup before starting a process for the software being run. If your image uses such a script, that script should use <code>exec</code> so that the script’s process is replaced by your software. If you do not use <code>exec</code>, then signals sent by your container runtime will go to your wrapper script instead of your software’s process. This is not what you want, as illustrated here:</p>
</div>
<div class="paragraph">
<p>Say you have a wrapper script that starts a process for some server. You start your container (for example, using <code>podman run -i</code>), which runs the wrapper script, which in turn starts your process. Now say that you want to kill your container with <code>CTRL+C</code>. If your wrapper script used exec to start the server process, <code>podman</code> will send SIGINT to the server process, and everything will work as you expect. If you didn’t use exec in your wrapper script, <code>podman</code> will send SIGINT to the process for the wrapper script and your process will keep running like nothing happened.</p>
</div>
<div class="paragraph">
<p>Also note that your process runs as PID 1 when running in a container.
This means that if your main process terminates, the entire container is
stopped, killing any child processes you may have launched from your PID 1
process.</p>
</div>
<div class="paragraph">
<p>See the
<a href="http://blog.phusion.nl/2015/01/20/docker-and-the-pid-1-zombie-reaping-problem/">"Docker
and the PID 1 zombie reaping problem"</a> blog article for additional implications.
Also see the <a href="https://felipec.wordpress.com/2013/11/04/init/">"Demystifying the
init system (PID 1)"</a> blog article for a deep dive on PID 1 and <strong>init</strong>
systems.</p>
</div>
<h5 id="_clean-temporary-files" class="discrete">Clean temporary files</h5>
<div class="paragraph">
<p>All temporary files you create during the build process should be removed. This
also includes any files added with the <code>ADD</code> command.  For example, we strongly
recommended that you run the <code>yum clean</code> command after performing <code>yum install</code>
operations.</p>
</div>
<div class="paragraph">
<p>You can prevent the <code>yum</code> cache from ending up in an image layer by creating
your <code>RUN</code> statement as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">RUN yum -y install mypackage &amp;&amp; yum -y install myotherpackage &amp;&amp; yum clean all -y</pre>
</div>
</div>
<div class="paragraph">
<p>Note that if you instead write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">RUN yum -y install mypackage
RUN yum -y install myotherpackage &amp;&amp; yum clean all -y</pre>
</div>
</div>
<div class="paragraph">
<p>Then the first <code>yum</code> invocation leaves extra files in that layer, and these
files cannot be removed when the <code>yum clean</code> operation is run later. The extra
files are not visible in the final image, but they are present in the underlying
layers.</p>
</div>
<div class="paragraph">
<p>The current container build process does not allow a command run in a later layer
to shrink the space used by the image when something was removed in an earlier
layer. However, this may change in the future. This means that if you perform an
<code>rm</code> command in a later layer, although the files are hidden it does not reduce
the overall size of the image to be downloaded. Therefore, as with the <code>yum
clean</code> example, it is best to remove files in the same command that created
them, where possible, so they do not end up written to a layer.</p>
</div>
<div class="paragraph">
<p>In addition, performing multiple commands in a single <code>RUN</code> statement reduces
the number of layers in your image, which improves download and extraction time.</p>
</div>
<h5 id="_place-instructions-in-the-proper-order" class="discrete">Place instructions in the proper order</h5>
<div class="paragraph">
<p>The container builder reads the <code>Dockerfile</code> and runs the instructions from top to
bottom. Every instruction that is successfully executed creates a layer which
can be reused the next time this or another image is built. It is very important
to place instructions that will rarely change at the top of your
<code>Dockerfile</code>. Doing so ensures the next builds of the same image are
very fast because the cache is not invalidated by upper layer changes.</p>
</div>
<div class="paragraph">
<p>For example, if you are working on a <code>Dockerfile</code> that contains an <code>ADD</code>
command to install a file you are iterating on, and a <code>RUN</code> command to <code>yum
install</code> a package, it is best to put the <code>ADD</code> command last:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">FROM foo
RUN yum -y install mypackage &amp;&amp; yum clean all -y
ADD myfile /test/myfile</pre>
</div>
</div>
<div class="paragraph">
<p>This way each time you edit <strong><em>myfile</em></strong> and rerun <code>podman build</code> or <code>docker build</code>, the system reuses
the cached layer for the <code>yum</code> command and only generates the new layer for the
<code>ADD</code> operation.</p>
</div>
<div class="paragraph">
<p>If instead you wrote the <code>Dockerfile</code> as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">FROM foo
ADD myfile /test/myfile
RUN yum -y install mypackage &amp;&amp; yum clean all -y</pre>
</div>
</div>
<div class="paragraph">
<p>Then each time you changed <strong><em>myfile</em></strong> and reran <code>podman build</code> or <code>docker build</code>, the <code>ADD</code>
operation would invalidate the <code>RUN</code> layer cache, so the <code>yum</code> operation would
need to be rerun as well.</p>
</div>
<h5 id="_mark-important-ports" class="discrete">Mark important ports</h5>
<div class="paragraph">
<p>The EXPOSE instruction makes a port in the container available to the host system and other containers. While it is possible to specify that a port should be exposed with a <code>podman run</code> invocation, using the EXPOSE instruction in a <code>Dockerfile</code> makes it easier for both humans and software to use your image by explicitly declaring the ports your software needs to run:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Exposed ports will show up under <code>podman ps</code> associated with containers created from your image</p>
</li>
<li>
<p>Exposed ports will also be present in the metadata for your image returned by <code>podman inspect</code></p>
</li>
<li>
<p>Exposed ports will be linked when you link one container to another</p>
</li>
</ul>
</div>
<h5 id="_set-environment-variables" class="discrete">Set environment variables</h5>
<div class="paragraph">
<p>It is good practice to set environment variables with the <code>ENV</code> instruction.
One example is to set the version of your project. This makes it easy for people
to find the version without looking at the <code>Dockerfile</code>. Another example is
advertising a path on the system that could be used by another process, such as
<code><strong>JAVA_HOME</strong></code>.</p>
</div>
<h5 id="_avoid-default-passwords" class="discrete">Avoid default passwords</h5>
<div class="paragraph">
<p>It is best to avoid setting default passwords. Many people will extend the image
and forget to remove or change the default password. This can lead to security
issues if a user in production is assigned a well-known password. Passwords
should be configurable using an environment variable instead.</p>
</div>
<div class="paragraph">
<p>If you do choose to set a default password, ensure that an appropriate warning
message is displayed when the container is started. The message should inform
the user of the value of the default password and explain how to change it, such
as what environment variable to set.</p>
</div>
<h5 id="_avoid-sshd" class="discrete">Avoid sshd</h5>
<div class="paragraph">
<p>It is best to avoid running <strong>sshd</strong> in your image. You can use the <code>podman exec</code> or <code>docker exec</code>
command to access containers that are running on the local host. Alternatively,
you can use the <code>oc exec</code> command or the <code>oc rsh</code>
command to access containers that are running on the OpenShift Enterprise cluster.
Installing and running <strong>sshd</strong> in your image opens up additional vectors for
attack and requirements for security patching.</p>
</div>
<h5 id="_use-volumes-for-persistent-data" class="discrete">Use volumes for persistent data</h5>
<div class="paragraph">
<p>Images should use a <a href="https://docs.docker.com/reference/builder/#volume">volume</a> for persistent data. This way OpenShift Enterprise mounts the network storage
to the node running the container, and if the container moves to a new node the
storage is reattached to that node. By using the volume for all persistent
storage needs, the content is preserved even if the container is restarted or
moved. If your image writes data to arbitrary locations within the container,
that content might not be preserved.</p>
</div>
<div class="paragraph">
<p>All data that needs to be preserved even after the container is destroyed must
be written to a volume.  Container engines support a <code>readonly</code> flag for
containers which can be used to strictly enforce good practices about not
writing data to ephemeral storage in a container. Designing your image around
that capability now will make it easier to take advantage of it later.</p>
</div>
<div class="paragraph">
<p>Furthermore, explicitly defining volumes in your <code>Dockerfile</code> makes it easy
for consumers of the image to understand what volumes they need to define when
running your image.</p>
</div>
<div class="paragraph">
<p>See the
<a href="https://kubernetes.io/docs/concepts/storage/volumes/">Kubernetes
documentation</a> for more information on how volumes are used in OpenShift Enterprise.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Even with persistent volumes, each instance of your image has its own
volume, and the filesystem is not shared between instances.  This means the
volume cannot be used to share state in a cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>Docker documentation - <a href="https://docs.docker.com/articles/dockerfile_best-practices/">Best practices for writing Dockerfiles</a></p>
</li>
<li>
<p>Project Atomic documentation - <a href="http://www.projectatomic.io/docs/docker-image-author-guidance/">Guidance for Container Image Authors</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="images-create-guide-openshift-create-images">OpenShift Enterprise-specific guidelines</h4>
<div class="paragraph">
<p>The following are guidelines that apply when creating container images specifically
for use on OpenShift Enterprise.</p>
</div>
<h5 id="_enable-images-for-source-to-image-s2i" class="discrete">Enable images for source-to-image (S2I)</h5>
<div class="paragraph">
<p>For images that are intended to run application code provided by a third party,
such as a Ruby image designed to run Ruby code provided by a developer, you can
enable your image to work with the
<a href="https://github.com/openshift/source-to-image">Source-to-Image (S2I)</a>  build tool.
S2I is a framework which makes it easy to write images that take application
source code as an input and produce a new image that runs the assembled
application as output.</p>
</div>
<div class="paragraph">
<p>For example, this <a href="https://github.com/sclorg/s2i-python-container">Python image</a>
defines S2I scripts for building various versions of Python applications.</p>
</div>
<h5 id="use-uid-create-images" class="discrete">Support arbitrary user ids</h5>
<div class="paragraph">
<p>By default, OpenShift Enterprise runs containers using an arbitrarily assigned user
ID. This provides additional security against processes escaping the container
due to a container engine vulnerability and thereby achieving escalated
permissions on the host node.</p>
</div>
<div class="paragraph">
<p>For an image to support running as an arbitrary user, directories and files that
may be written to by processes in the image should be owned by the root group
and be read/writable by that group. Files to be executed should also have group
execute permissions.</p>
</div>
<div class="paragraph">
<p>Adding the following to your Dockerfile sets the directory and file permissions
to allow users in the root group to access them in the built image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">RUN chgrp -R 0 /some/directory &amp;&amp; \
    chmod -R g=u /some/directory</pre>
</div>
</div>
<div class="paragraph">
<p>Because the container user is always a member of the root group, the container
user can read and write these files. The root group does not have any special
permissions (unlike the root user) so there are no security concerns with this
arrangement. In addition, the processes running in the container must not listen
on privileged ports (ports below 1024), since they are not running as a
privileged user.</p>
</div>
<div class="paragraph">
<p>Because the user ID of the container is generated dynamically, it will not have
an associated entry in <strong><em>/etc/passwd</em></strong>. This can cause problems for applications
that expect to be able to look up their user ID. One way to address this problem
is to dynamically create a <strong><em>passwd</em></strong> file entry with the container&#8217;s user ID as part
of the image&#8217;s start script. This is what a Dockerfile might include:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">RUN chmod g=u /etc/passwd
ENTRYPOINT [ "uid_entrypoint" ]
USER 1001</pre>
</div>
</div>
<div class="paragraph">
<p>Where <strong><em>uid_entrypoint</em></strong> contains:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">if ! whoami &amp;&gt; /dev/null; then
  if [ -w /etc/passwd ]; then
    echo "${USER_NAME:-default}:x:$(id -u):0:${USER_NAME:-default} user:${HOME}:/sbin/nologin" &gt;&gt; /etc/passwd
  fi
fi</pre>
</div>
</div>
<div class="paragraph">
<p>For a complete example of this, see
<a href="https://github.com/RHsyseng/container-rhel-examples/blob/master/starter-arbitrary-uid/Dockerfile">this Dockerfile</a>.</p>
</div>
<div class="paragraph">
<p>Lastly, the final <strong>USER</strong> declaration in the <code>Dockerfile</code> should specify the user
ID (numeric value) and not the user name. This allows OpenShift Enterprise to
validate the authority the image is attempting to run with and prevent running
images that are trying to run as root, because running containers as a
privileged user exposes potential security holes.
If the image does not specify a <strong>USER</strong>, it inherits the <strong>USER</strong>
from the parent image.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>If your S2I image does not include a <strong>USER</strong> declaration with a numeric user,
your builds will fail by default. In order to allow images that use either named
users or the root (<strong>0</strong>) user to build in OpenShift Enterprise, you can add the
project&#8217;s builder service account
(<strong>system:serviceaccount:&lt;your-project&gt;:builder</strong>) to the <strong>privileged</strong> security
context constraint (SCC). Alternatively, you can allow all images to
run as any user.</p>
</div>
</td>
</tr>
</table>
</div>
<h5 id="use-services-create-images" class="discrete">Use services for inter-image communication</h5>
<div class="paragraph">
<p>For cases where your image needs to communicate with a service provided by
another image, such as a web front end image that needs to access a database
image to store and retrieve data, your image should consume an OpenShift Enterprise
service.
Services provide a static endpoint for access which does not change as
containers are stopped, started, or moved. In addition, services provide load
balancing for requests.</p>
</div>
<h5 id="_provide-common-libraries" class="discrete">Provide common libraries</h5>
<div class="paragraph">
<p>For images that are intended to run application code provided by a third party,
ensure that your image contains commonly used libraries for your platform. In
particular, provide database drivers for common databases used with your
platform. For example, provide JDBC drivers for MySQL and PostgreSQL if you are
creating a Java framework image. Doing so prevents the need for common
dependencies to be downloaded during application assembly time, speeding up
application image builds. It also simplifies the work required by application
developers to ensure all of their dependencies are met.</p>
</div>
<h5 id="use-env-vars-create-images" class="discrete">Use environment variables for configuration</h5>
<div class="paragraph">
<p>Users of your image should be able to configure it without having to create a
downstream image based on your image. This means that the runtime configuration
should be handled using environment variables. For a simple configuration, the
running process can consume the environment variables directly. For a more
complicated configuration or for runtimes which do not support this, configure
the runtime by defining a template configuration file that is processed during
startup. During this processing, values supplied using environment variables can
be substituted into the configuration file or used to make decisions about what
options to set in the configuration file.</p>
</div>
<div class="paragraph">
<p>It is also possible and recommended to pass secrets such as certificates and
keys into the container using environment variables. This ensures that the
secret values do not end up committed in an image and leaked into a container image
registry.</p>
</div>
<div class="paragraph">
<p>Providing environment variables allows consumers of your image to customize
behavior, such as database settings, passwords, and performance tuning, without
having to introduce a new layer on top of your image. Instead, they can simply
define environment variable values when defining a pod and change those settings
without rebuilding the image.</p>
</div>
<div class="paragraph">
<p>For extremely complex scenarios, configuration can also be supplied using
volumes that would be mounted into the container at runtime. However, if you
elect to do it this way you must ensure that your image provides clear error
messages on startup when the necessary volume or configuration is not present.</p>
</div>
<div class="paragraph">
<p>This topic is related to the Using Services for Inter-image
Communication topic in that configuration like datasources should be defined in
terms of environment variables that provide the service endpoint information.
This allows an application to dynamically consume a datasource service that is
defined in the OpenShift Enterprise environment without modifying the application
image.</p>
</div>
<div class="paragraph">
<p>In addition, tuning should be done by inspecting the <strong>cgroups</strong> settings
for the container. This allows the image to tune itself to the available memory,
CPU, and other resources. For example, Java-based images should tune their heap
based on the <strong>cgroup</strong> maximum memory parameter to ensure they do not
exceed the limits and get an out-of-memory error.</p>
</div>
<div class="paragraph">
<p>See the following references for more on how to manage <strong>cgroup</strong> quotas
in containers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Blog article - <a href="https://goldmann.pl/blog/2014/09/11/resource-management-in-docker">Resource management in Docker</a></p>
</li>
<li>
<p>Docker documentation - <a href="https://docs.docker.com/engine/admin/runmetrics/">Runtime Metrics</a></p>
</li>
<li>
<p>Blog article - <a href="http://fabiokung.com/2014/03/13/memory-inside-linux-containers">Memory inside Linux containers</a></p>
</li>
</ul>
</div>
<h5 id="_set-image-metadata" class="discrete">Set image metadata</h5>
<div class="paragraph">
<p>Defining image metadata helps OpenShift Enterprise better consume your container images,
allowing OpenShift Enterprise to create a better experience for developers using your
image. For example, you can add metadata to provide helpful descriptions of your
image, or offer suggestions on other images that may also be needed.</p>
</div>
<h5 id="_clustering" class="discrete">Clustering</h5>
<div class="paragraph">
<p>You must fully understand what it means to run multiple instances of your image.
In the simplest case, the load balancing function of a service handles routing
traffic to all instances of your image.  However, many frameworks need to share
information in order to perform leader election or failover state; for example,
in session replication.</p>
</div>
<div class="paragraph">
<p>Consider how your instances accomplish this communication when running in
OpenShift Enterprise. Although pods can communicate directly with each other, their
IP addresses change anytime the pod starts, stops, or is moved. Therefore, it is
important for your clustering scheme to be dynamic.</p>
</div>
<h5 id="_logging" class="discrete">Logging</h5>
<div class="paragraph">
<p>It is best to send all logging to standard out. OpenShift Enterprise collects
standard out from containers and sends it to the centralized logging service
where it can be viewed. If you need to separate log content, prefix the output
with an appropriate keyword, which makes it possible to filter the messages.</p>
</div>
<div class="paragraph">
<p>If your image logs to a file, users must use manual operations to enter the
running container and retrieve or view the log file.</p>
</div>
<h5 id="_liveness-and-readiness-probes" class="discrete">Liveness and readiness probes</h5>
<div class="paragraph">
<p>Document example liveness and readiness probes that can be used with your image. These probes will allow
users to deploy your image with confidence that traffic will not be routed to
the container until it is prepared to handle it, and that the container will be
restarted if the process gets into an unhealthy state.</p>
</div>
<h5 id="_templates" class="discrete">Templates</h5>
<div class="paragraph">
<p>Consider providing an example template with
your image. A template will give users an easy way to quickly get your image
deployed with a working configuration. Your template should include the
liveness and readiness probes you documented with the image, for completeness.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.docker.com/engine/docker-overview/">Docker basics</a></p>
</li>
<li>
<p><a href="https://docs.docker.com/engine/reference/builder/">Dockerfile reference</a></p>
</li>
<li>
<p><a href="http://www.projectatomic.io/docs/docker-image-author-guidance">Project Atomic Guidance for Container Image Authors</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="images-create-metadata-create-images">Including metadata in images</h3>
<div class="paragraph">
<p>Defining image metadata helps OpenShift Enterprise better consume your container images,
allowing OpenShift Enterprise to create a better experience for developers using your
image. For example, you can add metadata to provide helpful descriptions of your
image, or offer suggestions on other images that may also be needed.</p>
</div>
<div class="paragraph">
<p>This topic only defines the metadata needed by the current set of use cases.
Additional metadata or use cases may be added in the future.</p>
</div>
<div class="sect3">
<h4 id="_defining-image-metadata">Defining image metadata</h4>
<div class="paragraph">
<p>You can use the <code>LABEL</code> instruction in a <code>Dockerfile</code> to define image
metadata. Labels are similar to environment variables in that they are key value
pairs attached to an image or a container. Labels are different from environment
variable in that they are not visible to the running application and they can
also be used for fast look-up of images and containers.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.docker.com/engine/reference/builder/#label">Docker
documentation</a> for more information on the <code>LABEL</code> instruction.</p>
</div>
<div class="paragraph">
<p>The label names should typically be namespaced. The namespace should be set
accordingly to reflect the project that is going to pick up the labels and use
them. For OpenShift Enterprise the namespace should be set to <strong><em>io.openshift</em></strong> and
for Kubernetes the namespace is <strong><em>io.k8s</em></strong>.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.docker.com/engine/userguide/labels-custom-metadata">Docker custom
metadata</a> documentation for details about the format.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Supported Metadata</caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 72.7273%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><strong>io.openshift.tags</strong></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This label contains a list of tags represented as list of comma-separated
string values. The tags are the way to categorize the container images into broad
areas of functionality. Tags help UI and generation tools to suggest relevant
container images during the application creation process.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>LABEL io.openshift.tags   mongodb,mongodb24,nosql</pre>
</div>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><strong>io.openshift.wants</strong></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies a list of tags that the generation tools and the UI might use to
provide relevant suggestions if you don&#8217;t have the container images with given tags
already. For example, if the container image wants <code>mysql</code> and <code>redis</code> and you
don&#8217;t have the container image with <code>redis</code> tag, then UI might suggest you to add
this image into your deployment.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>LABEL io.openshift.wants   mongodb,redis</pre>
</div>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><strong>io.k8s.description</strong></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This label can be used to give the container image consumers more detailed
information about the service or functionality this image provides. The UI can
then use this description together with the container image name to provide more
human friendly information to end users.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>LABEL io.k8s.description The MySQL 5.5 Server with master-slave replication support</pre>
</div>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><strong>io.openshift.non-scalable</strong></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An image might use this variable to suggest that it does not support scaling.
The UI will then communicate this to consumers of that image. Being not-scalable
basically means that the value of <code>replicas</code> should initially not be set higher
than 1.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>LABEL io.openshift.non-scalable     true</pre>
</div>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><strong>io.openshift.min-memory</strong></code> and <code><strong>io.openshift.min-cpu</strong></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This label suggests how much resources the container image might need in order to
work properly. The UI might warn the user that deploying this container image may
exceed their user quota. The values must be compatible with
Kubernetes quantity.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>LABEL io.openshift.min-memory 8Gi
LABEL io.openshift.min-cpu     4</pre>
</div>
</div>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="images-test-s2i-create-images">Testing S2I images</h3>
<div class="paragraph">
<p>As an Source-to-Image (S2I) builder image author, you can test your S2I image
locally and use the OpenShift Enterprise build system for automated testing and
continuous integration.</p>
</div>
<div class="paragraph">
<p>S2I requires the
<strong><em>assemble</em></strong> and <strong><em>run</em></strong> scripts to be present in order to successfully run
the S2I build. Providing the <strong><em>save-artifacts</em></strong> script reuses the build
artifacts, and providing the <strong><em>usage</em></strong> script ensures that usage information is
printed to console when someone runs the container image outside of the S2I.</p>
</div>
<div class="paragraph">
<p>The goal of testing an S2I image is to make sure that all of these described
commands work properly, even if the base container image has changed or the tooling
used by the commands was updated.</p>
</div>
<div class="sect3">
<h4 id="testing-requirements-create-images">Understanding testing requirements</h4>
<div class="paragraph">
<p>The standard location for the <strong><em>test</em></strong> script is <strong><em>test/run</em></strong>. This script is
invoked by the OpenShift Enterprise S2I image builder and it could be a simple Bash
script or a static Go binary.</p>
</div>
<div class="paragraph">
<p>The <strong><em>test/run</em></strong> script performs the S2I build, so you must have the S2I binary
available in your <code><strong>$PATH</strong></code>. If required, follow the installation instructions
in the
<a href="https://github.com/openshift/source-to-image/blob/master/README.md#installation">S2I
README</a>.</p>
</div>
<div class="paragraph">
<p>S2I combines the application source code and builder image, so in order to test
it you need a sample application source to verify that the source successfully
transforms into a runnable container image. The sample application should be simple,
but it should exercise the crucial steps of <code>assemble</code> and <code>run</code> scripts.</p>
</div>
</div>
<div class="sect3">
<h4 id="generating-scripts-and-tools-create-images">Generating scripts and tools</h4>
<div class="paragraph">
<p>The S2I tooling comes with powerful generation tools to speed up the process of
creating a new S2I image. The <code>s2i create</code> command produces all the necessary S2I
scripts and testing tools along with the <strong><em>Makefile</em></strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ s2i create _&lt;image name&gt;_ _&lt;destination directory&gt;_</pre>
</div>
</div>
<div class="paragraph">
<p>The generated <strong><em>test/run</em></strong> script must be adjusted to be
useful, but it provides a good starting point to begin developing.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <strong><em>test/run</em></strong> script produced by the <code>s2i create</code> command requires that the sample application sources are inside the <strong><em>test/test-app</em></strong> directory.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="testing-locally-create-images">Testing locally</h4>
<div class="paragraph">
<p>The easiest way to run the S2I image tests locally is to use the generated
<strong><em>Makefile</em></strong>.</p>
</div>
<div class="paragraph">
<p>If you did not use the <code>s2i create</code> command, you can copy the
following <strong><em>Makefile</em></strong> template and replace the <code><strong>IMAGE_NAME</strong></code> parameter with
your image name.</p>
</div>
<div class="listingblock">
<div class="title">Sample <strong><em>Makefile</em></strong></div>
<div class="content">
<pre class="nowrap">IMAGE_NAME = openshift/ruby-20-centos7
CONTAINER_ENGINE := $(shell command -v podman 2&gt; /dev/null | echo docker)

build:
	${CONTAINER_ENGINE} build -t $(IMAGE_NAME) .

.PHONY: test
test:
	${CONTAINER_ENGINE} build -t $(IMAGE_NAME)-candidate .
	IMAGE_NAME=$(IMAGE_NAME)-candidate test/run</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-testing-workflow-create-images">Basic testing workflow</h4>
<div class="paragraph">
<p>The <strong><em>test</em></strong> script assumes you have already built the image you want to
test. If required, first build the S2I image. Run one of the following commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you use Podman, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ podman build -t _&lt;BUILDER_IMAGE_NAME&gt;_</pre>
</div>
</div>
</li>
<li>
<p>If you use Docker, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ docker build -t _&lt;BUILDER_IMAGE_NAME&gt;_</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following steps describe the default workflow to test S2I image builders:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify the <strong><em>usage</em></strong> script is working:</p>
<div class="ulist">
<ul>
<li>
<p>If you use Podman, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ podman run _&lt;BUILDER_IMAGE_NAME&gt;_ .</pre>
</div>
</div>
</li>
<li>
<p>If you use Docker, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ docker run _&lt;BUILDER_IMAGE_NAME&gt;_ .</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Build the image:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ s2i build file:///path-to-sample-app _&lt;BUILDER_IMAGE_NAME&gt;_ _&lt;OUTPUT_APPLICATION_IMAGE_NAME&gt;_</pre>
</div>
</div>
</li>
<li>
<p>Optionally, if you support <strong><em>save-artifacts</em></strong>, run step 2 once again to
verify that saving and restoring artifacts works properly.</p>
</li>
<li>
<p>Run the container:</p>
<div class="ulist">
<ul>
<li>
<p>If you use Podman, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ podman run _&lt;OUTPUT_APPLICATION_IMAGE_NAME&gt;_</pre>
</div>
</div>
</li>
<li>
<p>If you use Docker, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ docker run _&lt;OUTPUT_APPLICATION_IMAGE_NAME&gt;_</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Verify the container is running and the application is responding.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Running these steps is generally enough to tell if the builder image is
working as expected.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-openshift-for-building-the-image-create-images">Using OpenShift Enterprise for building the image</h4>
<div class="paragraph">
<p>Once you have a <code>Dockerfile</code> and the other artifacts that make up your new
S2I builder image, you can put them in a git repository and use OpenShift Enterprise
to build and push the image.  Simply define a Docker build that points
to your repository.</p>
</div>
<div class="paragraph">
<p>If your OpenShift Enterprise instance is hosted on a public IP address, the build can
be triggered each time you push into your S2I builder image GitHub repository.</p>
</div>
<div class="paragraph">
<p>You can also use the <code><strong>ImageChangeTrigger</strong></code> to trigger a rebuild of your applications that are
based on the S2I builder image you updated.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="managing-imagestreams">Managing imagestreams</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Imagestreams provide a means of creating and updating container images in an
on-going way. As improvements are made to an image, tags can be used to assign
new version numbers and keep track of changes. This document describes how image
streams are managed.</p>
</div>
<div class="sect2">
<h3 id="images-imagestream-use-image-streams-managing">Using imagestreams</h3>
<div class="paragraph">
<p>An imagestream and its associated tags provide an abstraction for referencing
container images from within OpenShift Enterprise. The imagestream and its tags
allow you to see what images are available and ensure that you are using the
specific image you need even if the image in the repository changes.</p>
</div>
<div class="paragraph">
<p>imagestreams do not contain actual image data, but present a single virtual
view of related images, similar to an image repository.</p>
</div>
<div class="paragraph">
<p>You can  configure Builds and Deployments to watch an imagestream for
notifications when new images are added and react by performing a Build or
Deployment, respectively.</p>
</div>
<div class="paragraph">
<p>For example, if a Deployment is using a certain image and a new version of that
image is created, a Deployment could be automatically performed to pick up the
new version of the image.</p>
</div>
<div class="paragraph">
<p>However, if the imagestream tag used by the Deployment or Build is not updated,
then even if the container image in the container image registry is updated, the
Build or Deployment will continue using the previous, presumably known good
image.</p>
</div>
<div class="paragraph">
<p>The source images can be stored in any of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OpenShift Enterprise&#8217;s integrated registry.</p>
</li>
<li>
<p>An external registry, for example <code>registry.redhat.io</code> or <code>hub.docker.com</code>.</p>
</li>
<li>
<p>Other imagestreams in the OpenShift Enterprise cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you define an object that references an imagestream tag (such as a Build
or Deployment configuration), you point to an imagestream tag, not the Docker
repository. When you Build or Deploy your application, OpenShift Enterprise queries
the Docker repository using the imagestream tag to locate the associated ID of
the image and uses that exact image.</p>
</div>
<div class="paragraph">
<p>The imagestream metadata is stored in the etcd instance along with other
cluster information.</p>
</div>
<div class="paragraph">
<p>Using imagestreams has several significant benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can tag, rollback a tag, and quickly deal with images, without having to
re-push using the command line.</p>
</li>
<li>
<p>You can trigger Builds and Deployments when a new image is pushed to the
registry. Also, OpenShift Enterprise has generic triggers for other resources, such
as Kubernetes objects.</p>
</li>
<li>
<p>You can mark a tag for periodic re-import. If the source image has changed, that
change is picked up and reflected in the imagestream, which triggers the Build
and/or Deployment flow, depending upon the Build or Deployment configuration.</p>
</li>
<li>
<p>You can share images using fine-grained access control and quickly distribute
images across your teams.</p>
</li>
<li>
<p>If the source image changes, the imagestream tag will still point to a
known-good version of the image, ensuring that your application will not break
unexpectedly.</p>
</li>
<li>
<p>You can configure security around who can view and use the images through
permissions on the imagestream objects.</p>
</li>
<li>
<p>Users that lack permission to read or list images on the cluster level can still
retrieve the images tagged in a project using imagestreams.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="image-stream-configure-image-streams-managing">Configuring imagestreams</h3>
<div class="paragraph">
<p>An imagestream object file contains the following elements.</p>
</div>
<div id="image-stream-object-definition-image-streams-managing" class="listingblock">
<div class="title">Imagestream object definition</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ImageStream
metadata:
  annotations:
    openshift.io/generated-by: OpenShiftNewApp
  creationTimestamp: 2017-09-29T13:33:49Z
  generation: 1
  labels:
    app: ruby-sample-build
    template: application-template-stibuild
  name: origin-ruby-sample <b class="conum">(1)</b>
  namespace: test
  resourceVersion: "633"
  selflink: /oapi/v1/namespaces/test/imagestreams/origin-ruby-sample
  uid: ee2b9405-c68c-11e5-8a99-525400f25e34
spec: {}
status:
  dockerImageRepository: 172.30.56.218:5000/test/origin-ruby-sample <b class="conum">(2)</b>
  tags:
  - items:
    - created: 2017-09-02T10:15:09Z
      dockerImageReference: 172.30.56.218:5000/test/origin-ruby-sample@sha256:47463d94eb5c049b2d23b03a9530bf944f8f967a0fe79147dd6b9135bf7dd13d <b class="conum">(3)</b>
      generation: 2
      image: sha256:909de62d1f609a717ec433cc25ca5cf00941545c83a01fb31527771e1fab3fc5 <b class="conum">(4)</b>
    - created: 2017-09-29T13:40:11Z
      dockerImageReference: 172.30.56.218:5000/test/origin-ruby-sample@sha256:909de62d1f609a717ec433cc25ca5cf00941545c83a01fb31527771e1fab3fc5
      generation: 1
      image: sha256:47463d94eb5c049b2d23b03a9530bf944f8f967a0fe79147dd6b9135bf7dd13d
    tag: latest <b class="conum">(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The name of the imagestream.</p>
</li>
<li>
<p>Docker repository path where new images can be pushed to add/update them in this imagestream.</p>
</li>
<li>
<p>The SHA identifier that this imagestream tag currently references. Resources that reference this imagestream tag use this identifier.</p>
</li>
<li>
<p>The SHA identifier that this imagestream tag previously referenced. Can be used to rollback to an older image.</p>
</li>
<li>
<p>The imagestream tag name.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="images-using-imagestream-images-image-streams-managing">Imagestream images</h3>
<div class="paragraph">
<p>An imagestream image points from within an imagestream
to a particular image ID.</p>
</div>
<div class="paragraph">
<p>Imagestream images allow you to retrieve metadata about an image from a
particular imagestream where it is tagged.</p>
</div>
<div class="paragraph">
<p>Imagestream image objects are automatically created in OpenShift Enterprise whenever
you import or tag an image into the imagestream. You should never have to
explicitly define an imagestream image object in any imagestream definition
that you use to create imagestreams.</p>
</div>
<div class="paragraph">
<p>The imagestream image consists of the imagestream name and image ID from the
repository, delimited by an <code>@</code> sign:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;image-stream-name&gt;@&lt;image-id&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>To refer to the image in the imagestream object example, the imagestream image
looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">origin-ruby-sample@sha256:47463d94eb5c049b2d23b03a9530bf944f8f967a0fe79147dd6b9135bf7dd13d</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="images-using-imagestream-tags-image-streams-managing">Imagestream tags</h3>
<div class="paragraph">
<p>An imagestream tag is a named pointer to an image in an <em>imagestream</em>. It is
often abbreviated as <em>istag</em>. An imagestream tag is used to reference or
retrieve an image for a given imagestream and tag.</p>
</div>
<div class="paragraph">
<p>Imagestream tags can reference any local or externally managed image. It
contains a history of images represented as a stack of all images the tag ever
pointed to. Whenever a new or existing image is tagged under particular image
stream tag, it is placed at the first position in the history stack. The image
previously occupying the top position will be available at the second position,
and so forth. This allows for easy rollbacks to make tags point to historical
images again.</p>
</div>
<div class="paragraph">
<p>The following imagestream tag is from an imagestream object:</p>
</div>
<div class="listingblock">
<div class="title">Imagestream tag with two images in its history</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">  tags:
  - items:
    - created: 2017-09-02T10:15:09Z
      dockerImageReference: 172.30.56.218:5000/test/origin-ruby-sample@sha256:47463d94eb5c049b2d23b03a9530bf944f8f967a0fe79147dd6b9135bf7dd13d
      generation: 2
      image: sha256:909de62d1f609a717ec433cc25ca5cf00941545c83a01fb31527771e1fab3fc5
    - created: 2017-09-29T13:40:11Z
      dockerImageReference: 172.30.56.218:5000/test/origin-ruby-sample@sha256:909de62d1f609a717ec433cc25ca5cf00941545c83a01fb31527771e1fab3fc5
      generation: 1
      image: sha256:47463d94eb5c049b2d23b03a9530bf944f8f967a0fe79147dd6b9135bf7dd13d
    tag: latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Imagestream tags can be <em>permanent</em> tags or <em>tracking</em> tags.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Permanent tags</em> are version-specific tags that point to a particular version of
an image, such as Python 3.5.</p>
</li>
<li>
<p><em>Tracking tags</em> are reference tags that follow another imagestream tag and
could be updated in the future to change which image they follow, much like a
symlink. Note that these new levels are not guaranteed to be
backwards-compatible.</p>
<div class="paragraph">
<p>For example, the <code>latest</code> imagestream tags that ship with OpenShift Enterprise are
tracking tags. This means consumers of the <code>latest</code> imagestream tag will be
updated to the newest level of the framework provided by the image when a new
level becomes available. A <code>latest</code> imagestream tag to <code>v3.10</code> could be changed
to <code>v3.11</code> at any time. It is important to be aware that these <code>latest</code> image
stream tags behave differently than the Docker <code>latest</code> tag. The <code>latest</code> image
stream tag, in this case, does not point to the latest image in the Docker
repository. It points to another imagestream tag, which might not be the latest
version of an image. For example, if the <code>latest</code> imagestream tag points to
<code>v3.10</code> of an image, when the <code>3.11</code> version is released, the <code>latest</code> tag is
not automatically updated to <code>v3.11</code>, and remains at <code>v3.10</code> until it is
manually updated to point to a <code>v3.11</code> imagestream tag.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Tracking tags are limited to a single imagestream and cannot reference other
imagestreams.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can create your own imagestream tags for your own needs.</p>
</div>
<div class="paragraph">
<p>The imagestream tag is composed of the name of the imagestream and a tag,
separated by a colon:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;image stream name&gt;:&lt;tag&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example, to refer to the
<code>sha256:47463d94eb5c049b2d23b03a9530bf944f8f967a0fe79147dd6b9135bf7dd13d</code> image
in the  imagestream object example earlier, the imagestream tag
would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">origin-ruby-sample:latest</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="images-using-imagestream-change-triggers-image-streams-managing">Imagestream change triggers</h3>
<div class="paragraph">
<p>Imagestream triggers allow your Builds and Deployments to be automatically
invoked when a new version of an upstream image is available.</p>
</div>
<div class="paragraph">
<p>For example, Builds and Deployments can be automatically started when an image
stream tag is modified. This is achieved by monitoring that particular image
stream tag and notifying the Build or Deployment when a change is detected.</p>
</div>
</div>
<div class="sect2">
<h3 id="images-imagestream-mapping-image-streams-managing">Imagestream mapping</h3>
<div class="paragraph">
<p>When the integrated registry receives a new image, it creates and sends an image
stream mapping to OpenShift Enterprise, providing the image&#8217;s project, name, tag, and
image metadata.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Configuring imagestream mappings is an advanced feature.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This information is used to create a new image (if it does not already exist)
and to tag the image into the imagestream. OpenShift Enterprise stores complete
metadata about each image, such as commands, entry point, and environment
variables. Images in OpenShift Enterprise are immutable and the maximum name length
is 63 characters.</p>
</div>
<div class="paragraph">
<p>The following imagestream mapping example results in an image being tagged as
<strong>test/origin-ruby-sample:latest</strong>:</p>
</div>
<div class="listingblock">
<div class="title">Imagestream mapping object definition</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ImageStreamMapping
metadata:
  creationTimestamp: null
  name: origin-ruby-sample
  namespace: test
tag: latest
image:
  dockerImageLayers:
  - name: sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef
    size: 0
  - name: sha256:ee1dd2cb6df21971f4af6de0f1d7782b81fb63156801cfde2bb47b4247c23c29
    size: 196634330
  - name: sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef
    size: 0
  - name: sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef
    size: 0
  - name: sha256:ca062656bff07f18bff46be00f40cfbb069687ec124ac0aa038fd676cfaea092
    size: 177723024
  - name: sha256:63d529c59c92843c395befd065de516ee9ed4995549f8218eac6ff088bfa6b6e
    size: 55679776
  - name: sha256:92114219a04977b5563d7dff71ec4caa3a37a15b266ce42ee8f43dba9798c966
    size: 11939149
  dockerImageMetadata:
    Architecture: amd64
    Config:
      Cmd:
      - /usr/libexec/s2i/run
      Entrypoint:
      - container-entrypoint
      Env:
      - RACK_ENV=production
      - OPENSHIFT_BUILD_NAMESPACE=test
      - OPENSHIFT_BUILD_SOURCE=https://github.com/openshift/ruby-hello-world.git
      - EXAMPLE=sample-app
      - OPENSHIFT_BUILD_NAME=ruby-sample-build-1
      - PATH=/opt/app-root/src/bin:/opt/app-root/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      - STI_SCRIPTS_URL=image:///usr/libexec/s2i
      - STI_SCRIPTS_PATH=/usr/libexec/s2i
      - HOME=/opt/app-root/src
      - BASH_ENV=/opt/app-root/etc/scl_enable
      - ENV=/opt/app-root/etc/scl_enable
      - PROMPT_COMMAND=. /opt/app-root/etc/scl_enable
      - RUBY_VERSION=2.2
      ExposedPorts:
        8080/tcp: {}
      Labels:
        build-date: 2015-12-23
        io.k8s.description: Platform for building and running Ruby 2.2 applications
        io.k8s.display-name: 172.30.56.218:5000/test/origin-ruby-sample:latest
        io.openshift.build.commit.author: Ben Parees &lt;bparees@users.noreply.github.com&gt;
        io.openshift.build.commit.date: Wed Jan 20 10:14:27 2016 -0500
        io.openshift.build.commit.id: 00cadc392d39d5ef9117cbc8a31db0889eedd442
        io.openshift.build.commit.message: 'Merge pull request #51 from php-coder/fix_url_and_sti'
        io.openshift.build.commit.ref: master
        io.openshift.build.image: centos/ruby-22-centos7@sha256:3a335d7d8a452970c5b4054ad7118ff134b3a6b50a2bb6d0c07c746e8986b28e
        io.openshift.build.source-location: https://github.com/openshift/ruby-hello-world.git
        io.openshift.builder-base-version: 8d95148
        io.openshift.builder-version: 8847438ba06307f86ac877465eadc835201241df
        io.openshift.s2i.scripts-url: image:///usr/libexec/s2i
        io.openshift.tags: builder,ruby,ruby22
        io.s2i.scripts-url: image:///usr/libexec/s2i
        license: GPLv2
        name: CentOS Base Image
        vendor: CentOS
      User: "1001"
      WorkingDir: /opt/app-root/src
    Container: 86e9a4a3c760271671ab913616c51c9f3cea846ca524bf07c04a6f6c9e103a76
    ContainerConfig:
      AttachStdout: true
      Cmd:
      - /bin/sh
      - -c
      - tar -C /tmp -xf - &amp;&amp; /usr/libexec/s2i/assemble
      Entrypoint:
      - container-entrypoint
      Env:
      - RACK_ENV=production
      - OPENSHIFT_BUILD_NAME=ruby-sample-build-1
      - OPENSHIFT_BUILD_NAMESPACE=test
      - OPENSHIFT_BUILD_SOURCE=https://github.com/openshift/ruby-hello-world.git
      - EXAMPLE=sample-app
      - PATH=/opt/app-root/src/bin:/opt/app-root/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      - STI_SCRIPTS_URL=image:///usr/libexec/s2i
      - STI_SCRIPTS_PATH=/usr/libexec/s2i
      - HOME=/opt/app-root/src
      - BASH_ENV=/opt/app-root/etc/scl_enable
      - ENV=/opt/app-root/etc/scl_enable
      - PROMPT_COMMAND=. /opt/app-root/etc/scl_enable
      - RUBY_VERSION=2.2
      ExposedPorts:
        8080/tcp: {}
      Hostname: ruby-sample-build-1-build
      Image: centos/ruby-22-centos7@sha256:3a335d7d8a452970c5b4054ad7118ff134b3a6b50a2bb6d0c07c746e8986b28e
      OpenStdin: true
      StdinOnce: true
      User: "1001"
      WorkingDir: /opt/app-root/src
    Created: 2016-01-29T13:40:00Z
    DockerVersion: 1.8.2.fc21
    Id: 9d7fd5e2d15495802028c569d544329f4286dcd1c9c085ff5699218dbaa69b43
    Parent: 57b08d979c86f4500dc8cad639c9518744c8dd39447c055a3517dc9c18d6fccd
    Size: 441976279
    apiVersion: "1.0"
    kind: DockerImage
  dockerImageMetadataVersion: "1.0"
  dockerImageReference: 172.30.56.218:5000/test/origin-ruby-sample@sha256:47463d94eb5c049b2d23b03a9530bf944f8f967a0fe79147dd6b9135bf7dd13d</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working-with-imagestreams">Working with imagestreams</h3>
<div class="paragraph">
<p>The following sections describe how to use imagestreams and imagestream tags.</p>
</div>
<div class="sect3">
<h4 id="images-getting-info-about-imagestreams-image-streams-managing">Getting information about imagestreams</h4>
<div class="paragraph">
<p>You can get general information about the imagestream and detailed information
about all the tags it is pointing to.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Get general information about the imagestream
and detailed information about all the tags it is pointing to:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe is/&lt;image-name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe is/python

Name:			python
Namespace:		default
Created:		About a minute ago
Labels:			&lt;none&gt;
Annotations:		openshift.io/image.dockerRepositoryCheck=2017-10-02T17:05:11Z
Docker Pull Spec:	docker-registry.default.svc:5000/default/python
Image Lookup:		local=false
Unique Images:		1
Tags:			1

3.5
  tagged from centos/python-35-centos7

  * centos/python-35-centos7@sha256:49c18358df82f4577386404991c51a9559f243e0b1bdc366df25
      About a minute ago</pre>
</div>
</div>
</li>
<li>
<p>Get all the information available about particular imagestream tag:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe istag/&lt;image-stream&gt;:&lt;tag-name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe istag/python:latest

Image Name:	sha256:49c18358df82f4577386404991c51a9559f243e0b1bdc366df25
Docker Image:	centos/python-35-centos7@sha256:49c18358df82f4577386404991c51a9559f243e0b1bdc366df25
Name:		sha256:49c18358df82f4577386404991c51a9559f243e0b1bdc366df25
Created:	2 minutes ago
Image Size:	251.2 MB (first layer 2.898 MB, last binary layer 72.26 MB)
Image Created:	2 weeks ago
Author:		&lt;none&gt;
Arch:		amd64
Entrypoint:	container-entrypoint
Command:	/bin/sh -c $STI_SCRIPTS_PATH/usage
Working Dir:	/opt/app-root/src
User:		1001
Exposes Ports:	8080/tcp
Docker Labels:	build-date=20170801</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>More information is output than shown.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="images-imagestreams-adding-tags-image-streams-managing">Adding tags to an imagestream</h4>
<div class="paragraph">
<p>You can add additional tags to imagestreams.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Add a tag that points to one of the existing tags by using the <code>oc tag</code>
command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc tag &lt;image-name:tag1&gt; &lt;image-name:tag2&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc tag python:3.5 python:latest

Tag python:latest set to python@sha256:49c18358df82f4577386404991c51a9559f243e0b1bdc366df25.</pre>
</div>
</div>
</li>
<li>
<p>Confirm the imagestream has two tags, one (<code>3.5</code>) pointing at the external
container image and another tag (<code>latest</code>) pointing to the same image because it
was created based on the first tag.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe is/python

Name:			python
Namespace:		default
Created:		5 minutes ago
Labels:			&lt;none&gt;
Annotations:		openshift.io/image.dockerRepositoryCheck=2017-10-02T17:05:11Z
Docker Pull Spec:	docker-registry.default.svc:5000/default/python
Image Lookup:		local=false
Unique Images:		1
Tags:			2

latest
  tagged from python@sha256:49c18358df82f4577386404991c51a9559f243e0b1bdc366df25

  * centos/python-35-centos7@sha256:49c18358df82f4577386404991c51a9559f243e0b1bdc366df25
      About a minute ago

3.5
  tagged from centos/python-35-centos7

  * centos/python-35-centos7@sha256:49c18358df82f4577386404991c51a9559f243e0b1bdc366df25
      5 minutes ago</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="images-imagestreams-external-image-tags-image-streams-managing">Adding tags for an external image</h4>
<div class="paragraph">
<p>You can add tags for external images.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Add tags pointing to internal or external images, by using the <code>oc tag</code> command
for all tag-related operations:
+</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc tag &lt;repository/image&gt; &lt;image-name:tag&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>+
For example, this command maps the <code>docker.io/python:3.6.0</code> image to the <code>3.6</code>
tag in the <code>python</code> imagestream.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc tag docker.io/python:3.6.0 python:3.6
Tag python:3.6 set to docker.io/python:3.6.0.</pre>
</div>
</div>
<div class="paragraph">
<p>+
If the external image is secured, you will need to create a secret with
credentials for accessing that registry.</p>
</div>
</div>
<div class="sect3">
<h4 id="images-imagestreams-update-tag-image-streams-managing">Updating imagestream tags</h4>
<div class="paragraph">
<p>You can update a tag to reflect another tag in an imagestream.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Update a tag:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc tag &lt;image-name:tag&gt; &lt;image-name:latest&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following updates the <code>latest</code> tag to reflect the <code>3.6</code> tag in
an imagestream:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc tag python:3.6 python:latest
Tag python:latest set to python@sha256:438208801c4806548460b27bd1fbcb7bb188273d13871ab43f.</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="images-imagestreams-remove-tag-image-streams-managing">Removing imagestream tags</h4>
<div class="paragraph">
<p>You can remove old tags from an imagestream.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Remove old tags from an imagestream:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc tag -d &lt;image-name:tag&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc tag -d python:3.5

Deleted tag default/python:3.5.</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="images-imagestreams-import-image-streams-managing">Configuring periodic importing of imagestream tags</h4>
<div class="paragraph">
<p>When working with an external container image registry, to periodically
re-import an image, for example to get latest security updates, you can use the
<code>--scheduled</code> flag.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Schedule importing images:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc tag &lt;repositiory/image&gt; &lt;image-name:tag&gt; --scheduled</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc tag docker.io/python:3.6.0 python:3.6 --scheduled

Tag python:3.6 set to import docker.io/python:3.6.0 periodically.</pre>
</div>
</div>
<div class="paragraph">
<p>This command causes OpenShift Enterprise to periodically update this particular image
stream tag. This period is a cluster-wide setting set to 15 minutes by default.</p>
</div>
</li>
<li>
<p>Remove the periodic check, re-run above command but omit the <code>--scheduled</code> flag.
This will reset its behavior to default.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc tag &lt;repositiory/image&gt; &lt;image-name:tag&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-templates">Using templates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sections provide an overview of templates, as well as how to use
and create them.</p>
</div>
<div class="sect2">
<h3 id="templates-overview-using-templates">Understanding templates</h3>
<div class="paragraph">
<p>A template describes a set of objects that can be parameterized and processed to
produce a list of objects for creation by OpenShift Enterprise. A template can be
processed to create anything you have permission to create within a project, for
example services, build configurations, and DeploymentConfigs. A
template may also define a set of labels to apply to every object defined in the
template.</p>
</div>
<div class="paragraph">
<p>You can create a list of objects from a template using the CLI or, if a
template has been uploaded to your project or the
global template library, using the web console.</p>
</div>
</div>
<div class="sect2">
<h3 id="templates-uploading-using-templates">Uploading a template</h3>
<div class="paragraph">
<p>If you have a JSON or YAML file that defines a template, for example as seen in
this example, you can upload the template to projects using the CLI. This saves
the template to the project for repeated use by any user with appropriate access
to that project. Instructions on writing your own templates are provided later
in this topic.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Upload a template to your current project&#8217;s template library, pass the JSON
or YAML file with the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create -f &lt;filename&gt;</pre>
</div>
</div>
</li>
<li>
<p>Upload a template to a different project using the <code>-n</code> option with the
name of the project:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create -f &lt;filename&gt; -n &lt;project&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The template is now available for selection using the web console or the CLI.</p>
</div>
</div>
<div class="sect2">
<h3 id="templates-creating-from-console-using-templates">Creating an application using the web console</h3>
<div class="paragraph">
<p>You can use the web console to create an application from a template.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>While in the desired project, click <strong>Add to Project</strong>.</p>
</li>
<li>
<p>Select either a builder image from the list of images in your project, or
from the service catalog.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Only imagestream tags that have the <strong>builder</strong> tag listed in their annotations
appear in this list, as demonstrated here:</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kind: "ImageStream"
apiVersion: "v1"
metadata:
  name: "ruby"
  creationTimestamp: null
spec:
  dockerImageRepository: "registry.redhat.io/openshift3/ruby-20-rhel7"
  tags:
    -
      name: "2.0"
      annotations:
        description: "Build and run Ruby 2.0 applications"
        iconClass: "icon-ruby"
        tags: "builder,ruby" <b class="conum">(1)</b>
        supports: "ruby:2.0,ruby"
        version: "2.0"</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Including <strong>builder</strong> here ensures this <code>ImageStreamTag</code> appears in the
web console as a builder.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Modify the settings in the new application screen to configure the objects
to support your application.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="templates-using-the-cli-using-templates">Creating objects from templates using the CLI</h3>
<div class="paragraph">
<p>You can use the CLI to process templates and use the configuration that is
generated to create objects.</p>
</div>
<div class="sect3">
<h4 id="templates-cli-labels-using-templates">Adding labels</h4>
<div class="paragraph">
<p>Labels are used to manage and organize generated objects, such as pods. The
labels specified in the template are applied to every object that is generated
from the template.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Add labels in the template from the command line:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc process -f &lt;filename&gt; -l name=otherLabel</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="templates-cli-parameters-using-templates">Listing parameters</h4>
<div class="paragraph">
<p>The list of parameters that you can override are listed in the <code>parameters</code>
section of the template.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>You can list parameters with the CLI by using the following command and
specifying the file to be used:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc process --parameters -f &lt;filename&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if the template is already uploaded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc process --parameters -n &lt;project&gt; &lt;template_name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following shows the output when listing the parameters for one
of the Quickstart templates in the default <strong>openshift</strong> project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc process --parameters -n openshift rails-postgresql-example
NAME                         DESCRIPTION                                                                                              GENERATOR           VALUE
SOURCE_REPOSITORY_URL        The URL of the repository with your application source code                                                                  https://github.com/sclorg/rails-ex.git
SOURCE_REPOSITORY_REF        Set this to a branch name, tag or other ref of your repository if you are not using the default branch
CONTEXT_DIR                  Set this to the relative path to your project if it is not in the root of your repository
APPLICATION_DOMAIN           The exposed hostname that will route to the Rails service                                                                    rails-postgresql-example.openshiftapps.com
GITHUB_WEBHOOK_SECRET        A secret string used to configure the GitHub webhook                                                     expression          [a-zA-Z0-9]{40}
SECRET_KEY_BASE              Your secret key for verifying the integrity of signed cookies                                            expression          [a-z0-9]{127}
APPLICATION_USER             The application user that is used within the sample application to authorize access on pages                                 openshift
APPLICATION_PASSWORD         The application password that is used within the sample application to authorize access on pages                             secret
DATABASE_SERVICE_NAME        Database service name                                                                                                        postgresql
POSTGRESQL_USER              database username                                                                                        expression          user[A-Z0-9]{3}
POSTGRESQL_PASSWORD          database password                                                                                        expression          [a-zA-Z0-9]{8}
POSTGRESQL_DATABASE          database name                                                                                                                root
POSTGRESQL_MAX_CONNECTIONS   database max connections                                                                                                     10
POSTGRESQL_SHARED_BUFFERS    database shared buffers                                                                                                      12MB</pre>
</div>
</div>
<div class="paragraph">
<p>The output identifies several parameters that are generated with a regular
expression-like generator when the template is processed.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="templates-cli-generating-list-of-objects-using-templates">Generating a list of objects</h4>
<div class="paragraph">
<p>Using the CLI, you can process a file defining a template to return the list of
objects to standard output.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Process a file defining a template to return the list of objects to standard
output:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc process -f &lt;filename&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if the template has already been uploaded to the current project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc process &lt;template_name&gt;</pre>
</div>
</div>
</li>
<li>
<p>Create objects from a template by processing the template and piping the
output to <code>oc create</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc process -f &lt;filename&gt; | oc create -f -</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if the template has already been uploaded to the current project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc process &lt;template&gt; | oc create -f -</pre>
</div>
</div>
</li>
<li>
<p>You can override any parameter values defined in the file by adding the <code>-p</code>
option for each <code>&lt;name&gt;=&lt;value&gt;</code> pair you want to override. A parameter
reference may appear in any text field inside the template items.</p>
<div class="paragraph">
<p>For example, in the following the <strong><code>POSTGRESQL_USER</code></strong> and <strong><code>POSTGRESQL_DATABASE</code></strong>
parameters of a template are overridden to output a configuration with
customized environment variables:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Creating a List of Objects from a Template</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc process -f my-rails-postgresql \
    -p POSTGRESQL_USER=bob \
    -p POSTGRESQL_DATABASE=mydatabase</pre>
</div>
</div>
</li>
<li>
<p>The JSON file can either be redirected to a file or applied directly without
uploading the template by piping the processed output to the <code>oc create</code>
command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc process -f my-rails-postgresql \
    -p POSTGRESQL_USER=bob \
    -p POSTGRESQL_DATABASE=mydatabase \
    | oc create -f -</pre>
</div>
</div>
</li>
<li>
<p>If you have large number of parameters, you can store them in a file and then
pass this file to <code>oc process</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ cat postgres.env
POSTGRESQL_USER=bob
POSTGRESQL_DATABASE=mydatabase
$ oc process -f my-rails-postgresql --param-file=postgres.env</pre>
</div>
</div>
</li>
<li>
<p>You can also read the environment from standard input by using <code>"-"</code> as the
argument to <code>--param-file</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sed s/bob/alice/ postgres.env | oc process -f my-rails-postgresql --param-file=-</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="templates-modifying-uploaded-templates-using-templates">Modifying uploaded templates</h3>
<div class="paragraph">
<p>You can edit a template that has already been uploaded to your project.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Modify a template that has already been uploaded:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc edit template &lt;template&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="templates-using-instant-app-quickstart-using-templates">Using Instant App and Quickstart templates</h3>
<div class="paragraph">
<p>OpenShift Enterprise provides a number of default Instant App and Quickstart
templates to make it easy to quickly get started creating a new application for
different languages. Templates are provided for Rails (Ruby), Django (Python),
Node.js, CakePHP (PHP), and Dancer (Perl). Your cluster administrator should
have created these templates in the default, global <strong>openshift</strong> project so you
have access to them.</p>
</div>
<div class="paragraph">
<p>By default, the templates build using a public source repository on
GitHub that contains the necessary application code.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>You can list the available default Instant App and Quickstart templates with:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get templates -n openshift</pre>
</div>
</div>
</li>
<li>
<p>To modify the source and build your own version of the application:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Fork the repository referenced by the template&#8217;s default
<code>SOURCE_REPOSITORY_URL</code> parameter.</p>
</li>
<li>
<p>Override the value of the <code>SOURCE_REPOSITORY_URL</code> parameter when creating
from the template, specifying your fork instead of the default value.</p>
<div class="paragraph">
<p>By doing this, the build configuration created by the template will now point to
your fork of the application code, and you can modify the code and rebuild the
application at will.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Some of the Instant App and Quickstart templates define a database deployment
configuration. The configuration they define uses ephemeral storage for the
database content. These templates should be used for demonstration purposes only
as all database data will be lost if the database pod restarts for any reason.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="templates-quickstart-using-templates">Quickstart templates</h4>
<div class="paragraph">
<p>A Quickstart is a basic example of an application running on OpenShift Enterprise.
Quickstarts come in a variety of languages and frameworks, and are defined in a
template, which is constructed from a set of services, build configurations, and
DeploymentConfigs. This template references the necessary images and
source repositories to build and deploy the application.</p>
</div>
<div class="paragraph">
<p>To explore a Quickstart, create an application from a template. Your
administrator may have already installed these templates in your OpenShift Enterprise
cluster, in which case you can simply select it from the web console.</p>
</div>
<div class="paragraph">
<p>Quickstarts refer to a source repository that contains the application source
code. To customize the Quickstart, fork the repository and, when creating an
application from the template, substitute the default source repository name
with your forked repository. This results in builds that are performed using
your source code instead of the provided example source. You can then update the
code in your source repository and launch a new build to see the changes
reflected in the deployed application.</p>
</div>
<div class="sect4">
<h5 id="_web-framework-quickstart-templates">Web framework Quickstart templates</h5>
<div class="paragraph">
<p>These Quickstart templates provide a basic application of the indicated
framework and language:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CakePHP: a PHP web framework (includes a MySQL database)</p>
</li>
<li>
<p>Dancer: a Perl web framework (includes a MySQL database)</p>
</li>
<li>
<p>Django: a Python web framework (includes a PostgreSQL database)</p>
</li>
<li>
<p>NodeJS: a NodeJS web application (includes a MongoDB database)</p>
</li>
<li>
<p>Rails: a Ruby web framework (includes a PostgreSQL database)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="templates-writing-using-templates">Writing templates</h3>
<div class="paragraph">
<p>You can define new templates to make it easy to recreate all the objects of your
application. The template will define the objects it creates along with some
metadata to guide the creation of those objects.</p>
</div>
<div class="paragraph">
<p>The following is an example of a simple template object definition (YAML):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Template
metadata:
  name: redis-template
  annotations:
    description: "Description"
    iconClass: "icon-redis"
    tags: "database,nosql"
objects:
- apiVersion: v1
  kind: Pod
  metadata:
    name: redis-master
  spec:
    containers:
    - env:
      - name: REDIS_PASSWORD
        value: ${REDIS_PASSWORD}
      image: dockerfile/redis
      name: master
      ports:
      - containerPort: 6379
        protocol: TCP
parameters:
- description: Password used for Redis authentication
  from: '[A-Z0-9]{8}'
  generate: expression
  name: REDIS_PASSWORD
labels:
  redis: master</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="templates-writing-description-using-templates">Writing the template description</h4>
<div class="paragraph">
<p>The template description informs users what the template does and helps them
find it when searching in the web console. Additional metadata beyond the
template name is optional, but useful to have. In addition to general
descriptive information, the metadata also includes a set of tags. Useful tags
include the name of the language the template is related to (for example,
<strong>java</strong>, <strong>php</strong>, <strong>ruby</strong>, and so on).</p>
</div>
<div class="paragraph">
<p>The following is an example of template description metadata:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">kind: Template
apiVersion: v1
metadata:
  name: cakephp-mysql-example <b class="conum">(1)</b>
  annotations:
    openshift.io/display-name: "CakePHP MySQL Example (Ephemeral)" <b class="conum">(2)</b>
    description: &gt;-
      An example CakePHP application with a MySQL database. For more information
      about using this template, including OpenShift considerations, see
      https://github.com/sclorg/cakephp-ex/blob/master/README.md.


      WARNING: Any data stored will be lost upon pod destruction. Only use this
      template for testing." <b class="conum">(3)</b>
    openshift.io/long-description: &gt;-
      This template defines resources needed to develop a CakePHP application,
      including a build configuration, application DeploymentConfig, and
      database DeploymentConfig.  The database is stored in
      non-persistent storage, so this configuration should be used for
      experimental purposes only. <b class="conum">(4)</b>
    tags: "quickstart,php,cakephp" <b class="conum">(5)</b>
    iconClass: icon-php <b class="conum">(6)</b>
    openshift.io/provider-display-name: "Red Hat, Inc." <b class="conum">(7)</b>
    openshift.io/documentation-url: "https://github.com/sclorg/cakephp-ex" <b class="conum">(8)</b>
    openshift.io/support-url: "https://access.redhat.com" <b class="conum">(9)</b>
message: "Your admin credentials are ${ADMIN_USERNAME}:${ADMIN_PASSWORD}" <b class="conum">(10)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The unique name of the template.</p>
</li>
<li>
<p>A brief, user-friendly name, which can be employed by user interfaces.</p>
</li>
<li>
<p>A description of the template. Include enough detail that the user will
understand what is being deployed and any caveats they need to know before
deploying. It should also provide links to additional information, such as a
<strong><em>README</em></strong> file. Newlines can be included to create paragraphs.</p>
</li>
<li>
<p>Additional template description. This may be displayed by the service
catalog, for example.</p>
</li>
<li>
<p>Tags to be associated with the template for searching and grouping. Add tags
that will include it into one of the provided catalog categories. Refer to the
<code>id</code> and <code>categoryAliases</code> in <code>CATALOG_CATEGORIES</code> in the console&#8217;s
constants file.
The categories can also be customized for the whole cluster.</p>
</li>
<li>
<p>An icon to be displayed with your template in the web console. Choose from
our existing logo icons when possible. You can also use icons from FontAwesome
and PatternFly.
Alternatively, provide icons through CSS customizations that can be added to an
OpenShift Enterprise cluster that uses your template. You must specify an icon class
that exists, or it will prevent falling back to the generic icon.</p>
</li>
<li>
<p>The name of the person or organization providing the template.</p>
</li>
<li>
<p>A URL referencing further documentation for the template.</p>
</li>
<li>
<p>A URL where support can be obtained for the template.</p>
</li>
<li>
<p>An instructional message that is displayed when this template is
instantiated. This field should inform the user how to use the newly created
resources. Parameter substitution is performed on the message before being
displayed so that generated credentials and other parameters can be included in
the output. Include links to any next-steps documentation that users should
follow.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="templates-writing-label-using-templates">Writing template labels</h4>
<div class="paragraph">
<p>Templates can include a set of labels. These labels will be added to each object
created when the template is instantiated. Defining a label in this way makes it
easy for users to find and manage all the objects created from a particular
template.</p>
</div>
<div class="paragraph">
<p>The following is an example of template object labels:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">kind: "Template"
apiVersion: "v1"
...
labels:
  template: "cakephp-mysql-example" <b class="conum">(1)</b>
  app: "${NAME}" <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A label that will be applied to all objects created from this template.</p>
</li>
<li>
<p>A parameterized label that will also be applied to all objects created from
this template.  Parameter expansion is carried out on both label keys and
values.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="templates-writing-parameters-using-templates">Writing template parameters</h4>
<div class="paragraph">
<p>Parameters allow a value to be supplied by the user or generated when the
template is instantiated. Then, that value is substituted wherever the parameter
is referenced. References can be defined in any field in the objects list field.
This is useful for generating random passwords or allowing the user to supply a
host name or other user-specific value that is required to customize the
template. Parameters can be referenced in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As a string value by placing values in the form <strong>${PARAMETER_NAME}</strong> in any
string field in the template.</p>
</li>
<li>
<p>As a json/yaml value by placing values in the form <strong>${{PARAMETER_NAME}}</strong> in
place of any field in the template.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using the <strong>${PARAMETER_NAME}</strong> syntax, multiple parameter references can be
combined in a single field and the reference can be embedded within fixed data,
such as <strong>"http://${PARAMETER_1}${PARAMETER_2}"</strong>. Both parameter values will be
substituted and the resulting value will be a quoted string.</p>
</div>
<div class="paragraph">
<p>When using the <strong>${{PARAMETER_NAME}}</strong> syntax only a single parameter reference is
allowed and leading/trailing characters are not permitted.  The resulting value
will be unquoted unless, after substitution is performed, the result is not a
valid json object.  If the result is not a valid json value, the resulting value
will be quoted and treated as a standard string.</p>
</div>
<div class="paragraph">
<p>A single parameter can be referenced multiple times within a template and it can
be referenced using both substitution syntaxes within a single template.</p>
</div>
<div class="paragraph">
<p>A default value can be provided, which is used if the user does not supply a
different value:</p>
</div>
<div class="paragraph">
<p>The following is an example of setting an explicit value as the default value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">parameters:
  - name: USERNAME
    description: "The user name for Joe"
    value: joe</code></pre>
</div>
</div>
<div class="paragraph">
<p>Parameter values can also be generated based on rules specified in the parameter
definition, for example generating a parameter value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">parameters:
  - name: PASSWORD
    description: "The random user password"
    generate: expression
    from: "[a-zA-Z0-9]{12}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the previous example, processing will generate a random password 12
characters long consisting of all upper and lowercase alphabet letters
and numbers.</p>
</div>
<div class="paragraph">
<p>The syntax available is not a full regular expression syntax. However, you can
use <code>\w</code>, <code>\d</code>, and <code>\a</code> modifiers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>[\w]{10}</code> produces 10 alphabet characters, numbers, and underscores. This
follows the PCRE standard and is equal to <code>[a-zA-Z0-9_]{10}</code>.</p>
</li>
<li>
<p><code>[\d]{10}</code> produces 10 numbers. This is equal to <code>[0-9]{10}</code>.</p>
</li>
<li>
<p><code>[\a]{10}</code> produces 10 alphabetical characters. This is equal to
<code>[a-zA-Z]{10}</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example of a full template with parameter definitions and references:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">kind: Template
apiVersion: v1
metadata:
  name: my-template
objects:
  - kind: BuildConfig
    apiVersion: v1
    metadata:
      name: cakephp-mysql-example
      annotations:
        description: Defines how to build the application
    spec:
      source:
        type: Git
        git:
          uri: "${SOURCE_REPOSITORY_URL}" <b class="conum">(1)</b>
          ref: "${SOURCE_REPOSITORY_REF}"
        contextDir: "${CONTEXT_DIR}"
  - kind: DeploymentConfig
    apiVersion: v1
    metadata:
      name: frontend
    spec:
      replicas: "${{REPLICA_COUNT}}" <b class="conum">(2)</b>
parameters:
  - name: SOURCE_REPOSITORY_URL <b class="conum">(3)</b>
    displayName: Source Repository URL <b class="conum">(4)</b>
    description: The URL of the repository with your application source code <b class="conum">(5)</b>
    value: https://github.com/sclorg/cakephp-ex.git <b class="conum">(6)</b>
    required: true <b class="conum">(7)</b>
  - name: GITHUB_WEBHOOK_SECRET
    description: A secret string used to configure the GitHub webhook
    generate: expression <b class="conum">(8)</b>
    from: "[a-zA-Z0-9]{40}" <b class="conum">(9)</b>
  - name: REPLICA_COUNT
    description: Number of replicas to run
    value: "2"
    required: true
message: "... The GitHub webhook secret is ${GITHUB_WEBHOOK_SECRET} ..." <b class="conum">(10)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This value will be replaced with the value of the <code>SOURCE_REPOSITORY_URL</code>
parameter when the template is instantiated.</p>
</li>
<li>
<p>This value will be replaced with the unquoted value of the <code>REPLICA_COUNT</code>
parameter when the template is instantiated.</p>
</li>
<li>
<p>The name of the parameter. This value is used to
reference the parameter within the template.</p>
</li>
<li>
<p>The user-friendly name for the parameter. This will be displayed to users.</p>
</li>
<li>
<p>A description of the parameter. Provide more detailed information for the purpose
of the parameter, including any constraints on the expected value. Descriptions should
use complete sentences to follow the console&#8217;s text standards.
Don&#8217;t make this a duplicate of the display name.</p>
</li>
<li>
<p>A default value for the parameter which will be used if the user does not
override the value when instantiating the template. Avoid using default values for things like passwords, instead
use generated parameters in combination with Secrets.</p>
</li>
<li>
<p>Indicates this parameter is required, meaning the user cannot override it
with an empty value. If the parameter does not provide a default or generated
value, the user must supply a value.</p>
</li>
<li>
<p>A parameter which has its value generated.</p>
</li>
<li>
<p>The input to the generator. In this case, the generator will produce a 40
character alphanumeric value including upper and lowercase characters.</p>
</li>
<li>
<p>Parameters can be included in the template message. This informs the
user about generated values.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="templates-writing-object-list-using-templates">Writing the template object list</h4>
<div class="paragraph">
<p>The main portion of the template is the list of objects which will be created
when the template is instantiated. This can be any valid API object, such as a
<code>BuildConfig</code>, <code>DeploymentConfig</code>, <code>Service</code>, etc. The object will be
created exactly as defined here, with any parameter values substituted in prior
to creation. The definition of these objects can reference parameters defined
earlier.</p>
</div>
<div class="paragraph">
<p>The following is an example of an object list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">kind: "Template"
apiVersion: "v1"
metadata:
  name: my-template
objects:
  - kind: "Service" <b class="conum">(1)</b>
    apiVersion: "v1"
    metadata:
      name: "cakephp-mysql-example"
      annotations:
        description: "Exposes and load balances the application pods"
    spec:
      ports:
        - name: "web"
          port: 8080
          targetPort: 8080
      selector:
        name: "cakephp-mysql-example"</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The definition of a <code>Service</code> which will be created by this template.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If an object definition&#8217;s metadata includes a fixed <code>namespace</code> field value, the
field will be stripped out of the definition during template instantiation. If
the <code>namespace</code> field contains a parameter reference, normal parameter
substitution will be performed and the object will be created in whatever
namespace the parameter substitution resolved the value to, assuming the user
has permission to create objects in that namespace.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="templates-marking-as-bindable-using-templates">Marking a template as bindable</h4>
<div class="paragraph">
<p>The Template Service Broker advertises one service in its catalog for each
Template object of which it is aware. By default, each of these services is
advertised as being "bindable", meaning an end user is permitted to bind against
the provisioned service.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Template authors can prevent end users from binding against services provisioned
from a given Template.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prevent end user from binding against services provisioned from a given
template by adding the annotation <code>template.openshift.io/bindable: "false"</code>
to the Template.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="templates-exposing-object-fields-using-templates">Exposing template object fields</h4>
<div class="paragraph">
<p>Template authors can indicate that fields of particular objects in a template
should be exposed. The Template Service Broker recognizes exposed fields on
ConfigMap, Secret, Service and Route objects, and returns the values of the
exposed fields when a user binds a service backed by the broker.</p>
</div>
<div class="paragraph">
<p>To expose one or more fields of an object, add annotations prefixed by
<code>template.openshift.io/expose-</code> or <code>template.openshift.io/base64-expose-</code> to
the object in the template.</p>
</div>
<div class="paragraph">
<p>Each annotation key, with its prefix removed, is passed through to become a key
in a <code>bind</code> response.</p>
</div>
<div class="paragraph">
<p>Each annotation value is a Kubernetes JSONPath expression, which is resolved at
bind time to indicate the object field whose value should be returned in the
<code>bind</code> response.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><code>Bind</code> response key/value pairs can be used in other parts of the system as
environment variables. Therefore, it is recommended that every annotation key
with its prefix removed should be a valid environment variable name&#8201;&#8212;&#8201;beginning with a character <code>A-Z</code>, <code>a-z</code>, or <code>_</code>, and being followed by zero or
more characters <code>A-Z</code>, <code>a-z</code>, <code>0-9</code>, or <code>_</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Unless escaped with a backslash, Kubernetes' JSONPath implementation interprets
characters such as <code>.</code>, <code>@</code>, and others as metacharacters, regardless of their
position in the expression. Therefore, for example, to refer to a <code>ConfigMap</code>
datum named <code>my.key</code>, the required JSONPath expression would be
<code>{.data['my\.key']}</code>. Depending on how the JSONPath expression is then written in YAML,
an additional backslash might be required, for example <code>"{.data['my\\.key']}"</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following is an example of different objects' fields being exposed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">kind: Template
apiVersion: v1
metadata:
  name: my-template
objects:
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: my-template-config
    annotations:
      template.openshift.io/expose-username: "{.data['my\\.username']}"
  data:
    my.username: foo
- kind: Secret
  apiVersion: v1
  metadata:
    name: my-template-config-secret
    annotations:
      template.openshift.io/base64-expose-password: "{.data['password']}"
  stringData:
    password: bar
- kind: Service
  apiVersion: v1
  metadata:
    name: my-template-service
    annotations:
      template.openshift.io/expose-service_ip_port: "{.spec.clusterIP}:{.spec.ports[?(.name==\"web\")].port}"
  spec:
    ports:
    - name: "web"
      port: 8080
- kind: Route
  apiVersion: v1
  metadata:
    name: my-template-route
    annotations:
      template.openshift.io/expose-uri: "http://{.spec.host}{.spec.path}"
  spec:
    path: mypath</code></pre>
</div>
</div>
<div class="paragraph">
<p>An example response to a <code>bind</code> operation given the above partial template
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "credentials": {
    "username": "foo",
    "password": "YmFy",
    "service_ip_port": "172.30.12.34:8080",
    "uri": "http://route-test.router.default.svc.cluster.local/mypath"
  }
}</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Use the <code>template.openshift.io/expose-</code> annotation to return the field value as
a string. This is convenient, although it does not handle arbitrary binary data.</p>
</li>
<li>
<p>If you want to return binary data, use the
<code>template.openshift.io/base64-expose-</code> annotation instead to base64 encode the
data before it is returned.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="templates-waiting-for-readiness-using-templates">Waiting for template readiness</h4>
<div class="paragraph">
<p>Template authors can indicate that certain objects within a template
should be waited for before a template instantiation by the service catalog,
Template Service Broker, or TemplateInstance API is considered complete.</p>
</div>
<div class="paragraph">
<p>To use this feature, mark one or more objects of kind
<code>Build</code>, <code>BuildConfig</code>, <code>Deployment</code>, <code>DeploymentConfig</code>, <code>Job</code>, or <code>StatefulSet</code>
in a template with the following annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">"template.alpha.openshift.io/wait-for-ready": "true"</pre>
</div>
</div>
<div class="paragraph">
<p>Template instantiation will not complete until all objects marked with the
annotation report ready. Similarly, if any of the annotated objects report
failed, or if the template fails to become ready within a fixed timeout of one
hour, the template instantiation will fail.</p>
</div>
<div class="paragraph">
<p>For the purposes of instantiation, readiness and failure of each object kind are
defined as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Kind</th>
<th class="tableblock halign-left valign-top">Readiness</th>
<th class="tableblock halign-left valign-top">Failure</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Build</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Object reports phase Complete</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Object reports phase Canceled, Error, or Failed</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>BuildConfig</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Latest associated Build object reports phase Complete</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Latest associated Build object reports phase Canceled, Error, or Failed</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Deployment</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Object reports new ReplicaSet and deployment available (this honors readiness
probes defined on the object)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Object reports Progressing condition as false</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DeploymentConfig</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Object reports new ReplicationController and deployment available (this
honors readiness probes defined on the object)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Object reports Progressing condition as false</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Job</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Object reports completion</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Object reports that one or more failures have occurred</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>StatefulSet</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Object reports all replicas ready (this honors readiness probes defined on
the object)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Not applicable</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following is an example template extract, which uses the <code>wait-for-ready</code>
annotation. Further examples can be found in the OpenShift quickstart templates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">kind: Template
apiVersion: v1
metadata:
  name: my-template
objects:
- kind: BuildConfig
  apiVersion: v1
  metadata:
    name: ...
    annotations:
      # wait-for-ready used on BuildConfig ensures that template instantiation
      # will fail immediately if build fails
      template.alpha.openshift.io/wait-for-ready: "true"
  spec:
    ...
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ...
    annotations:
      template.alpha.openshift.io/wait-for-ready: "true"
  spec:
    ...
- kind: Service
  apiVersion: v1
  metadata:
    name: ...
  spec:
    ...</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Additional recommendations</div>
<ul>
<li>
<p>Set memory, CPU, and storage
default sizes to make sure your application is given enough resources to run
smoothly.</p>
</li>
<li>
<p>Avoid referencing the <code>latest</code> tag from images if that tag is used across major
versions. This may cause running applications to break when new images are
pushed to that tag.</p>
</li>
<li>
<p>A good template builds and deploys cleanly without requiring modifications
after the template is deployed.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="templates-create-from-existing-object-using-templates">Creating a template from existing objects</h4>
<div class="paragraph">
<p>Rather than writing an entire template from scratch, you can export existing
objects from your project in YAML form, and then modify the YAML from there by
adding parameters and other customizations as template form.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Export objects in a project in YAML form:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get -o yaml --export all &gt; &lt;yaml_filename&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>You can also substitute a particular resource type or multiple resources instead of <code>all</code>.
Run <code>oc get -h</code> for more examples.</p>
</div>
<div class="paragraph">
<p>The object types included in <code>oc get --export all</code> are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BuildConfig</p>
</li>
<li>
<p>Build</p>
</li>
<li>
<p>DeploymentConfig</p>
</li>
<li>
<p>ImageStream</p>
</li>
<li>
<p>Pod</p>
</li>
<li>
<p>ReplicationController</p>
</li>
<li>
<p>Route</p>
</li>
<li>
<p>Service</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-ruby-on-rails">Using Ruby on Rails</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ruby on Rails is a web framework written in Ruby. This guide covers
using Rails 4 on OpenShift Enterprise.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Go through the whole tutorial to have an overview of all
the steps necessary to run your application on the OpenShift Enterprise. If you
experience a problem try reading through the entire tutorial and then going back
to your issue. It can also be useful to review your previous steps to ensure
that all the steps were executed correctly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Basic Ruby and Rails knowledge.</p>
</li>
<li>
<p>Locally installed version of Ruby 2.0.0+, Rubygems, Bundler.</p>
</li>
<li>
<p>Basic Git knowledge.</p>
</li>
<li>
<p>Running instance of OpenShift Enterprise 4.</p>
</li>
<li>
<p>Make sure that an instance of OpenShift Enterprise is running and is available. Also
make sure that your <code>oc</code> CLI client is installed and the command is accessible
from your command shell, so you can use it to log in using your email address
and password.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="templates-rails-setting-up-database-templates-ruby-on-rails">Setting up the database</h3>
<div class="paragraph">
<p>Rails applications are almost always used with a database. For the local
development use the PostgreSQL database.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the database:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo yum install -y postgresql postgresql-server postgresql-devel</pre>
</div>
</div>
</li>
<li>
<p>Initialize the database:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo postgresql-setup initdb</pre>
</div>
</div>
<div class="paragraph">
<p>This command will create the <code>/var/lib/pgsql/data</code> directory, in which the data
will be stored.</p>
</div>
</li>
<li>
<p>Start the database:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo systemctl start postgresql.service</pre>
</div>
</div>
</li>
<li>
<p>When the database is running, create your <code>rails</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo -u postgres createuser -s rails</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the user created has no password.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="templates-rails-writing-application-templates-ruby-on-rails">Writing your application</h3>
<div class="paragraph">
<p>If you are starting your Rails application from scratch, you need to install the
Rails gem first. Then you can proceed with writing your application.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the Rails gem:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ gem install rails
Successfully installed rails-4.2.0
1 gem installed</pre>
</div>
</div>
</li>
<li>
<p>After you install the Rails gem, create a new application with PostgreSQL as
your database:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ rails new rails-app --database=postgresql</pre>
</div>
</div>
</li>
<li>
<p>Change into your new application directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ cd rails-app</pre>
</div>
</div>
</li>
<li>
<p>If you already have an application, make sure the <code>pg</code> (postgresql) gem is
present in your <code>Gemfile</code>. If not, edit your <code>Gemfile</code> by adding the gem:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">gem 'pg'</pre>
</div>
</div>
</li>
<li>
<p>Generate a new <code>Gemfile.lock</code> with all your dependencies:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ bundle install</pre>
</div>
</div>
</li>
<li>
<p>In addition to using the <code>postgresql</code> database with the <code>pg</code> gem, you will also
need to ensure the <code>config/database.yml</code> is using the <code>postgresql</code> adapter.</p>
<div class="paragraph">
<p>Make sure you updated <code>default</code> section in the <code>config/database.yml</code> file, so it
looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">default: &amp;default
  adapter: postgresql
  encoding: unicode
  pool: 5
  host: localhost
  username: rails
  password:</pre>
</div>
</div>
</li>
<li>
<p>Create your application&#8217;s development and test databases:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ rake db:create</pre>
</div>
</div>
<div class="paragraph">
<p>This will create <code>development</code> and <code>test</code> database in your PostgreSQL server.</p>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="templates-rails-creating-welcome-page-templates-ruby-on-rails">Creating a welcome page</h4>
<div class="paragraph">
<p>Since Rails 4 no longer serves a static <code>public/index.html</code> page in production,
you must create a new root page.</p>
</div>
<div class="paragraph">
<p>In order to have a custom welcome page must do following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a <strong>controller</strong> with an index action</p>
</li>
<li>
<p>Create a <strong>view</strong> page for the <code>welcome</code> controller <code>index</code> action</p>
</li>
<li>
<p>Create a <strong>route</strong> that will serve applications root page with the created
<strong>controller</strong> and <strong>view</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Rails offers a generator that will do all necessary steps for you.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run Rails generator:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ rails generate controller welcome index</pre>
</div>
</div>
<div class="paragraph">
<p>All the necessary files are created.</p>
</div>
</li>
<li>
<p>edit line 2 in <code>config/routes.rb</code> file as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">root 'welcome#index'</pre>
</div>
</div>
</li>
<li>
<p>Run the rails server to verify the page is available:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ rails server</pre>
</div>
</div>
<div class="paragraph">
<p>You should see your page by visiting <strong><a href="http://localhost:3000" class="bare">http://localhost:3000</a></strong> in your browser.
If you don&#8217;t see the page, check the logs that are output to your server to debug.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="templates-rails-configuring-application-templates-ruby-on-rails">Configuring application for OpenShift Enterprise</h4>
<div class="paragraph">
<p>To have your application communicate with the PostgreSQL database
service running in OpenShift Enterprise you will need to edit the
<code>default</code> section in your <code>config/database.yml</code> to use environment
variables, which you will define later, upon the database service creation.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Edit the <code>default</code> section in your <code>config/database.yml</code> with
pre-defined variables as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;% user = ENV.key?("POSTGRESQL_ADMIN_PASSWORD") ? "root" : ENV["POSTGRESQL_USER"] %&gt;
&lt;% password = ENV.key?("POSTGRESQL_ADMIN_PASSWORD") ? ENV["POSTGRESQL_ADMIN_PASSWORD"] : ENV["POSTGRESQL_PASSWORD"] %&gt;
&lt;% db_service = ENV.fetch("DATABASE_SERVICE_NAME","").upcase %&gt;

default: &amp;default
  adapter: postgresql
  encoding: unicode
  # For details on connection pooling, see rails configuration guide
  # http://guides.rubyonrails.org/configuring.html#database-pooling
  pool: &lt;%= ENV["POSTGRESQL_MAX_CONNECTIONS"] || 5 %&gt;
  username: &lt;%= user %&gt;
  password: &lt;%= password %&gt;
  host: &lt;%= ENV["#{db_service}_SERVICE_HOST"] %&gt;
  port: &lt;%= ENV["#{db_service}_SERVICE_PORT"] %&gt;
  database: &lt;%= ENV["POSTGRESQL_DATABASE"] %&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="templates-rails-storing-application-in-git-templates-ruby-on-rails">Storing your application in Git</h4>
<div class="paragraph">
<p>Building an application in OpenShift Enterprise usually requires that the source code
be stored in a git repository, so you will need to
install <code>git</code> if you do not already have it.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install git.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Make sure you are in your Rails application directory by running the <code>ls -1</code>
command. The output of the command should look like:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ls -1
app
bin
config
config.ru
db
Gemfile
Gemfile.lock
lib
log
public
Rakefile
README.rdoc
test
tmp
vendor</pre>
</div>
</div>
</li>
<li>
<p>Run the following commands in your Rails app directory to initialize and commit
your code to git:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ git init
$ git add .
$ git commit -m "initial commit"</pre>
</div>
</div>
<div class="paragraph">
<p>+
Once your application is committed you need to push it to a remote repository.
GitHub account, in which you create a new repository.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the remote that points to your <code>git</code> repository:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ git remote add origin git@github.com:&lt;namespace/repository-name&gt;.git</pre>
</div>
</div>
</li>
<li>
<p>Push your application to your remote git repository.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ git push</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="templates-rails-deploying-application-templates-ruby-on-rails">Deploying your application to OpenShift Enterprise</h3>
<div class="paragraph">
<p>You can deploy you application to OpenShift Enterprise.</p>
</div>
<div class="paragraph">
<p>After creating the <code>rails-app</code> project, you will be automatically switched to
the new project namespace.</p>
</div>
<div class="paragraph">
<p>Deploying your application in OpenShift Enterprise involves three steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating a database service from OpenShift Enterprise&#8217;s PostgreSQL image.</p>
</li>
<li>
<p>Creating a frontend service from OpenShift Enterprise&#8217;s Ruby 2.0 builder image and
your Ruby on Rails source code, which are wired with the database service.</p>
</li>
<li>
<p>Creating a route for your application.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To deploy your Ruby on Rails application, create a new Project for the
application:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc new-project rails-app --description="My Rails application" --display-name="Rails Application"</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="templates-rails-creating-database-service-templates-ruby-on-rails">Creating the database service</h4>
<div class="paragraph">
<p>Your Rails application expects a running database service. For this service use
PostgeSQL database image.</p>
</div>
<div class="paragraph">
<p>To create the database service you will use the <code>oc new-app</code> command. To this
command you will need to pass some necessary environment variables which will be
used inside the database container. These environment variables are required to
set the username, password, and name of the database. You can change the values
of these environment variables to anything you would like. The variables are as
follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>POSTGRESQL_DATABASE</p>
</li>
<li>
<p>POSTGRESQL_USER</p>
</li>
<li>
<p>POSTGRESQL_PASSWORD</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Setting these variables ensures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A database exists with the specified name.</p>
</li>
<li>
<p>A user exists with the specified name.</p>
</li>
<li>
<p>The user can access the specified database with the specified password.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the database service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc new-app postgresql -e POSTGRESQL_DATABASE=db_name -e POSTGRESQL_USER=username -e POSTGRESQL_PASSWORD=password</pre>
</div>
</div>
<div class="paragraph">
<p>To also set the password for the database administrator, append to the previous
command with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">-e POSTGRESQL_ADMIN_PASSWORD=admin_pw</pre>
</div>
</div>
</li>
<li>
<p>Watch the progress:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get pods --watch</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="templates-rails-creating-frontend-service-templates-ruby-on-rails">Creating the frontend service</h4>
<div class="paragraph">
<p>To bring your application to OpenShift Enterprise, you need to specify a repository
in which your application lives.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the frontend service and specify database related
environment variables that were setup when creating the database service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc new-app path/to/source/code --name=rails-app -e POSTGRESQL_USER=username -e POSTGRESQL_PASSWORD=password -e POSTGRESQL_DATABASE=db_name -e DATABASE_SERVICE_NAME=postgresql</pre>
</div>
</div>
<div class="paragraph">
<p>With this command, OpenShift Enterprise fetches the source code, sets up the builder
builds your application image, and deploys the newly created image together with
the specified environment variables. The application is named <code>rails-app</code>.</p>
</div>
</li>
<li>
<p>Verify the environment variables have been added by viewing the JSON document of
the <code>rails-app</code> DeploymentConfig:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get dc rails-app -o json</pre>
</div>
</div>
<div class="paragraph">
<p>You should see the following section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">env": [
    {
        "name": "POSTGRESQL_USER",
        "value": "username"
    },
    {
        "name": "POSTGRESQL_PASSWORD",
        "value": "password"
    },
    {
        "name": "POSTGRESQL_DATABASE",
        "value": "db_name"
    },
    {
        "name": "DATABASE_SERVICE_NAME",
        "value": "postgresql"
    }

],</pre>
</div>
</div>
</li>
<li>
<p>Check the build process:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc logs -f build/rails-app-1</pre>
</div>
</div>
</li>
<li>
<p>Once the build is complete, look at the running pods in OpenShift Enterprise:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get pods</pre>
</div>
</div>
<div class="paragraph">
<p>You should see a line starting with <code>myapp-&lt;number&gt;-&lt;hash&gt;</code>, and that is your
application running in OpenShift Enterprise.</p>
</div>
</li>
<li>
<p>Before your application will be functional, you need to initialize the database
by running the database migration script. There are two ways you can do this:</p>
<div class="ulist">
<ul>
<li>
<p>Manually from the running frontend container:</p>
<div class="ulist">
<ul>
<li>
<p>Exec into frontend container with <code>rsh</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  $ oc rsh &lt;FRONTEND_POD_ID&gt;</pre>
</div>
</div>
</li>
<li>
<p>Run the migration from inside the container:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  $ RAILS_ENV=production bundle exec rake db:migrate</pre>
</div>
</div>
<div class="paragraph">
<p>If you are running your Rails application in a <code>development</code> or <code>test</code>
environment you don&#8217;t have to specify the <code>RAILS_ENV</code> environment variable.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>By adding pre-deployment lifecycle hooks in your template.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="templates-rails-creating-route-for-application-templates-ruby-on-rails">Creating a route for your application</h4>
<div class="paragraph">
<p>You can expose a service to create a route for your application.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To expose a service by giving it an externally-reachable hostname like
<code>www.example.com</code> use OpenShift Enterprise route. In your case you need
to expose the frontend service by typing:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc expose service rails-app --hostname=www.example.com</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure the hostname you specify resolves into the IP address of the router.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-04-12 23:56:12 UTC
</div>
</div>
</body>
</html>
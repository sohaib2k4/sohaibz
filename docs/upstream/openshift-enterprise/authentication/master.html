<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Authentication</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Authentication</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="understanding-authentication">Understanding authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For users to interact with OpenShift Enterprise, they must first authenticate
to the cluster. The authentication layer identifies the user associated with requests to the
OpenShift Enterprise API. The authorization layer then uses information about the
requesting user to determine if the request is allowed.</p>
</div>
<div class="paragraph">
<p>As an administrator, you can configure authentication for OpenShift Enterprise.</p>
</div>
<div class="sect2">
<h3 id="rbac-users-understanding-authentication">Users</h3>
<div class="paragraph">
<p>A <em>user</em> in OpenShift Enterprise is an entity that can make requests to the
OpenShift Enterprise API. An OpenShift Enterprise user object represents an actor which
can be granted permissions in the system by adding roles to them or to their
groups. Typically, this represents the account of a developer or
administrator that is interacting with OpenShift Enterprise.</p>
</div>
<div class="paragraph">
<p>Several types of users can exist:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Regular users</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the way most interactive OpenShift Enterprise users are
represented. Regular users are created automatically in the system upon
first login or can be created via the API. Regular users are represented
with the <code>User</code> object. Examples: <code>joe</code> <code>alice</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>System users</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Many of these are created automatically when the infrastructure
 is defined, mainly for the purpose of enabling the infrastructure to
 interact with the API securely. They include a cluster administrator
 (with access to everything), a per-node user, users for use by routers
 and registries, and various others. Finally, there is an <code>anonymous</code>
 system user that is used by default for unauthenticated requests. Examples:
<code>system:admin</code> <code>system:openshift-registry</code> <code>system:node:node1.example.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Service accounts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">These are special system users associated with projects; some are created automatically when
the project is first created, while project administrators can create more
for the purpose of defining access to the contents of each project.
Service accounts are represented with the <code>ServiceAccount</code> object. Examples:
<code>system:serviceaccount:default:deployer</code> <code>system:serviceaccount:foo:builder</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each user must authenticate in
some way in order to access OpenShift Enterprise. API requests with no authentication
or invalid authentication are authenticated as requests by the <code>anonymous</code>
system user. Once authenticated, policy determines what the user is
authorized to do.</p>
</div>
</div>
<div class="sect2">
<h3 id="rbac-groups-understanding-authentication">Groups</h3>
<div class="paragraph">
<p>A user can be assigned to one or more <em>groups</em>, each of which represent a
certain set of users. Groups are useful when managing authorization policies
to grant permissions to multiple users at once, for example allowing
access to objects within a project, versus granting
them to users individually.</p>
</div>
<div class="paragraph">
<p>In addition to explicitly defined groups, there are also
system groups, or <em>virtual groups</em>, that are automatically provisioned by
the cluster.</p>
</div>
<div class="paragraph">
<p>The following default virtual groups are most important:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Virtual group</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>system:authenticated</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automatically associated with all authenticated users.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>system:authenticated:oauth</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automatically associated with all users authenticated with an OAuth access token.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>system:unauthenticated</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automatically associated with all unauthenticated users.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="rbac-api-authentication-understanding-authentication">API authentication</h3>
<div class="paragraph">
<p>Requests to the OpenShift Enterprise API are authenticated using the following
methods:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">OAuth Access Tokens</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Obtained from the OpenShift Enterprise OAuth server using the
<code><em>&lt;namespace_route&gt;</em>/oauth/authorize</code> and <code><em>&lt;namespace_route&gt;</em>/oauth/token</code>
endpoints.</p>
</li>
<li>
<p>Sent as an <code>Authorization: Bearer&#8230;&#8203;</code> header.</p>
</li>
<li>
<p>Sent as a websocket subprotocol header in the form
<code>base64url.bearer.authorization.k8s.io.&lt;base64url-encoded-token&gt;</code> for websocket
requests.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">X.509 Client Certificates</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Requires a HTTPS connection to the API server.</p>
</li>
<li>
<p>Verified by the API server against a trusted certificate authority bundle.</p>
</li>
<li>
<p>The API server creates and distributes certificates to controllers to authenticate themselves.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Any request with an invalid access token or an invalid certificate is rejected
by the authentication layer with a 401 error.</p>
</div>
<div class="paragraph">
<p>If no access token or certificate is presented, the authentication layer assigns
the <code>system:anonymous</code> virtual user and the <code>system:unauthenticated</code> virtual
group to the request. This allows the authorization layer to determine which
requests, if any, an anonymous user is allowed to make.</p>
</div>
<div class="sect3">
<h4 id="oauth-server-overview-understanding-authentication">OpenShift Enterprise OAuth server</h4>
<div class="paragraph">
<p>The OpenShift Enterprise master includes a built-in OAuth server. Users obtain OAuth
access tokens to authenticate themselves to the API.</p>
</div>
<div class="paragraph">
<p>When a person requests a new OAuth token, the OAuth server uses the configured
identity provider
to determine the identity of the person making the request.</p>
</div>
<div class="paragraph">
<p>It then determines what user that identity maps to, creates an access token for
that user, and returns the token for use.</p>
</div>
<div class="sect4">
<h5 id="oauth-token-requests-understanding-authentication">OAuth token requests</h5>
<div class="paragraph">
<p>Every request for an OAuth token must specify the OAuth client that will
receive and use the token. The following OAuth clients are automatically
created when starting the OpenShift Enterprise API:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">OAuth Client</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>openshift-browser-client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requests tokens at <code><em>&lt;namespace_route&gt;</em>/oauth/token/request</code> with a user-agent that can handle interactive logins.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>openshift-challenging-client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requests tokens with a user-agent that can handle <code>WWW-Authenticate</code> challenges.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><em>&lt;namespace_route&gt;</em> refers to the namespace&#8217;s route. This is found by
running the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">oc get route openshift-authentication -n openshift-authentication -o json | jq .spec.host</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All requests for OAuth tokens involve a request to
<code><em>&lt;namespace_route&gt;</em>/oauth/authorize</code>. Most authentication integrations place an
authenticating proxy in front of this endpoint, or configure
OpenShift Enterprise to validate credentials against a backing identity provider.
Requests to <code><em>&lt;namespace_route&gt;</em>/oauth/authorize</code> can come from user-agents that
cannot display interactive login pages, such as the CLI. Therefore,
OpenShift Enterprise supports authenticating using a <code>WWW-Authenticate</code>
challenge in addition to interactive login flows.</p>
</div>
<div class="paragraph">
<p>If an authenticating proxy is placed in front of the
<code><em>&lt;namespace_route&gt;</em>/oauth/authorize</code> endpoint, it sends unauthenticated,
non-browser user-agents <code>WWW-Authenticate</code> challenges rather than
displaying an interactive login page or redirecting to an interactive
login flow.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>To prevent cross-site request forgery (CSRF) attacks against browser
clients,  only send Basic authentication challenges with if a
<code>X-CSRF-Token</code> header is on the request. Clients that expect
to receive Basic <code>WWW-Authenticate</code> challenges must set this header to a
non-empty value.</p>
</div>
<div class="paragraph">
<p>If the authenticating proxy cannot support <code>WWW-Authenticate</code> challenges,
or if OpenShift Enterprise is configured to use an identity provider that does
not support WWW-Authenticate challenges, you must use a browser to manually
obtain a token from
<code><em>&lt;namespace_route&gt;</em>/oauth/token/request</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="authentication-api-impersonation-understanding-authentication">API impersonation</h5>
<div class="paragraph">
<p>A request to the OpenShift Enterprise API can include an <code>Impersonate-User</code> header,
which indicates that the requester wants the request handled as though
it came from the specified user.</p>
</div>
<div class="paragraph">
<p>Before User A can impersonate User B, User A is authenticated.
Then, an authorization check occurs to ensure that User A is allowed to
impersonate the user named User B. If User A is requesting to impersonate a
service account, <code>system:serviceaccount:namespace:name</code>, OpenShift Enterprise confirms
that User A can impersonate the <code>serviceaccount</code> named <code>name</code> in
<code>namespace</code>. If the check fails, the request fails with a 403 (Forbidden) error
code.</p>
</div>
<div class="paragraph">
<p>By default, project administrators and editors can impersonate
service accounts in their namespace.
The <code>sudoers</code> role allows a user to
impersonate <code>system:admin</code>, which in turn has cluster administrator permissions.
The ability to impersonate <code>system:admin</code> grants some protection against typos,
but not security, for someone
administering the cluster. For example, running <code>oc delete nodes --all</code> fails,
but running <code>oc delete nodes --all --as=system:admin</code> succeeds.</p>
</div>
</div>
<div class="sect4">
<h5 id="authentication-prometheus-system-metrics-understanding-authentication">Authentication metrics for Prometheus</h5>
<div class="paragraph">
<p>OpenShift Enterprise captures the following Prometheus system metrics during authentication attempts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>openshift_auth_basic_password_count</code> counts the number of <code>oc login</code> user name and password attempts.</p>
</li>
<li>
<p><code>openshift_auth_basic_password_count_result</code> counts the number of <code>oc login</code> user name and password attempts by result, <code>success</code> or <code>error</code>.</p>
</li>
<li>
<p><code>openshift_auth_form_password_count</code> counts the number of web console login attempts.</p>
</li>
<li>
<p><code>openshift_auth_form_password_count_result</code> counts the number of web console login attempts by result, <code>success</code> or <code>error</code>.</p>
</li>
<li>
<p><code>openshift_auth_password_total</code> counts the total number of <code>oc login</code> and web console login attempts.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-the-internal-oauth-server">Configuring the internal OAuth server</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Configuring these options will need to change because they&#8217;re set in the master
config file now.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="oauth-server-overview-configuring-internal-oauth">OpenShift Enterprise OAuth server</h3>
<div class="paragraph">
<p>The OpenShift Enterprise master includes a built-in OAuth server. Users obtain OAuth
access tokens to authenticate themselves to the API.</p>
</div>
<div class="paragraph">
<p>When a person requests a new OAuth token, the OAuth server uses the configured
identity provider
to determine the identity of the person making the request.</p>
</div>
<div class="paragraph">
<p>It then determines what user that identity maps to, creates an access token for
that user, and returns the token for use.</p>
</div>
</div>
<div class="sect2">
<h3 id="oauth-token-request-flows-configuring-internal-oauth">OAuth token request flows and responses</h3>
<div class="paragraph">
<p>The OAuth server supports standard
<a href="https://tools.ietf.org/html/rfc6749#section-4.1">authorization code grant</a>
and the <a href="https://tools.ietf.org/html/rfc6749#section-4.2">implicit grant</a>
OAuth authorization flows.</p>
</div>
<div class="paragraph">
<p>When requesting an OAuth token using the implicit grant flow
(<code>response_type=token</code>) with a client_id configured to request <code>WWW-Authenticate challenges</code>
(like <code>openshift-challenging-client</code>), these are the possible server
responses from <code>/oauth/authorize</code>, and how they should be handled:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Status</th>
<th class="tableblock halign-left valign-top">Content</th>
<th class="tableblock halign-left valign-top">Client response</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>302</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Location</code> header containing an <code>access_token</code> parameter in the URL fragment (<a href="https://tools.ietf.org/html/rfc6749#section-4.2.2">RFC 4.2.2</a>)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Use the <code>access_token</code> value as the OAuth token</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>302</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Location</code> header containing an <code>error</code> query parameter (<a href="https://tools.ietf.org/html/rfc6749#section-4.1.2.1">RFC 4.1.2.1</a>)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Fail, optionally surfacing the <code>error</code> (and optional <code>error_description</code>) query values to the user</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>302</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Other <code>Location</code> header</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Follow the redirect, and process the result using these rules</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>401</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>WWW-Authenticate</code> header present</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Respond to challenge if type is recognized (e.g. <code>Basic</code>, <code>Negotiate</code>, etc), resubmit request, and process the result using these rules</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>401</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>WWW-Authenticate</code> header missing</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No challenge authentication is possible. Fail and show response body (which might contain links or details on alternate methods to obtain an OAuth token)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Other</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Other</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Fail, optionally surfacing response body to the user</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="oauth-internal-options-configuring-internal-oauth">Options for the internal OAuth server</h3>
<div class="paragraph">
<p>Several configuration options are available for the internal OAuth server.</p>
</div>
<div class="sect3">
<h4 id="oauth-token-duration-configuring-internal-oauth">OAuth token duration options</h4>
<div class="paragraph">
<p>The internal OAuth server generates two kinds of tokens:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Access tokens
</td>
<td class="hdlist2">
<p>Longer-lived tokens that grant access to the API.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Authorize codes
</td>
<td class="hdlist2">
<p>Short-lived tokens whose only use is to be exchanged for
an access token.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can configure the default duration for both types of token. If necessary,
you can override the duration of the access token by using an <code>OAuthClient</code>
object definition.</p>
</div>
</div>
<div class="sect3">
<h4 id="oauth-grant-options-configuring-internal-oauth">OAuth grant options</h4>
<div class="paragraph">
<p>When the OAuth server receives token requests for a client to which the user
has not previously granted permission, the action that the OAuth server takes
is dependent on the OAuth client&#8217;s grant strategy.</p>
</div>
<div class="paragraph">
<p>When the OAuth client requesting token does not provide its own grant strategy,
the server-wide default strategy is used. You can apply the following default
methods:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>auto</code>
</td>
<td class="hdlist2">
<p>Auto-approve the grant and retry the request.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>prompt</code>
</td>
<td class="hdlist2">
<p>Prompt the user to approve or deny the grant.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>deny</code>
</td>
<td class="hdlist2">
<p>Auto-deny the grant and return a failure error to the client.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="oauth-configuring-internal-oauth-configuring-internal-oauth">Configuring options for the internal OAuth server</h3>
<div class="paragraph">
<p>You can configure default options for the internal OAuth server&#8217;s
token duration.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Set the token duration options:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">oauthConfig:
  ...
  tokenConfig:
    accessTokenMaxAgeSeconds: 86400 <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Set <code>accessTokenMaxAgeSeconds</code> to control the lifetime of access tokens.
The default lifetime is 24 hours, or 86400 seconds.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="oauth-register-additional-client-configuring-internal-oauth">Register an additional OAuth client</h3>
<div class="paragraph">
<p>If you need an additional OAuth client to manage authentication for your
OpenShift Enterprise cluster, you can register one.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To register additional OAuth clients:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">$ oc create -f &lt;(echo '
kind: OAuthClient
apiVersion: oauth.openshift.io/v1
metadata:
 name: demo <b class="conum">(1)</b>
secret: "..." <b class="conum">(2)</b>
redirectURIs:
 - "http://www.example.com/" <b class="conum">(3)</b>
grantMethod: prompt <b class="conum">(4)</b>
')</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>name</code> of the OAuth client is used as the <code>client_id</code> parameter when
making requests to <code><em>&lt;namespace_route&gt;</em>/oauth/authorize</code> and
<code><em>&lt;namespace_route&gt;</em>/oauth/token</code>.</p>
</li>
<li>
<p>The <code>secret</code> is used as the <code>client_secret</code> parameter when making requests
to <code><em>&lt;namespace_route&gt;</em>/oauth/token</code>.</p>
</li>
<li>
<p>The <code>redirect_uri</code> parameter specified in requests to
<code><em>&lt;namespace_route&gt;</em>/oauth/authorize</code> and <code><em>&lt;namespace_route&gt;</em>/oauth/token</code>
 must be equal to or
prefixed by one of the URIs listed in the <code>redirectURIs</code> parameter value.</p>
</li>
<li>
<p>The <code>grantMethod</code> is used to determine what action to take when this client
requests tokens and has not yet been granted access by the user. Specify <code>auto</code>
to automatically approve the grant and retry the request, <code>prompt</code> to prompt the
user to approve or deny the grant, or <code>deny</code> to deny the grant and return a
failure error to the client.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="oauth-server-metadata-configuring-internal-oauth">OAuth server metadata</h3>
<div class="paragraph">
<p>Applications running in OpenShift Enterprise may need to discover information
about the built-in OAuth server. For example, they might need to discover
what the address of the <code>&lt;namespace_route&gt;</code> is without manual
configuration.  To aid in this, OpenShift Enterprise implements the IETF
<a href="https://tools.ietf.org/html/draft-ietf-oauth-discovery-10">OAuth 2.0 Authorization Server Metadata</a> draft specification.</p>
</div>
<div class="paragraph">
<p>Thus, any application running inside the cluster can issue a <code>GET</code> request
to <strong><em>https://openshift.default.svc/.well-known/oauth-authorization-server</em></strong>
to fetch the following information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{
  "issuer": "https://&lt;namespace_route&gt;", <b class="conum">(1)</b>
  "authorization_endpoint": "https://&lt;namespace_route&gt;/oauth/authorize", <b class="conum">(2)</b>
  "token_endpoint": "https://&lt;namespace_route&gt;/oauth/token", <b class="conum">(3)</b>
  "scopes_supported": [ <b class="conum">(4)</b>
    "user:full",
    "user:info",
    "user:check-access",
    "user:list-scoped-projects",
    "user:list-projects"
  ],
  "response_types_supported": [ <b class="conum">(5)</b>
    "code",
    "token"
  ],
  "grant_types_supported": [ <b class="conum">(6)</b>
    "authorization_code",
    "implicit"
  ],
  "code_challenge_methods_supported": [ <b class="conum">(7)</b>
    "plain",
    "S256"
  ]
}</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The authorization server&#8217;s issuer identifier, which is a URL that uses the
<code>https</code> scheme and has no query or fragment components. This is the location
where <code>.well-known</code> <a href="https://tools.ietf.org/html/rfc5785">RFC 5785</a> resources
containing information about the authorization server are published.</p>
</li>
<li>
<p>URL of the authorization server&#8217;s authorization endpoint. See
<a href="https://tools.ietf.org/html/rfc6749">RFC 6749</a>.</p>
</li>
<li>
<p>URL of the authorization server&#8217;s token endpoint. See
<a href="https://tools.ietf.org/html/rfc6749">RFC 6749</a>.</p>
</li>
<li>
<p>JSON array containing a list of the OAuth 2.0
<a href="https://tools.ietf.org/html/rfc6749">RFC 6749</a> scope values that this
authorization server supports. Note that not all supported scope values are
advertised.</p>
</li>
<li>
<p>JSON array containing a list of the OAuth 2.0 <code>response_type</code> values that this
authorization server supports. The array values used are the same as those used
with the <code>response_types</code> parameter defined by "OAuth 2.0 Dynamic Client
Registration Protocol" in <a href="https://tools.ietf.org/html/rfc7591">RFC 7591</a>.</p>
</li>
<li>
<p>JSON array containing a list of the OAuth 2.0 grant type values that this
authorization server supports. The array values used are the same as those used
with the <code>grant_types</code> parameter defined by
<code>OAuth 2.0 Dynamic Client Registration Protocol</code> in
<a href="https://tools.ietf.org/html/rfc7591">RFC 7591</a>.</p>
</li>
<li>
<p>JSON array containing a list of PKCE
<a href="https://tools.ietf.org/html/rfc7636">RFC 7636</a> code challenge methods
supported by this authorization server. Code challenge method values are used in
the <code>code_challenge_method</code> parameter defined in
<a href="https://tools.ietf.org/html/rfc7636#section-4.3">Section 4.3 of RFC 7636</a>.
The valid code challenge method values are those registered in the IANA
<code>PKCE Code Challenge Methods</code> registry.  See
<a href="http://www.iana.org/assignments/oauth-parameters">IANA OAuth Parameters</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="oauth-troubleshooting-api-events-configuring-internal-oauth">Troubleshooting OAuth API events</h3>
<div class="paragraph">
<p>In some cases the API server returns an <code>unexpected condition</code> error message
that is difficult to debug without direct access to the API master log.
The underlying reason for the error is purposely obscured in order
to avoid providing an unauthenticated user with information about the server&#8217;s state.</p>
</div>
<div class="paragraph">
<p>A subset of these errors is related to service account OAuth configuration issues.
These issues are captured in events that can be viewed by non-administrator users. When encountering
an <code>unexpected condition</code> server error during OAuth, run <code>oc get events</code> to view these events under <code>ServiceAccount</code>.</p>
</div>
<div class="paragraph">
<p>The following example warns of a service account that is missing a proper OAuth redirect URI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get events | grep ServiceAccount
1m         1m          1         proxy                    ServiceAccount                                  Warning   NoSAOAuthRedirectURIs   service-account-oauth-client-getter   system:serviceaccount:myproject:proxy has no redirectURIs; set serviceaccounts.openshift.io/oauth-redirecturi.&lt;some-value&gt;=&lt;redirect&gt; or create a dynamic URI using serviceaccounts.openshift.io/oauth-redirectreference.&lt;some-value&gt;=&lt;reference&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Running <code>oc describe sa/&lt;service-account-name&gt;</code> reports any OAuth events associated with the given service account name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe sa/proxy | grep -A5 Events
Events:
  FirstSeen     LastSeen        Count   From                                    SubObjectPath   Type            Reason                  Message
  ---------     --------        -----   ----                                    -------------   --------        ------                  -------
  3m            3m              1       service-account-oauth-client-getter                     Warning         NoSAOAuthRedirectURIs   system:serviceaccount:myproject:proxy has no redirectURIs; set serviceaccounts.openshift.io/oauth-redirecturi.&lt;some-value&gt;=&lt;redirect&gt; or create a dynamic URI using serviceaccounts.openshift.io/oauth-redirectreference.&lt;some-value&gt;=&lt;reference&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The following is a list of the possible event errors:</p>
</div>
<div class="paragraph">
<p><strong>No redirect URI annotations or an invalid URI is specified</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Reason                  Message
NoSAOAuthRedirectURIs   system:serviceaccount:myproject:proxy has no redirectURIs; set serviceaccounts.openshift.io/oauth-redirecturi.&lt;some-value&gt;=&lt;redirect&gt; or create a dynamic URI using serviceaccounts.openshift.io/oauth-redirectreference.&lt;some-value&gt;=&lt;reference&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Invalid route specified</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Reason                  Message
NoSAOAuthRedirectURIs   [routes.route.openshift.io "&lt;name&gt;" not found, system:serviceaccount:myproject:proxy has no redirectURIs; set serviceaccounts.openshift.io/oauth-redirecturi.&lt;some-value&gt;=&lt;redirect&gt; or create a dynamic URI using serviceaccounts.openshift.io/oauth-redirectreference.&lt;some-value&gt;=&lt;reference&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Invalid reference type specified</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Reason                  Message
NoSAOAuthRedirectURIs   [no kind "&lt;name&gt;" is registered for version "v1", system:serviceaccount:myproject:proxy has no redirectURIs; set serviceaccounts.openshift.io/oauth-redirecturi.&lt;some-value&gt;=&lt;redirect&gt; or create a dynamic URI using serviceaccounts.openshift.io/oauth-redirectreference.&lt;some-value&gt;=&lt;reference&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Missing SA tokens</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Reason                  Message
NoSAOAuthTokens         system:serviceaccount:myproject:proxy has no tokens</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding-identity-provider-configuration">Understanding identity provider configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The OpenShift Enterprise master includes a built-in OAuth server. Developers and
administrators obtain OAuth access tokens to authenticate themselves to the API.</p>
</div>
<div class="paragraph">
<p>As an administrator, you can configure OAuth to specify an identity provider
after you install your cluster.</p>
</div>
<div class="sect2">
<h3 id="identity-provider-overview-understanding-identity-provider">About identity providers in OpenShift Enterprise</h3>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a Custom Resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Enterprise user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="supported-identity-providers">Supported identity providers</h3>
<div class="paragraph">
<p>You can configure the following types of identity providers:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Identity provider</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#configuring-an-htpasswd-identity-provider">HTPasswd</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Configure the <code>htpasswd</code> identity provider to validate user names and passwords
against a flat file generated using
<a href="http://httpd.apache.org/docs/2.4/programs/htpasswd.html"><code>htpasswd</code></a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#configuring-a-keystone-identity-provider">Keystone</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Configure the <code>keystone</code> identity provider to integrate
your OpenShift Enterprise cluster with Keystone to enable shared authentication with
an OpenStack Keystone v3 server configured to store users in an internal
database.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#configuring-an-ldap-identity-provider">LDAP</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Configure the <code>ldap</code> identity provider to validate user names and passwords
against an LDAPv3 server, using simple bind authentication.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#configuring-a-basic-authentication-identity-provider">Basic authentication</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Configure a <code>basic-authentication</code> identity provider for users to log in to
OpenShift Enterprise with credentials validated against a remote identity provider.
Basic authentication is a generic backend integration mechanism.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#configuring-a-request-header-identity-provider">Request header</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Configure a <code>request-header</code> identity provider to identify users from request
header values, such as <code>X-Remote-User</code>. It is typically used in combination with
an authenticating proxy, which sets the request header value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#configuring-a-github-or-github-enterprise-identity-provider">GitHub or GitHub Enterprise</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Configure a <code>github</code> identity provider to validate user names and passwords
against GitHub or GitHub Enterprise&#8217;s OAuth authentication server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#configuring-a-gitlab-identity-provider">GitLab</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Configure a <code>gitlab</code> identity provider to use
<a href="https://gitlab.com/">GitLab.com</a> or any other GitLab instance as an identity
provider.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#configuring-a-google-identity-provider">Google</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Configure a <code>google</code> identity provider using
<a href="https://developers.google.com/identity/protocols/OpenIDConnect">Google&#8217;s OpenID Connect integration</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#configuring-an-openid-connect-identity-provider">OpenID Connect</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Configure an <code>oidc</code> identity provider to integrate with an OpenID Connect
identity provider using an
<a href="http://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth">Authorization Code Flow</a>.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="identity-provider-parameters-understanding-identity-provider">Identity provider parameters</h3>
<div class="paragraph">
<p>Four parameters are common to all identity providers:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>name</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The provider name is prefixed to provider user names to form an
identity name.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>challenge</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When <code>true</code>, unauthenticated token requests from non-web
clients, like the CLI, are sent a <code>WWW-Authenticate</code> challenge header. Not
supported by all identity providers.</p>
</div>
<div class="paragraph">
<p>To prevent cross-site request forgery (CSRF) attacks against browser clients
Basic authentication challenges are only sent if a <code>X-CSRF-Token</code> header is
present on the request. Clients that expect to receive Basic <code>WWW-Authenticate</code>
challenges should set this header to a non-empty value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>login</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When <code>true</code>, unauthenticated token requests from web clients,
like the web console, are redirected to a login page backed by this provider.
Not supported by all identity providers.</p>
</div>
<div class="paragraph">
<p>If you want users to be sent to a branded page before being redirected to
the identity provider&#8217;s login, then set <code>oauthConfig &#8594; alwaysShowProviderSelection: true</code>
in the master configuration file.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>mappingMethod</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines how new identities are mapped to users when they log in.
Enter one of the following values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">claim</dt>
<dd>
<p>The default value. Provisions a user with the identity&#8217;s preferred
user name. Fails if a user with that user name is already mapped to another
identity.</p>
</dd>
<dt class="hdlist1">lookup</dt>
<dd>
<p>Looks up an existing identity, user identity mapping, and user,
but does not automatically provision users or identities. This allows cluster
administrators to set up identities and users manually, or using an external
process. Using this method requires you to manually provision users.</p>
</dd>
<dt class="hdlist1">generate</dt>
<dd>
<p>Provisions a user with the identity&#8217;s preferred user name. If a
user with the preferred user name is already mapped to an existing identity, a
unique user name is generated. For example, <code>myuser2</code>. This method should not be
used in combination with external processes that require exact matches between
OpenShift Enterprise user names and identity provider user names, such as LDAP group
sync.</p>
</dd>
<dt class="hdlist1">add</dt>
<dd>
<p>Provisions a user with the identity&#8217;s preferred user name. If a user
with that user name already exists, the identity is mapped to the existing user,
adding to any existing identity mappings for the user. Required when multiple
identity providers are configured that identify the same set of users and map to
the same user names.</p>
</dd>
</dl>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When adding or changing identity providers, you can map identities from the new
provider to existing users by setting the <code>mappingMethod</code> parameter to
<code>add</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="identity-provider-default-CR-understanding-identity-provider">Sample identity provider CR</h3>
<div class="paragraph">
<p>The following Custom Resource (CR) shows the parameters and default
values that you use to configure an identity provider. This example
uses the HTPasswd identity provider.</p>
</div>
<div class="listingblock">
<div class="title">Sample identity provider CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: my_identity_provider <b class="conum">(1)</b>
    challenge: true <b class="conum">(2)</b>
    login: true <b class="conum">(3)</b>
    mappingMethod: claim <b class="conum">(4)</b>
    type: HTPasswd
    htpasswd:
      fileData:
        name: htpass-secret <b class="conum">(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to provider user names to form an
identity name.</p>
</li>
<li>
<p>When <code>true</code>, unauthenticated token requests from non-web clients, like
the CLI, are sent a <code>WWW-Authenticate</code> challenge header for this provider.</p>
</li>
<li>
<p>When <code>true</code>, unauthenticated token requests from web clients, like the
web console, are redirected to a login page backed by this provider.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s
identities and user objects.</p>
</li>
<li>
<p>An existing secret containing a file generated using
<a href="http://httpd.apache.org/docs/2.4/programs/htpasswd.html"><code>htpasswd</code></a>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring-identity-providers">Configuring identity providers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="configuring-an-htpasswd-identity-provider">Configuring an HTPasswd identity provider</h3>
<div class="sect3">
<h4 id="identity-provider-overview-configuring-htpasswd-identity-provider">About identity providers in OpenShift Enterprise</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a Custom Resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Enterprise user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To define an HTPasswd identity provider you must perform the
following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an <code>htpasswd</code> file to store the user and password information.
Instructions are provided for
<a href="../../authentication/identity_providers/configuring-htpasswd-identity-provider.html#identity-provider-creating-htpasswd-file-linux-configuring-htpasswd-identity-provider">Linux</a>
and
<a href="../../authentication/identity_providers/configuring-htpasswd-identity-provider.html#identity-provider-creating-htpasswd-file-windows-configuring-htpasswd-identity-provider">Windows</a>.</p>
</li>
<li>
<p><a href="../../authentication/identity_providers/configuring-htpasswd-identity-provider.html#identity-provider-creating-htpasswd-secret-configuring-htpasswd-identity-provider">Create
an OpenShift Enterprise secret to represent the <code>htpasswd</code> file</a>.</p>
</li>
<li>
<p><a href="../../authentication/identity_providers/configuring-htpasswd-identity-provider.html#identity-provider-htpasswd-CR-configuring-htpasswd-identity-provider">Define the HTPasswd identity provider resource</a>.</p>
</li>
<li>
<p><a href="../../authentication/identity_providers/configuring-htpasswd-identity-provider.html#add-identity-provider-configuring-htpasswd-identity-provider">Apply the resource to
the default OAuth configuration</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-htpasswd-file-linux-configuring-htpasswd-identity-provider">Creating an HTPasswd file using Linux</h4>
<div class="paragraph">
<p>To use the HTPasswd identity provider, you must generate a flat file that
contains the user names and passwords for your cluster by using
<a href="http://httpd.apache.org/docs/2.4/programs/htpasswd.html"><code>htpasswd</code></a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Have access to the <code>htpasswd</code> utility. On Red Hat Enterprise Linux
this is available by installing the <code>httpd-tools</code> package.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create or update your flat file with a user name and hashed password:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ htpasswd -c -B -b &lt;/path/to/users.htpasswd&gt; &lt;user_name&gt; &lt;password&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The command generates a hashed version of the password.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ htpasswd -c -B -b users.htpasswd user1 MyPassword!

Adding password for user user1</pre>
</div>
</div>
</li>
<li>
<p>Continue to add or update credentials to the file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ htpasswd -b &lt;/path/to/users.htpasswd&gt; &lt;user_name&gt; &lt;password&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-htpasswd-file-windows-configuring-htpasswd-identity-provider">Creating an HTPasswd file using Windows</h4>
<div class="paragraph">
<p>To use the HTPasswd identity provider, you must generate a flat file that
contains the user names and passwords for your cluster by using
<a href="http://httpd.apache.org/docs/2.4/programs/htpasswd.html"><code>htpasswd</code></a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Have access to <code>htpasswd.exe</code>. This file is included in the <code>\bin</code>
directory of many Apache httpd distributions.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create or update your flat file with a user name and hashed password:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&gt; htpasswd.exe -c -B -b &lt;\path\to\users.htpasswd&gt; &lt;user_name&gt; &lt;password&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The command generates a hashed version of the password.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&gt; htpasswd.exe -c -B -b users.htpasswd user1 MyPassword!

Adding password for user user1</pre>
</div>
</div>
</li>
<li>
<p>Continue to add or update credentials to the file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&gt; htpasswd.exe -b &lt;\path\to\users.htpasswd&gt; &lt;user_name&gt; &lt;password&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-htpasswd-secret-configuring-htpasswd-identity-provider">Creating the HTPasswd Secret</h4>
<div class="paragraph">
<p>To use the HTPasswd identity provider, you must define a secret that
contains the HTPasswd user file.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an HTPasswd file.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create an OpenShift Enterprise Secret that contains the HTPasswd users file.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create secret generic htpass-secret --from-file=htpasswd=&lt;/path/to/users.htpasswd&gt; -n openshift-config</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-htpasswd-CR-configuring-htpasswd-identity-provider">Sample HTPasswd CR</h4>
<div class="paragraph">
<p>The following Custom Resource (CR) shows the parameters and acceptable values for an
HTPasswd identity provider.</p>
</div>
<div class="listingblock">
<div class="title">HTPasswd CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: my_htpasswd_provider <b class="conum">(1)</b>
    challenge: true <b class="conum">(2)</b>
    login: true <b class="conum">(3)</b>
    mappingMethod: claim <b class="conum">(4)</b>
    type: HTPasswd
    htpasswd:
      fileData:
        name: htpass-secret <b class="conum">(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to provider user names to form an identity
name.</p>
</li>
<li>
<p>When <code>true</code>, unauthenticated token requests from non-web clients, like the
CLI, are sent a <code>WWW-Authenticate</code> challenge header for this provider.</p>
</li>
<li>
<p>When <code>true</code>, unauthenticated token requests from web clients, like the web
console, are redirected to a login page backed by this provider.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and user objects.</p>
</li>
<li>
<p>An existing secret containing a file generated using
<a href="http://httpd.apache.org/docs/2.4/programs/htpasswd.html"><code>htpasswd</code></a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider-configuring-htpasswd-identity-provider">Adding an identity provider to your clusters</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Enterprise cluster.</p>
</li>
<li>
<p>Create the Custom Resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc apply -f &lt;/path/to/CR&gt;</pre>
</div>
</div>
</li>
<li>
<p>Log in to the cluster as a user from your identity provider, entering the
password when prompted.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc login -u &lt;username&gt;</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc whoami</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-keystone-identity-provider">Configuring a Keystone identity provider</h3>
<div class="paragraph">
<p>Configure the <code>keystone</code> identity provider to integrate
your OpenShift Enterprise cluster with Keystone to enable shared authentication with
an OpenStack Keystone v3 server configured to store users in an internal
database. This configuration allows users to log in to OpenShift Enterprise with
their Keystone credentials.</p>
</div>
<div class="paragraph">
<p><a href="http://docs.openstack.org/developer/keystone/">Keystone</a> is an OpenStack project
that provides identity, token, catalog, and policy services.</p>
</div>
<div class="paragraph">
<p>You can configure the integration with Keystone so that the new OpenShift Enterprise
users are based on either the Keystone user names or unique Keystone IDs.
With both methods, users log in by entering their Keystone user name and
password. Basing the OpenShift Enterprise users off of the Keystone ID is more
secure. If you delete a Keystone user and create a new Keystone user with that
user name, the new user might have access to the old user&#8217;s resources.</p>
</div>
<div class="sect3">
<h4 id="identity-provider-overview-configuring-keystone-identity-provider">About identity providers in OpenShift Enterprise</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a Custom Resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Enterprise user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-secret-configuring-keystone-identity-provider">Creating the Secret</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Enterprise Secrets to contain the client
secret, client certificates, and keys.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can define an OpenShift Enterprise Secret containing a string
by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create secret generic &lt;secret_name&gt; --from-literal=clientSecret=&lt;secret&gt; -n openshift-config</pre>
</div>
</div>
</li>
<li>
<p>You can define an OpenShift Enterprise Secret containing the contents of a
file, such as a certificate file, by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create secret generic &lt;secret_name&gt; --from-file=/path/to/file</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-configmap-configuring-keystone-identity-provider">Creating a ConfigMap</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Enterprise ConfigMaps to contain the
certificate authority bundle.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define an OpenShift Enterprise ConfigMap containing a the
certificate authority by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-keystone-CR-configuring-keystone-identity-provider">Sample Keystone CR</h4>
<div class="paragraph">
<p>The following Custom Resource (CR) shows the parameters and acceptable values for a
Keystone identity provider.</p>
</div>
<div class="listingblock">
<div class="title">Keystone CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: keystoneidp <b class="conum">(1)</b>
    challenge: false <b class="conum">(2)</b>
    login: true <b class="conum">(3)</b>
    mappingMethod: claim <b class="conum">(4)</b>
    type: Keystone
    keystone:
      domainName: default <b class="conum">(5)</b>
      url: http://keystone.example.com:5000 <b class="conum">(6)</b>
      ca: <b class="conum">(7)</b>
        name: ca-config-map
      tlsClientCert: <b class="conum">(8)</b>
        name: client-cert-secret
      tlsClientKey: <b class="conum">(9)</b>
        name: client-key-secret</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to provider user names to form an identity name.</p>
</li>
<li>
<p>When <code>true</code>, unauthenticated token requests from non-web clients, like the
CLI, are sent a <code>WWW-Authenticate</code> challenge header for this provider.</p>
</li>
<li>
<p>When <code>true</code>, unauthenticated token requests from web clients, like the web
console, are redirected to a login page backed by this provider.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and user objects.</p>
</li>
<li>
<p>Keystone domain name. In Keystone, usernames are domain-specific. Only a single domain is supported.</p>
</li>
<li>
<p>The URL to use to connect to the Keystone server (required).</p>
</li>
<li>
<p>Optional: Reference to an OpenShift Enterprise ConfigMap containing the
PEM-encoded certificate authority bundle to use in validating server
certificates for the configured URL.</p>
</li>
<li>
<p>Optional: Reference to an OpenShift Enterprise Secret containing the client
certificate to present when making requests to the configured URL.</p>
</li>
<li>
<p>Reference to an OpenShift Enterprise Secret containing the key for the
client certificate. Required if <code>tlsClientCert</code> is specified.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider-configuring-keystone-identity-provider">Adding an identity provider to your clusters</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Enterprise cluster.</p>
</li>
<li>
<p>Create the Custom Resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc apply -f &lt;/path/to/CR&gt;</pre>
</div>
</div>
</li>
<li>
<p>Log in to the cluster as a user from your identity provider, entering the
password when prompted.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc login -u &lt;username&gt;</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc whoami</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-an-ldap-identity-provider">Configuring an LDAP identity provider</h3>
<div class="paragraph">
<p>Configure the <code>ldap</code> identity provider to validate user names and passwords
against an LDAPv3 server, using simple bind authentication.</p>
</div>
<div class="sect3">
<h4 id="identity-provider-overview-configuring-ldap-identity-provider">About identity providers in OpenShift Enterprise</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a Custom Resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Enterprise user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-about-ldap-configuring-ldap-identity-provider">About LDAP authentication</h4>
<div class="paragraph">
<p>During authentication, the LDAP directory is searched for an entry that matches
the provided user name. If a single unique match is found, a simple bind is
attempted using the distinguished name (DN) of the entry plus the provided
password.</p>
</div>
<div class="paragraph">
<p>These are the steps taken:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate a search filter by combining the attribute and filter in the
configured <code>url</code> with the user-provided user name.</p>
</li>
<li>
<p>Search the directory using the generated filter. If the search does not return
exactly one entry, deny access.</p>
</li>
<li>
<p>Attempt to bind to the LDAP server using the DN of the entry retrieved from
the search, and the user-provided password.</p>
</li>
<li>
<p>If the bind is unsuccessful, deny access.</p>
</li>
<li>
<p>If the bind is successful, build an identity using the configured attributes
as the identity, email address, display name, and preferred user name.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The configured <code>url</code> is an RFC 2255 URL, which specifies the LDAP host and
search parameters to use. The syntax of the URL is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ldap://host:port/basedn?attribute?scope?filter</pre>
</div>
</div>
<div class="paragraph">
<p>For this URL:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">URL Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><code>ldap</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>For regular LDAP, use the string <code>ldap</code>. For secure LDAP
(LDAPS), use <code>ldaps</code> instead.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><code>host:port</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name and port of the LDAP server. Defaults to
<code>localhost:389</code> for ldap and <code>localhost:636</code> for LDAPS.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><code>basedn</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The DN of the branch of the directory where all searches should
start from. At the very least, this must be the top of your directory tree, but
it could also specify a subtree in the directory.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><code>attribute</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The attribute to search for. Although RFC 2255 allows a
comma-separated list of attributes, only the first attribute will be used, no
matter how many are provided. If no attributes are provided, the default is to
use <code>uid</code>. It is recommended to choose an attribute that will be unique across
all entries in the subtree you will be using.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><code>scope</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The scope of the search. Can be either <code>one</code> or <code>sub</code>.
If the scope is not provided, the default is to use a scope of <code>sub</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><code>filter</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A valid LDAP search filter. If not provided, defaults to
<code>(objectClass=*)</code></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When doing searches, the attribute, filter, and provided user name are combined
to create a search filter that looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">(&amp;(&lt;filter&gt;)(&lt;attribute&gt;=&lt;username&gt;))</pre>
</div>
</div>
<div class="paragraph">
<p>For example, consider a URL of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ldap://ldap.example.com/o=Acme?cn?sub?(enabled=true)</pre>
</div>
</div>
<div class="paragraph">
<p>When a client attempts to connect using a user name of <code>bob</code>, the resulting
search filter will be <code>(&amp;(enabled=true)(cn=bob))</code>.</p>
</div>
<div class="paragraph">
<p>If the LDAP directory requires authentication to search, specify a <code>bindDN</code> and
<code>bindPassword</code> to use to perform the entry search.</p>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-ldap-secret-configuring-ldap-identity-provider">Creating the LDAP Secret</h4>
<div class="paragraph">
<p>To use the identity provider, you must define an OpenShift Enterprise Secret
that contains the bindPassword.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define an OpenShift Enterprise Secret that contains the bindPassword.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create secret generic ldap-secret --from-literal=bindPassword=&lt;secret&gt; -n openshift-config</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-configmap-configuring-ldap-identity-provider">Creating a ConfigMap</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Enterprise ConfigMaps to contain the
certificate authority bundle.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define an OpenShift Enterprise ConfigMap containing a the
certificate authority by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-ldap-CR-configuring-ldap-identity-provider">Sample LDAP CR</h4>
<div class="paragraph">
<p>The following Custom Resource (CR) shows the parameters and acceptable values for an
LDAP identity provider.</p>
</div>
<div class="listingblock">
<div class="title">LDAP CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: ldapidp <b class="conum">(1)</b>
    challenge: false <b class="conum">(2)</b>
    login: true <b class="conum">(3)</b>
    mappingMethod: claim <b class="conum">(4)</b>
    type: LDAP
    ldap:
      attributes:
        id: <b class="conum">(5)</b>
        - dn
        email: <b class="conum">(6)</b>
        - mail
        name: <b class="conum">(7)</b>
        - cn
        preferredUsername: <b class="conum">(8)</b>
        - uid
      bindDN: "" <b class="conum">(9)</b>
      bindPassword: <b class="conum">(10)</b>
        name: ldap-secret
      ca: <b class="conum">(11)</b>
        name: ca-config-map
      insecure: false <b class="conum">(12)</b>
      url: "ldap://ldap.example.com/ou=users,dc=acme,dc=com?uid" <b class="conum">(13)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to the returned user ID to form an identity
name.</p>
</li>
<li>
<p>When <code>true</code>, unauthenticated token requests from non-web clients, like the
CLI, are sent a <code>WWW-Authenticate</code> challenge header for this provider.</p>
</li>
<li>
<p>When <code>true</code>, unauthenticated token requests from web clients, like the web
console, are redirected to a login page backed by this provider.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and user objects.</p>
</li>
<li>
<p>List of attributes to use as the identity. First non-empty attribute is
used. At least one attribute is required. If none of the listed attribute have a
value, authentication fails.</p>
</li>
<li>
<p>List of attributes to use as the email address. First non-empty attribute is
used.</p>
</li>
<li>
<p>List of attributes to use as the display name. First non-empty attribute is
used.</p>
</li>
<li>
<p>List of attributes to use as the preferred user name when provisioning a
user for this identity. First non-empty attribute is used.</p>
</li>
<li>
<p>Optional DN to use to bind during the search phase.</p>
</li>
<li>
<p>Optional reference to an OpenShift Enterprise Secret containing the bind
password.</p>
</li>
<li>
<p>Optional: Reference to an OpenShift Enterprise ConfigMap containing the
PEM-encoded certificate authority bundle to use in validating server
certificates for the configured URL. Only used when <code>insecure</code> is <code>false</code>.</p>
</li>
<li>
<p>When <code>true</code>, no TLS connection is made to the server. When <code>false</code>,
<code>ldaps://</code> URLs connect using TLS, and <code>ldap://</code> URLs are upgraded to TLS.
This should be set to <code>false</code> when <code>ldaps://</code> URLs are in use, as these
URLs always attempt to connect using TLS.</p>
</li>
<li>
<p>An RFC 2255 URL which specifies the LDAP host and search parameters to use.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>To whitelist users for an LDAP integration, use the <code>lookup</code> mapping method.
Before a login from LDAP would be allowed, a cluster administrator must create
an identity and user object for each LDAP user.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider-configuring-ldap-identity-provider">Adding an identity provider to your clusters</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Enterprise cluster.</p>
</li>
<li>
<p>Create the Custom Resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc apply -f &lt;/path/to/CR&gt;</pre>
</div>
</div>
</li>
<li>
<p>Log in to the cluster as a user from your identity provider, entering the
password when prompted.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc login -u &lt;username&gt;</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc whoami</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-basic-authentication-identity-provider">Configuring an basic authentication identity provider</h3>
<div class="paragraph">
<p>Configure a <code>basic-authentication</code> identity provider for users to log in to
OpenShift Enterprise with credentials validated against a remote identity provider.
Basic authentication is a generic backend integration mechanism.</p>
</div>
<div class="sect3">
<h4 id="identity-provider-overview-configuring-basic-authentication-identity-provider">About identity providers in OpenShift Enterprise</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a Custom Resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Enterprise user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-about-basic-authentication-configuring-basic-authentication-identity-provider">About basic authentication</h4>
<div class="paragraph">
<p>Basic authentication is a generic backend integration mechanism that allows
users to log in to OpenShift Enterprise with credentials validated against a remote
identity provider.</p>
</div>
<div class="paragraph">
<p>Because basic authentication is generic, you can use this identity
provider for advanced authentication configurations.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>Basic authentication must use an HTTPS connection to the remote server to
prevent potential snooping of the user ID and password and man-in-the-middle
attacks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With basic authentication configured, users send their user name
and password to OpenShift Enterprise, which then validates those credentials against
a remote server by making a server-to-server request, passing the credentials as
a basic authentication header. This requires users to send their credentials to
OpenShift Enterprise during login.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This only works for user name/password login mechanisms, and OpenShift Enterprise must
be able to make network requests to the remote authentication server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>User names and passwords are validated against a remote URL that is protected
by basic authentication and returns JSON.</p>
</div>
<div class="paragraph">
<p>A <code>401</code> response indicates failed authentication.</p>
</div>
<div class="paragraph">
<p>A non-<code>200</code> status, or the presence of a non-empty "error" key, indicates an
error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{"error":"Error message"}</pre>
</div>
</div>
<div class="paragraph">
<p>A <code>200</code> status with a <code>sub</code> (subject) key indicates success:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{"sub":"userid"} <b class="conum">(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The subject must be unique to the authenticated user and must not be able to
be modified.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A successful response can optionally provide additional data, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A display name using the <code>name</code> key. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{"sub":"userid", "name": "User Name", ...}</pre>
</div>
</div>
</li>
<li>
<p>An email address using the <code>email</code> key. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{"sub":"userid", "email":"user@example.com", ...}</pre>
</div>
</div>
</li>
<li>
<p>A preferred user name using the <code>preferred_username</code> key. This is useful when
the unique, unchangeable subject is a database key or UID, and a more
human-readable name exists. This is used as a hint when provisioning the
OpenShift Enterprise user for the authenticated identity. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{"sub":"014fbff9a07c", "preferred_username":"bob", ...}</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-secret-configuring-basic-authentication-identity-provider">Creating the Secret</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Enterprise Secrets to contain the client
secret, client certificates, and keys.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can define an OpenShift Enterprise Secret containing a string
by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create secret generic &lt;secret_name&gt; --from-literal=clientSecret=&lt;secret&gt; -n openshift-config</pre>
</div>
</div>
</li>
<li>
<p>You can define an OpenShift Enterprise Secret containing the contents of a
file, such as a certificate file, by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create secret generic &lt;secret_name&gt; --from-file=/path/to/file</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-configmap-configuring-basic-authentication-identity-provider">Creating a ConfigMap</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Enterprise ConfigMaps to contain the
certificate authority bundle.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define an OpenShift Enterprise ConfigMap containing a the
certificate authority by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-basic-authentication-CR-configuring-basic-authentication-identity-provider">Sample basic authentication CR</h4>
<div class="paragraph">
<p>The following Custom Resource (CR) shows the parameters and acceptable values for an
basic authentication identity provider.</p>
</div>
<div class="listingblock">
<div class="title">Basic authentication CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: basicidp <b class="conum">(1)</b>
    challenge: false <b class="conum">(2)</b>
    login: true <b class="conum">(3)</b>
    mappingMethod: claim <b class="conum">(4)</b>
    type: BasicAuth
    basicAuth:
      url: https://www.example.com/remote-idp <b class="conum">(5)</b>
      ca: <b class="conum">(6)</b>
        name: ca-config-map
      tlsClientCert: <b class="conum">(7)</b>
        name: client-cert-secret
      tlsClientKey: <b class="conum">(8)</b>
        name: client-key-secret</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to the returned user ID to form an identity
name.</p>
</li>
<li>
<p>When <code>true</code>, unauthenticated token requests from non-web clients, like the
CLI, are sent a <code>WWW-Authenticate</code> challenge header for this provider.</p>
</li>
<li>
<p>When <code>true</code>, unauthenticated token requests from web clients, like the web
console, are redirected to a login page backed by this provider.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and user objects.</p>
</li>
<li>
<p>URL accepting credentials in Basic authentication headers.</p>
</li>
<li>
<p>Optional: Reference to an OpenShift Enterprise ConfigMap containing the
PEM-encoded certificate authority bundle to use in validating server
certificates for the configured URL.</p>
</li>
<li>
<p>Optional: Reference to an OpenShift Enterprise Secret containing the client
certificate to present when making requests to the configured URL.</p>
</li>
<li>
<p>Reference to an OpenShift Enterprise Secret containing the key for the
client certificate. Required if <code>tlsClientCert</code> is specified.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider-configuring-basic-authentication-identity-provider">Adding an identity provider to your clusters</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Enterprise cluster.</p>
</li>
<li>
<p>Create the Custom Resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc apply -f &lt;/path/to/CR&gt;</pre>
</div>
</div>
</li>
<li>
<p>Log in to the cluster as a user from your identity provider, entering the
password when prompted.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc login -u &lt;username&gt;</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc whoami</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-basic-authentication-troubleshootingconfiguring-basic-authentication-identity-provider">Basic authentication troubleshooting</h4>
<div class="paragraph">
<p>The most common issue relates to network connectivity to the backend server. For
simple debugging, run <code>curl</code> commands on the master. To test for a successful
login, replace the <code>&lt;user&gt;</code> and <code>&lt;password&gt;</code> in the following example command
with valid credentials. To test an invalid login, replace them with false
credentials.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">curl --cacert /path/to/ca.crt --cert /path/to/client.crt --key /path/to/client.key -u &lt;user&gt;:&lt;password&gt; -v https://www.example.com/remote-idp</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Successful responses</strong></p>
</div>
<div class="paragraph">
<p>A <code>200</code> status with a <code>sub</code> (subject) key indicates success:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{"sub":"userid"}</pre>
</div>
</div>
<div class="paragraph">
<p>The subject must be unique to the authenticated user, and must not be able to
be modified.</p>
</div>
<div class="paragraph">
<p>A successful response can optionally provide additional data, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A display name using the <code>name</code> key:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{"sub":"userid", "name": "User Name", ...}</pre>
</div>
</div>
</li>
<li>
<p>An email address using the <code>email</code> key:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{"sub":"userid", "email":"user@example.com", ...}</pre>
</div>
</div>
</li>
<li>
<p>A preferred user name using the <code>preferred_username</code> key:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{"sub":"014fbff9a07c", "preferred_username":"bob", ...}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>preferred_username</code> key is useful when
the unique, unchangeable subject is a database key or UID, and a more
human-readable name exists. This is used as a hint when provisioning the
OpenShift Enterprise user for the authenticated identity.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Failed responses</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>401</code> response indicates failed authentication.</p>
</li>
<li>
<p>A non-<code>200</code> status or the presence of a non-empty "error" key indicates an
error: <code>{"error":"Error message"}</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-request-header-identity-provider">Configuring a request header identity provider</h3>
<div class="paragraph">
<p>Configure a <code>request-header</code> identity provider to identify users from request
header values, such as <code>X-Remote-User</code>. It is typically used in combination with
an authenticating proxy, which sets the request header value.</p>
</div>
<div class="sect3">
<h4 id="identity-provider-overview-configuring-request-header-identity-provider">About identity providers in OpenShift Enterprise</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a Custom Resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Enterprise user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-about-request-header-configuring-request-header-identity-provider">About request header authentication</h4>
<div class="paragraph">
<p>A request header identity provider identifies users from request
header values, such as <code>X-Remote-User</code>. It is typically used in combination with
an authenticating proxy, which sets the request header value.</p>
</div>
<div class="paragraph">
<p>You can also use the request header identity provider for advanced configurations
such as <a href="https://github.com/openshift/request-header-saml-service-provider">SAML authentication</a>.</p>
</div>
<div class="paragraph">
<p>For users to authenticate using this identity provider, they must access
<code>https://<em>&lt;namespace_route&gt;</em>/oauth/authorize</code> (and subpaths) via an authenticating proxy.
To accomplish this, configure the OAuth server to redirect unauthenticated
requests for OAuth tokens to the proxy endpoint that proxies to
<code>https://<em>&lt;namespace_route&gt;</em>/oauth/authorize</code>.</p>
</div>
<div class="paragraph">
<p>To redirect unauthenticated requests from clients expecting browser-based login flows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the <code>login</code> parameter to <code>true</code>.</p>
</li>
<li>
<p>Set the <code>provider.loginURL</code> parameter to the authenticating proxy URL that
will authenticate interactive clients and then proxy the request to
<code>https://<em>&lt;namespace_route&gt;</em>/oauth/authorize</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To redirect unauthenticated requests from clients expecting <code>WWW-Authenticate</code> challenges:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the <code>challenge</code> parameter to <code>true</code>.</p>
</li>
<li>
<p>Set the <code>provider.challengeURL</code> parameter to the authenticating proxy URL that
will authenticate clients expecting <code>WWW-Authenticate</code> challenges and then proxy
the request to <code>https://<em>&lt;namespace_route&gt;</em>/oauth/authorize</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>provider.challengeURL</code> and <code>provider.loginURL</code> parameters can include
the following tokens in the query portion of the URL:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${url}</code> is replaced with the current URL, escaped to be safe in a query parameter.</p>
<div class="paragraph">
<p>For example: <code><a href="https://www.example.com/sso-login?then=${url}" class="bare">https://www.example.com/sso-login?then=${url}</a></code></p>
</div>
</li>
<li>
<p><code>${query}</code> is replaced with the current query string, unescaped.</p>
<div class="paragraph">
<p>For example: <code><a href="https://www.example.com/auth-proxy/oauth/authorize?${query}" class="bare">https://www.example.com/auth-proxy/oauth/authorize?${query}</a></code></p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you expect unauthenticated requests to reach the OAuth server, a <code>clientCA</code>
parameter MUST be set for this identity provider, so that incoming requests
are checked for a valid client certificate before the request&#8217;s headers are
checked for a user name. Otherwise, any direct request to the OAuth server can
impersonate any identity from this provider, merely by setting a request header.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="sspi-windows-configuring-request-header-identity-provider">SSPI connection support on Microsoft Windows</h5>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Using SSPI connection support on Microsoft Windows is a Technology Preview feature.
Technology Preview features are not supported with Red Hat production service
level agreements (SLAs), might not be functionally complete, and Red Hat does
not recommend to use them for production. These features provide early access to
upcoming product features, enabling customers to test functionality and provide
feedback during the development process.</p>
</div>
<div class="paragraph">
<p>For more information on Red Hat Technology Preview features support scope, see
<a href="https://access.redhat.com/support/offerings/techpreview/" class="bare">https://access.redhat.com/support/offerings/techpreview/</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>oc</code> supports the Security Support Provider Interface (SSPI) to allow for SSO
flows on Microsft Windows. If you use the request header identity provider with a
GSSAPI-enabled proxy to connect an Active Directory server to OpenShift Enterprise,
users can automatically authenticate to OpenShift Enterprise by using the <code>oc</code>  command
line interface from a domain-joined Microsoft Windows computer.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-secret-configuring-request-header-identity-provider">Creating the Secret</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Enterprise Secrets to contain the client
secret, client certificates, and keys.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can define an OpenShift Enterprise Secret containing a string
by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create secret generic &lt;secret_name&gt; --from-literal=clientSecret=&lt;secret&gt; -n openshift-config</pre>
</div>
</div>
</li>
<li>
<p>You can define an OpenShift Enterprise Secret containing the contents of a
file, such as a certificate file, by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create secret generic &lt;secret_name&gt; --from-file=/path/to/file</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-configmap-configuring-request-header-identity-provider">Creating a ConfigMap</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Enterprise ConfigMaps to contain the
certificate authority bundle.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define an OpenShift Enterprise ConfigMap containing a the
certificate authority by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-request-header-CR-configuring-request-header-identity-provider">Sample request header CR</h4>
<div class="paragraph">
<p>The following Custom Resource (CR) shows the parameters and
acceptable values for a request header identity provider.</p>
</div>
<div class="listingblock">
<div class="title">Request header CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: requestheaderidp <b class="conum">(1)</b>
    challenge: false <b class="conum">(2)</b>
    login: true <b class="conum">(3)</b>
    mappingMethod: claim <b class="conum">(4)</b>
    type: RequestHeader
    requestHeader:
      challengeURL: "https://www.example.com/challenging-proxy/oauth/authorize?${query}" <b class="conum">(5)</b>
      loginURL: "https://www.example.com/login-proxy/oauth/authorize?${query}" <b class="conum">(6)</b>
      ca: <b class="conum">(7)</b>
        name: ca-config-map
      clientCommonNames: <b class="conum">(8)</b>
      - my-auth-proxy
      headers: <b class="conum">(9)</b>
      - X-Remote-User
      - SSO-User
      emailHeaders: <b class="conum">(10)</b>
      - X-Remote-User-Email
      nameHeaders: <b class="conum">(11)</b>
      - X-Remote-User-Display-Name
      preferredUsernameHeaders: <b class="conum">(12)</b>
      - X-Remote-User-Login</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to the user name in the request header to
form an identity name.</p>
</li>
<li>
<p><code>RequestHeaderIdentityProvider</code> can only respond to clients that request
<code>WWW-Authenticate</code> challenges by redirecting to a configured <code>challengeURL</code>. The
configured URL should respond with a <code>WWW-Authenticate</code> challenge.</p>
</li>
<li>
<p><code>RequestHeaderIdentityProvider</code> can only respond to clients requesting a
login flow by redirecting to a configured <code>loginURL</code>. The configured URL should
respond with a login flow.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and user objects.</p>
</li>
<li>
<p>Optional: URL to redirect unauthenticated <code>/oauth/authorize</code> requests to,
that will authenticate browser-based clients and then proxy their request to
<code>\https://<em>&lt;namespace_route&gt;</em>/oauth/authorize</code>.
The URL that proxies to <code>\https://<em>&lt;namespace_route&gt;</em>/oauth/authorize</code> must end with <code>/authorize</code> (with no trailing slash),
and also proxy subpaths, in order for OAuth approval flows to work properly.
<code>${url}</code> is replaced with the current URL, escaped to be safe in a query parameter.
<code>${query}</code> is replaced with the current query string.</p>
</li>
<li>
<p>Optional: URL to redirect unauthenticated <code>/oauth/authorize</code> requests to,
that will authenticate clients which expect <code>WWW-Authenticate</code> challenges, and
then proxy them to <code>\https://<em>&lt;namespace_route&gt;</em>/oauth/authorize</code>.
<code>${url}</code> is replaced with the current URL, escaped to be safe in a query parameter.
<code>${query}</code> is replaced with the current query string.</p>
</li>
<li>
<p>Reference to an OpenShift Enterprise ConfigMap containing a PEM-encoded
certificate bundle. Used as a trust anchor to validate the TLS
certificates presented by the remote server. If this file is not
present or valid the identity provider is not honored.</p>
</li>
<li>
<p>Optional: list of common names (<code>cn</code>). If set, a valid client certificate with
a Common Name (<code>cn</code>) in the specified list must be presented before the request headers
are checked for user names. If empty, any Common Name is allowed. Can only be used in combination
with <code>clientCA</code>.</p>
</li>
<li>
<p>Header names to check, in order, for the user identity. The first header containing
a value is used as the identity. Required, case-insensitive.</p>
</li>
<li>
<p>Header names to check, in order, for an email address. The first header containing
a value is used as the email address. Optional, case-insensitive.</p>
</li>
<li>
<p>Header names to check, in order, for a display name. The first header containing
a value is used as the display name. Optional, case-insensitive.</p>
</li>
<li>
<p>Header names to check, in order, for a preferred user name, if different than the immutable
identity determined from the headers specified in <code>headers</code>. The first header containing
a value is used as the preferred user name when provisioning. Optional, case-insensitive.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider-configuring-request-header-identity-provider">Adding an identity provider to your clusters</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Enterprise cluster.</p>
</li>
<li>
<p>Create the Custom Resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc apply -f &lt;/path/to/CR&gt;</pre>
</div>
</div>
</li>
<li>
<p>Log in to the cluster as a user from your identity provider, entering the
password when prompted.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc login -u &lt;username&gt;</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc whoami</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-github-or-github-enterprise-identity-provider">Configuring a GitHub or GitHub Enterprise identity provider</h3>
<div class="paragraph">
<p>Configure a <code>github</code> identity provider to validate user names and passwords
against GitHub or GitHub Enterprise&#8217;s OAuth authentication server. OAuth
facilitates a token exchange flow between
OpenShift Enterprise and GitHub or GitHub Enterprise.</p>
</div>
<div class="paragraph">
<p>You can use the GitHub integration to connect to either GitHub or GitHub
Enterprise. For GitHub Enterprise integrations, you must provide the <code>hostname</code>
of your instance and can optionally provide a <code>ca</code> certificate bundle to use in
requests to the server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The following steps apply to both GitHub and GitHub Enterprise unless noted.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configuring GitHub authentication allows users to log in to OpenShift Enterprise with
their GitHub credentials. To prevent anyone with any GitHub user ID from logging
in to your OpenShift Enterprise cluster, you can restrict access to only those in
specific GitHub organizations.</p>
</div>
<div class="sect3">
<h4 id="identity-provider-overview-configuring-github-identity-provider">About identity providers in OpenShift Enterprise</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a Custom Resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Enterprise user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-registering-github-configuring-github-identity-provider">Registering a GitHub application</h4>
<div class="paragraph">
<p>To use GitHub or GitHub Enterprise as an identity provider, you must register
an application to use.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Register an application on GitHub:</p>
<div class="ulist">
<ul>
<li>
<p>For GitHub, click <a href="https://github.com/settings/profile">Settings</a> &#8594;
<a href="https://github.com/settings/developers">Developer settings</a> &#8594;
<a href="https://github.com/settings/applications/new">Register a new OAuth application</a>.</p>
</li>
<li>
<p>For GitHub Enterprise, go to your GitHub Enterprise home page and then click
<strong>Settings &#8594; Developer settings &#8594; Register a new application</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enter an application name, for example <code>My OpenShift Install</code>.</p>
</li>
<li>
<p>Enter a homepage URL, such as <code><a href="https://myapiserver.com:8443" class="bare">https://myapiserver.com:8443</a></code>.</p>
</li>
<li>
<p>Optionally, enter an application description.</p>
</li>
<li>
<p>Enter the authorization callback URL, where the end of the URL contains the
identity provider <code>name</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;apiserver&gt;/oauth2callback/&lt;identityProviderName&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://myapiserver.com:8443/oauth2callback/github/</pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Register application</strong>. GitHub provides a Client ID and a Client Secret.
You need these values to complete the identity provider configuration.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-secret-configuring-github-identity-provider">Creating the Secret</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Enterprise Secrets to contain the client
secret, client certificates, and keys.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can define an OpenShift Enterprise Secret containing a string
by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create secret generic &lt;secret_name&gt; --from-literal=clientSecret=&lt;secret&gt; -n openshift-config</pre>
</div>
</div>
</li>
<li>
<p>You can define an OpenShift Enterprise Secret containing the contents of a
file, such as a certificate file, by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create secret generic &lt;secret_name&gt; --from-file=/path/to/file</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-configmap-configuring-github-identity-provider">Creating a ConfigMap</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Enterprise ConfigMaps to contain the
certificate authority bundle.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define an OpenShift Enterprise ConfigMap containing a the
certificate authority by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-github-CR-configuring-github-identity-provider">Sample GitHub CR</h4>
<div class="paragraph">
<p>The following Custom Resource (CR) shows the parameters and acceptable values for a
GitHub identity provider.</p>
</div>
<div class="listingblock">
<div class="title">GitHub CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: githubidp <b class="conum">(1)</b>
    challenge: false <b class="conum">(2)</b>
    login: true <b class="conum">(3)</b>
    mappingMethod: claim <b class="conum">(4)</b>
    type: GitHub
    github:
      ca: <b class="conum">(5)</b>
        name: ca-config-map
      clientID: {...} <b class="conum">(6)</b>
      clientSecret: <b class="conum">(7)</b>
        name: github-secret
      hostname: ... <b class="conum">(8)</b>
      organizations: <b class="conum">(9)</b>
      - myorganization1
      - myorganization2
      teams: <b class="conum">(10)</b>
      - myorganization1/team-a
      - myorganization2/team-b</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to the GitHub numeric user ID to form an
identity name. It is also used to build the callback URL.</p>
</li>
<li>
<p><code>GitHubIdentityProvider</code> cannot be used to send <code>WWW-Authenticate</code>
challenges.</p>
</li>
<li>
<p>When <code>true</code>, unauthenticated token requests from web clients, like the web
console, are redirected to GitHub to log in.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and user objects.</p>
</li>
<li>
<p>Optional: Reference to an OpenShift Enterprise ConfigMap containing the
PEM-encoded certificate authority bundle to use in validating server
certificates for the configured URL. Only for use in GitHub Enterprise.</p>
</li>
<li>
<p>The client ID of a
<a href="https://github.com/settings/applications/new">registered GitHub OAuth
application</a>. The application must be configured with a callback URL of
<code>&lt;master&gt;/oauth2callback/&lt;identityProviderName&gt;</code>.</p>
</li>
<li>
<p>Reference to an OpenShift Enterprise Secret containing the client secret
issued by GitHub.</p>
</li>
<li>
<p>For GitHub Enterprise, you must provide the host name of your instance, such as
<code>example.com</code>. This value must match the GitHub Enterprise <code>hostname</code> value in
in the <strong><em>/setup/settings</em></strong> file and cannot include a port number. For GitHub,
omit this parameter.</p>
</li>
<li>
<p>Optional list of organizations. If specified, only GitHub users that are members of
at least one of the listed organizations will be allowed to log in. If the GitHub OAuth
application configured in <code>clientID</code> is not owned by the organization, an organization
owner must grant third-party access in order to use this option. This can be done during
the first GitHub login by the organization&#8217;s administrator, or from the GitHub organization settings.
Cannot be used in combination with the <code>teams</code> field.</p>
</li>
<li>
<p>Optional list of teams. If specified, only GitHub users that are members of
at least one of the listed teams will be allowed to log in. If the GitHub OAuth
application configured in <code>clientID</code> is not owned by the team&#8217;s organization, an organization
owner must grant third-party access in order to use this option. This can be done during
the first GitHub login by the organization&#8217;s administrator, or from the GitHub organization settings.
Cannot be used in combination with the <code>organizations</code> field.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider-configuring-github-identity-provider">Adding an identity provider to your clusters</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Enterprise cluster.</p>
</li>
<li>
<p>Create the Custom Resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc apply -f &lt;/path/to/CR&gt;</pre>
</div>
</div>
</li>
<li>
<p>Log in to the cluster as a user from your identity provider, entering the
password when prompted.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc login -u &lt;username&gt;</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc whoami</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-gitlab-identity-provider">Configuring a GitLab identity provider</h3>
<div class="paragraph">
<p>Configure a <code>gitlab</code> identity provider to use
<a href="https://gitlab.com/">GitLab.com</a> or any other GitLab instance as an identity
provider. If you use GitLab version 7.7.0 to 11.0, you connect using the
<a href="http://doc.gitlab.com/ce/integration/oauth_provider.html">OAuth integration</a>.
If you use GitLab version 11.1 or later, you can use
<a href="https://docs.gitlab.com/ce/integration/openid_connect_provider.html">OpenID Connect</a> (OIDC)
to connect instead of OAuth.</p>
</div>
<div class="sect3">
<h4 id="identity-provider-overview-configuring-gitlab-identity-provider">About identity providers in OpenShift Enterprise</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a Custom Resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Enterprise user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-secret-configuring-gitlab-identity-provider">Creating the Secret</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Enterprise Secrets to contain the client
secret, client certificates, and keys.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can define an OpenShift Enterprise Secret containing a string
by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create secret generic &lt;secret_name&gt; --from-literal=clientSecret=&lt;secret&gt; -n openshift-config</pre>
</div>
</div>
</li>
<li>
<p>You can define an OpenShift Enterprise Secret containing the contents of a
file, such as a certificate file, by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create secret generic &lt;secret_name&gt; --from-file=/path/to/file</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-configmap-configuring-gitlab-identity-provider">Creating a ConfigMap</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Enterprise ConfigMaps to contain the
certificate authority bundle.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define an OpenShift Enterprise ConfigMap containing a the
certificate authority by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-gitlab-CR-configuring-gitlab-identity-provider">Sample GitLab CR</h4>
<div class="paragraph">
<p>The following Custom Resource (CR) shows the parameters and acceptable values for a
GitLab identity provider.</p>
</div>
<div class="listingblock">
<div class="title">GitLab CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: gitlabidp <b class="conum">(1)</b>
    challenge: false <b class="conum">(2)</b>
    login: true <b class="conum">(3)</b>
    mappingMethod: claim <b class="conum">(4)</b>
    type: GitLab
    gitlab:
      clientID: {...} <b class="conum">(5)</b>
      clientSecret: <b class="conum">(6)</b>
        name: gitlab-secret
      url: https://gitlab.com <b class="conum">(7)</b>
      ca: <b class="conum">(8)</b>
        name: ca-config-map</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to the GitLab numeric user ID to form an
identity name. It is also used to build the callback URL.</p>
</li>
<li>
<p>When <code>true</code>, unauthenticated token requests from non-web clients, like
the CLI, are sent a <code>WWW-Authenticate</code> challenge header for this provider.
This uses the <a href="http://doc.gitlab.com/ce/api/oauth2.html#resource-owner-password-credentials">Resource Owner Password Credentials</a>
grant flow to obtain an access token from GitLab.</p>
</li>
<li>
<p>When <code>true</code>, unauthenticated token requests from web clients, like the web
console, are redirected to GitLab to log in.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and user objects.</p>
</li>
<li>
<p>The client ID of a
<a href="https://docs.gitlab.com/ce/api/oauth2.html">registered GitLab OAuth application</a>.
The application must be configured with a callback URL of
<code>&lt;master&gt;/oauth2callback/&lt;identityProviderName&gt;</code>.</p>
</li>
<li>
<p>Reference to an OpenShift Enterprise Secret containing the client secret
issued by GitLab.</p>
</li>
<li>
<p>The host URL of a GitLab provider. This could either be <code>https://gitlab.com/</code>
or any other self hosted instance of GitLab.</p>
</li>
<li>
<p>Optional: Reference to an OpenShift Enterprise ConfigMap containing the
PEM-encoded certificate authority bundle to use in validating server
certificates for the configured URL.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider-configuring-gitlab-identity-provider">Adding an identity provider to your clusters</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Enterprise cluster.</p>
</li>
<li>
<p>Create the Custom Resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc apply -f &lt;/path/to/CR&gt;</pre>
</div>
</div>
</li>
<li>
<p>Log in to the cluster as a user from your identity provider, entering the
password when prompted.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc login -u &lt;username&gt;</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc whoami</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-google-identity-provider">Configuring a Google identity provider</h3>
<div class="paragraph">
<p>Configure a <code>google</code> identity provider using
<a href="https://developers.google.com/identity/protocols/OpenIDConnect">Google&#8217;s OpenID Connect integration</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Using Google as an identity provider requires users to get a token using
<code>&lt;master&gt;/oauth/token/request</code> to use with command-line tools.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Using Google as an identity provider allows any Google user to authenticate to your server.
You can limit authentication to members of a specific hosted domain with the
<code>hostedDomain</code> configuration attribute.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="identity-provider-overview-configuring-google-identity-provider">About identity providers in OpenShift Enterprise</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a Custom Resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Enterprise user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-secret-configuring-google-identity-provider">Creating the Secret</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Enterprise Secrets to contain the client
secret, client certificates, and keys.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can define an OpenShift Enterprise Secret containing a string
by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create secret generic &lt;secret_name&gt; --from-literal=clientSecret=&lt;secret&gt; -n openshift-config</pre>
</div>
</div>
</li>
<li>
<p>You can define an OpenShift Enterprise Secret containing the contents of a
file, such as a certificate file, by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create secret generic &lt;secret_name&gt; --from-file=/path/to/file</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-google-CR-configuring-google-identity-provider">Sample Google CR</h4>
<div class="paragraph">
<p>The following Custom Resource (CR) shows the parameters and acceptable
values for a Google identity provider.</p>
</div>
<div class="listingblock">
<div class="title">Google CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: googleidp <b class="conum">(1)</b>
    challenge: false <b class="conum">(2)</b>
    login: true <b class="conum">(3)</b>
    mappingMethod: claim <b class="conum">(4)</b>
    type: Google
    google:
      clientID: {...} <b class="conum">(5)</b>
      clientSecret: <b class="conum">(6)</b>
        name: google-secret
      hostedDomain: "" <b class="conum">(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to the Google numeric user ID to form an
identity name. It is also used to build the redirect URL.</p>
</li>
<li>
<p><code>GoogleIdentityProvider</code> cannot be used to send <code>WWW-Authenticate</code>
challenges.</p>
</li>
<li>
<p>When <code>true</code>, unauthenticated token requests from web clients, like the web
console, are redirected to Google to log in.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and user objects.</p>
</li>
<li>
<p>The client ID of a <a href="https://console.developers.google.com/">registered
Google project</a>. The project must be configured with a redirect URI of
<code>&lt;master&gt;/oauth2callback/&lt;identityProviderName&gt;</code>.</p>
</li>
<li>
<p>Reference to an OpenShift Enterprise Secret containing the client secret
issued by Google.</p>
</li>
<li>
<p>Optional
<a href="https://developers.google.com/identity/protocols/OpenIDConnect#hd-param">hosted domain</a>
to restrict sign-in accounts to. If empty, any Google account is allowed
to authenticate.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider-configuring-google-identity-provider">Adding an identity provider to your clusters</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Enterprise cluster.</p>
</li>
<li>
<p>Create the Custom Resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc apply -f &lt;/path/to/CR&gt;</pre>
</div>
</div>
</li>
<li>
<p>Log in to the cluster as a user from your identity provider, entering the
password when prompted.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc login -u &lt;username&gt;</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc whoami</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-an-openid-connect-identity-provider">Configuring a OpenID Connect identity provider</h3>
<div class="paragraph">
<p>Configure an <code>oidc</code> identity provider to integrate with an OpenID Connect
identity provider using an
<a href="http://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth">Authorization Code Flow</a>.</p>
</div>
<div class="paragraph">
<p>You can
<a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_middleware_for_openshift/3/html/red_hat_single_sign-on_for_openshift/tutorials">configure Red Hat Single Sign-On</a>
as an OpenID Connect identity provider for OpenShift Enterprise.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><code>ID Token</code> and <code>UserInfo</code> decryptions are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, the <code>openid</code> scope is requested. If required, extra scopes can be
specified in the <code>extraScopes</code> field.</p>
</div>
<div class="paragraph">
<p>Claims are read from the JWT <code>id_token</code> returned from the OpenID identity
provider and, if specified, from the JSON returned by the <code>UserInfo</code> URL.</p>
</div>
<div class="paragraph">
<p>At least one claim must be configured to use as the user&#8217;s identity. The
standard identity claim is <code>sub</code>.</p>
</div>
<div class="paragraph">
<p>You can also indicate which claims to use as the user&#8217;s preferred user name,
display name, and email address. If multiple claims are specified, the first one
with a non-empty value is used. The standard claims are:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>sub</code>
</td>
<td class="hdlist2">
<p>Short for "subject identifier." The remote identity for the user at the
issuer.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>preferred_username</code>
</td>
<td class="hdlist2">
<p>The preferred user name when provisioning a user. A
shorthand name that the user wants to be referred to as, such as <code>janedoe</code>. Typically
a value that corresponding to the user&#8217;s login or username in the authentication
system, such as username or email.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>email</code>
</td>
<td class="hdlist2">
<p>Email address.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>name</code>
</td>
<td class="hdlist2">
<p>Display name.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the
<a href="http://openid.net/specs/openid-connect-core-1_0.html#StandardClaims">OpenID claims documentation</a>
for more information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Using an OpenID Connect identity provider requires users to get a token using
<code>&lt;master&gt;/oauth/token/request</code> to use with command-line tools.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="identity-provider-overview-configuring-oidc-identity-provider">About identity providers in OpenShift Enterprise</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a Custom Resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Enterprise user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-secret-configuring-oidc-identity-provider">Creating the Secret</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Enterprise Secrets to contain the client
secret, client certificates, and keys.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can define an OpenShift Enterprise Secret containing a string
by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create secret generic &lt;secret_name&gt; --from-literal=clientSecret=&lt;secret&gt; -n openshift-config</pre>
</div>
</div>
</li>
<li>
<p>You can define an OpenShift Enterprise Secret containing the contents of a
file, such as a certificate file, by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create secret generic &lt;secret_name&gt; --from-file=/path/to/file</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-configmap-configuring-oidc-identity-provider">Creating a ConfigMap</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Enterprise ConfigMaps to contain the
certificate authority bundle.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define an OpenShift Enterprise ConfigMap containing a the
certificate authority by using the following command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-oidc-CR-configuring-oidc-identity-provider">Sample OpenID Connect CRs</h4>
<div class="paragraph">
<p>The following Custom Resource (CR)s shows the parameters and acceptable values for an
OpenID Connect identity provider.</p>
</div>
<div class="paragraph">
<p>If you need to specify a custom certificate bundle, extra scopes, extra authorization request
parameters, or a <code>userInfo</code> URL, use the full OpenID Connect CR.</p>
</div>
<div class="listingblock">
<div class="title">Standard OpenID Connect CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: oidcidp <b class="conum">(1)</b>
    challenge: false <b class="conum">(2)</b>
    login: true <b class="conum">(3)</b>
    mappingMethod: claim <b class="conum">(4)</b>
    type: OpenID
    openID:
      clientID: ... <b class="conum">(5)</b>
      clientSecret: <b class="conum">(6)</b>
        name: idp-secret
      claims: <b class="conum">(7)</b>
        preferredUsername:
        - preferred_username
        name:
        - name
        email:
        - email
      urls:
        authorize: https://myidp.example.com/oauth2/authorize <b class="conum">(8)</b>
        token: https://myidp.example.com/oauth2/token <b class="conum">(9)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to the value of the identity claim to form an
identity name. It is also used to build the redirect URL.</p>
</li>
<li>
<p>When <code>true</code>, unauthenticated token requests from non-web clients, like
the CLI, are sent a <code>WWW-Authenticate</code> challenge header for this provider.
This requires the OpenID provider to support the
<a href="https://tools.ietf.org/html/rfc6749#section-1.3.3">Resource Owner Password Credentials</a> grant flow.</p>
</li>
<li>
<p>When <code>true</code>, unauthenticated token requests from web clients, like the web
console, are redirected to the authorize URL to log in.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and user objects.</p>
</li>
<li>
<p>The client ID of a client registered with the OpenID provider. The client
must be allowed to redirect to <code>&lt;master&gt;/oauth2callback/&lt;identityProviderName&gt;</code>.</p>
</li>
<li>
<p>Reference to an OpenShift Enterprise Secret containing the client secret.</p>
</li>
<li>
<p>List of claims to use as the identity. First non-empty claim is used. At
least one claim is required. If none of the listed claims have a value,
authentication fails. For example, this uses the value of the <code>sub</code> claim in the returned <code>id_token</code> as the user&#8217;s identity.</p>
</li>
<li>
<p><a href="http://openid.net/specs/openid-connect-core-1_0.html#AuthorizationEndpoint">Authorization Endpoint</a>
described in the OpenID spec. Must use <code>https</code>.</p>
</li>
<li>
<p><a href="http://openid.net/specs/openid-connect-core-1_0.html#TokenEndpoint">Token Endpoint</a>
described in the OpenID spec. Must use <code>https</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Full OpenID Connect CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: oidcidp
    challenge: false
    login: true
    mappingMethod: claim
    type: OpenID
    openID:
      clientID: ...
      clientSecret:
        name: idp-secret
      ca: <b class="conum">(1)</b>
        name: ca-config-map
      extraScopes: <b class="conum">(2)</b>
      - email
      - profile
      extraAuthorizeParameters: <b class="conum">(3)</b>
        include_granted_scopes: "true"
      claims:
        preferredUsername: <b class="conum">(4)</b>
        - preferred_username
        - email
        name: <b class="conum">(5)</b>
        - nickname
        - given_name
        - name
        email: <b class="conum">(6)</b>
        - custom_email_claim
        - email
      urls:
        authorize: https://myidp.example.com/oauth2/authorize
        token: https://myidp.example.com/oauth2/token
        userInfo: https://myidp.example.com/oauth2/userinfo <b class="conum">(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Optional: Reference to an OpenShift Enterprise ConfigMap containing the
PEM-encoded certificate authority bundle to use in validating server
certificates for the configured URL.</p>
</li>
<li>
<p>Optional list of scopes to request, in addition to the <strong>openid</strong> scope,
during the authorization token request.</p>
</li>
<li>
<p>Optional map of extra parameters to add to the authorization token request.</p>
</li>
<li>
<p>List of claims to use as the preferred user name when provisioning a user
for this identity. First non-empty claim is used.</p>
</li>
<li>
<p>List of claims to use as the display name. First non-empty claim is used.</p>
</li>
<li>
<p>List of claims to use as the email address. First non-empty claim is used.</p>
</li>
<li>
<p><a href="http://openid.net/specs/openid-connect-core-1_0.html#UserInfo">UserInfo Endpoint</a> described in the OpenID spec. Must use <code>https</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider-configuring-oidc-identity-provider">Adding an identity provider to your clusters</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Enterprise cluster.</p>
</li>
<li>
<p>Create the Custom Resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc apply -f &lt;/path/to/CR&gt;</pre>
</div>
</div>
</li>
<li>
<p>Log in to the cluster as a user from your identity provider, entering the
password when prompted.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc login -u &lt;username&gt;</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc whoami</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-rbac-to-define-and-apply-permissions">Using RBAC to define and apply permissions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="authorization-overview-using-rbac">RBAC overview</h3>
<div class="paragraph">
<p>Role-based access control (RBAC) objects determine whether a user is allowed to
perform a given action within a project.</p>
</div>
<div class="paragraph">
<p>Cluster administrators can use the cluster roles and
bindings to control who has various access levels to the OpenShift Enterprise
platform itself and all projects.</p>
</div>
<div class="paragraph">
<p>Developers can use local roles and bindings to control who has access
to their projects. Note that authorization is a separate step from
authentication, which is more about determining the identity of who is taking the action.</p>
</div>
<div class="paragraph">
<p>Authorization is managed using:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 87.5%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Rules</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets of permitted verbs on a set of objects. For example,
whether a user or service account can <code>create</code> pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Roles</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collections of rules. You can associate, or bind, users and groups
to multiple roles.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Bindings</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Associations between users and/or groups with a role.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are two levels of RBAC roles and bindings that control authorization:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Cluster RBAC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Roles and bindings that are applicable across
all projects. <em>Cluster roles</em> exist cluster-wide, and <em>cluster role bindings</em>
can reference only cluster roles.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Local RBAC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Roles and bindings that are scoped to a given project. While
<em>local roles</em> exist only in a single project, local role bindings can
reference <strong>both</strong> cluster and local roles.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A cluster role binding is a binding that exists at the cluster level.
A role binding exists at the project level. The cluster role <em>view</em> must be
bound to a user using a local role binding for that user to view the project.
Create local roles only if a cluster role does not provide the set
of permissions needed for a particular situation.</p>
</div>
<div class="paragraph">
<p>This two-level hierarchy allows reuse across multiple projects through the
cluster roles while allowing customization inside of individual projects
through local roles.</p>
</div>
<div class="paragraph">
<p>During evaluation, both the cluster role bindings and the local role bindings are used.
For example:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Cluster-wide "allow" rules are checked.</p>
</li>
<li>
<p>Locally-bound "allow" rules are checked.</p>
</li>
<li>
<p>Deny by default.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="default-roles-using-rbac">Default cluster roles</h4>
<div class="paragraph">
<p>OpenShift Enterprise includes a set of default cluster roles that you can bind to
users and groups cluster-wide or locally. You can manually modify the default
cluster roles, if required, but you will need to take extra steps each time
you restart a master node.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Default Cluster Role</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>admin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A project manager. If used in a local binding, an <code>admin</code> has
rights to view any resource in the project and modify any resource in the
project except for quota.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>basic-user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A user that can get basic information about projects and users.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cluster-admin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A super-user that can perform any action in any project. When
bound to a user with a local binding, they have full control over quota and
every action on every resource in the project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cluster-status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A user that can get basic cluster status information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>edit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A user that can modify most objects in a project but does not have the
power to view or modify roles or bindings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>self-provisioner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A user that can create their own projects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>view</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A user who cannot make any modifications, but can see most objects in a
project. They cannot view or modify roles or bindings.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Be mindful of the difference between local and cluster bindings. For example,
if you bind the <code>cluster-admin</code> role to a user by using a local role binding,
it might appear that this user has the privileges of a cluster administrator.
This is not the case. Binding the <code>cluster-admin</code> to a user in a project
grants super administrator privileges for only that
project to the user. That user has the permissions of the cluster role
<code>admin</code>, plus a few additional permissions like the ability to edit rate limits,
for that project.
This binding can be confusing via the web console UI, which does not list
cluster role bindings that are bound to true cluster administrators. However, it
does list local role bindings that you can use to locally bind <code>cluster-admin</code>.</p>
</div>
<div class="paragraph">
<p>The relationships between cluster roles, local roles, cluster role bindings,
local role bindings, users, groups and service accounts are illustrated below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/rbac.png" alt="OpenShift Enterprise RBAC">
</div>
</div>
</div>
<div class="sect3">
<h4 id="evaluating-authorization-using-rbac">Evaluating authorization</h4>
<div class="paragraph">
<p>OpenShift Enterprise evaluates authorization by using:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Identity</dt>
<dd>
<p>The user name and list of groups that the user belongs to.</p>
</dd>
<dt class="hdlist1">Action</dt>
<dd>
<p>The action you perform. In most cases, this consists of:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Project</strong>: The project you access. A project is a Kubernetes namespace with
additional annotations that allows a community of users to organize and manage
their content in isolation from other communities.</p>
</li>
<li>
<p><strong>Verb</strong> : The action itself:  <code>get</code>, <code>list</code>, <code>create</code>, <code>update</code>, <code>delete</code>, <code>deletecollection</code>, or <code>watch</code>.</p>
</li>
<li>
<p><strong>Resource Name</strong>: The API endpoint that you access.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Bindings</dt>
<dd>
<p>The full list of bindings, the associations between users or groups
with a role.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>OpenShift Enterprise evaluates authorization by using the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The identity and the project-scoped action is used to find all bindings that
apply to the user or their groups.</p>
</li>
<li>
<p>Bindings are used to locate all the roles that apply.</p>
</li>
<li>
<p>Roles are used to find all the rules that apply.</p>
</li>
<li>
<p>The action is checked against each rule to find a match.</p>
</li>
<li>
<p>If no matching rule is found, the action is then denied by default.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Remember that users and groups can be associated with, or bound to, multiple
roles at the same time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Project administrators can visualize roles, including a matrix of the
verbs and resources each are associated using the CLI to
view local roles and bindings.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The cluster role bound to the project administrator is limited in a project
through a local binding.
It is not bound cluster-wide like the cluster roles granted to the
<strong>cluster-admin</strong> or <strong>system:admin</strong>.</p>
</div>
<div class="paragraph">
<p>Cluster roles are roles defined at the cluster level but can be bound either at
the cluster level or at the project level.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="cluster-role-aggregations-using-rbac">Cluster Role Aggregation</h5>
<div class="paragraph">
<p>The default admin, edit, view, and cluster-reader cluster roles support
<a href="https://kubernetes.io/docs/admin/authorization/rbac/#aggregated-clusterroles">cluster role aggregation</a>,
where the cluster rules for each role are dynamically updated as
new rules are created. This feature is relevant only if you extend the
Kubernetes API by creating custom resources.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rbac-projects-namespaces-using-rbac">Projects and namespaces</h3>
<div class="paragraph">
<p>A Kubernetes <em>namespace</em> provides a mechanism to scope resources in a cluster.
The
<a href="https://kubernetes.io/docs/tasks/administer-cluster/namespaces/">Kubernetes documentation</a>
has more information on namespaces.</p>
</div>
<div class="paragraph">
<p>Namespaces provide a unique scope for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Named resources to avoid basic naming collisions.</p>
</li>
<li>
<p>Delegated management authority to trusted users.</p>
</li>
<li>
<p>The ability to limit community resource consumption.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Most objects in the system are scoped by namespace, but some are
excepted and have no namespace, including nodes and users.</p>
</div>
<div class="paragraph">
<p>A <em>project</em> is a Kubernetes namespace with additional annotations and is the central vehicle
by which access to resources for regular users is managed.
A project allows a community of users to organize and manage their content in
isolation from other communities. Users must be given access to projects by administrators,
or if allowed to create projects, automatically have access to their own projects.</p>
</div>
<div class="paragraph">
<p>Projects can have a separate <code>name</code>, <code>displayName</code>, and <code>description</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The mandatory <code>name</code> is a unique identifier for the project and is most visible when using the CLI tools or API. The maximum name length is 63 characters.</p>
</li>
<li>
<p>The optional <code>displayName</code> is how the project is displayed in the web console (defaults to <code>name</code>).</p>
</li>
<li>
<p>The optional <code>description</code> can be a more detailed description of the project and is also visible in the web console.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each project scopes its own set of:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Objects</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pods, services, replication controllers, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Policies</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rules for which users can or cannot perform actions on objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Constraints</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Quotas for each kind of object that can be limited.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Service accounts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service accounts act automatically with designated access to objects in the project.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Cluster administrators can create projects and delegate administrative rights
for the project to any member of the user community. Cluster administrators can
also allow developers to create their own projects.</p>
</div>
<div class="paragraph">
<p>Developers and administrators can interact with projects the CLI or the
web console.</p>
</div>
</div>
<div class="sect2">
<h3 id="rbac-default-projects-using-rbac">Default projects</h3>
<div class="paragraph">
<p>OpenShift Enterprise comes with a number of default projects, and projects
starting with <code>openshift-</code> are the most essential to users.
These projects host master components that run as pods and other infrastructure
components. The pods created in these namespaces that have a
<a href="https://kubernetes.io/docs/tasks/administer-cluster/guaranteed-scheduling-critical-addon-pods/#rescheduler-guaranteed-scheduling-of-critical-add-ons">critical pod annotation</a>
are considered critical, and the have guaranteed admission by kubelet.
Pods created for master components in these namespaces are already marked as
critical.</p>
</div>
</div>
<div class="sect2">
<h3 id="viewing-cluster-roles-using-rbac">Viewing cluster roles and bindings</h3>
<div class="paragraph">
<p>You can use the <code>oc</code> CLI to view cluster roles and bindings by using the
<code>oc describe</code> command.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install the <code>oc</code> CLI.</p>
</li>
<li>
<p>Obtain permission to view the cluster roles and bindings.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users with the <strong>cluster-admin</strong> default cluster role bound cluster-wide can
perform any action on any resource, including viewing cluster roles and bindings.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To view the cluster roles and their associated rule sets:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe clusterrole.rbac
Name:         admin
Labels:       kubernetes.io/bootstrapping=rbac-defaults
Annotations:  rbac.authorization.kubernetes.io/autoupdate: true
PolicyRule:
  Resources                                                  Non-Resource URLs  Resource Names  Verbs
  ---------                                                  -----------------  --------------  -----
  .packages.apps.redhat.com                                  []                 []              [* create update patch delete get list watch]
  imagestreams                                               []                 []              [create delete deletecollection get list patch update watch create get list watch]
  imagestreams.image.openshift.io                            []                 []              [create delete deletecollection get list patch update watch create get list watch]
  secrets                                                    []                 []              [create delete deletecollection get list patch update watch get list watch create delete deletecollection patch update]
  buildconfigs/webhooks                                      []                 []              [create delete deletecollection get list patch update watch get list watch]
  buildconfigs                                               []                 []              [create delete deletecollection get list patch update watch get list watch]
  buildlogs                                                  []                 []              [create delete deletecollection get list patch update watch get list watch]
  deploymentconfigs/scale                                    []                 []              [create delete deletecollection get list patch update watch get list watch]
  deploymentconfigs                                          []                 []              [create delete deletecollection get list patch update watch get list watch]
  imagestreamimages                                          []                 []              [create delete deletecollection get list patch update watch get list watch]
  imagestreammappings                                        []                 []              [create delete deletecollection get list patch update watch get list watch]
  imagestreamtags                                            []                 []              [create delete deletecollection get list patch update watch get list watch]
  processedtemplates                                         []                 []              [create delete deletecollection get list patch update watch get list watch]
  routes                                                     []                 []              [create delete deletecollection get list patch update watch get list watch]
  templateconfigs                                            []                 []              [create delete deletecollection get list patch update watch get list watch]
  templateinstances                                          []                 []              [create delete deletecollection get list patch update watch get list watch]
  templates                                                  []                 []              [create delete deletecollection get list patch update watch get list watch]
  deploymentconfigs.apps.openshift.io/scale                  []                 []              [create delete deletecollection get list patch update watch get list watch]
  deploymentconfigs.apps.openshift.io                        []                 []              [create delete deletecollection get list patch update watch get list watch]
  buildconfigs.build.openshift.io/webhooks                   []                 []              [create delete deletecollection get list patch update watch get list watch]
  buildconfigs.build.openshift.io                            []                 []              [create delete deletecollection get list patch update watch get list watch]
  buildlogs.build.openshift.io                               []                 []              [create delete deletecollection get list patch update watch get list watch]
  imagestreamimages.image.openshift.io                       []                 []              [create delete deletecollection get list patch update watch get list watch]
  imagestreammappings.image.openshift.io                     []                 []              [create delete deletecollection get list patch update watch get list watch]
  imagestreamtags.image.openshift.io                         []                 []              [create delete deletecollection get list patch update watch get list watch]
  routes.route.openshift.io                                  []                 []              [create delete deletecollection get list patch update watch get list watch]
  processedtemplates.template.openshift.io                   []                 []              [create delete deletecollection get list patch update watch get list watch]
  templateconfigs.template.openshift.io                      []                 []              [create delete deletecollection get list patch update watch get list watch]
  templateinstances.template.openshift.io                    []                 []              [create delete deletecollection get list patch update watch get list watch]
  templates.template.openshift.io                            []                 []              [create delete deletecollection get list patch update watch get list watch]
  serviceaccounts                                            []                 []              [create delete deletecollection get list patch update watch impersonate create delete deletecollection patch update get list watch]
  imagestreams/secrets                                       []                 []              [create delete deletecollection get list patch update watch]
  rolebindings                                               []                 []              [create delete deletecollection get list patch update watch]
  roles                                                      []                 []              [create delete deletecollection get list patch update watch]
  rolebindings.authorization.openshift.io                    []                 []              [create delete deletecollection get list patch update watch]
  roles.authorization.openshift.io                           []                 []              [create delete deletecollection get list patch update watch]
  imagestreams.image.openshift.io/secrets                    []                 []              [create delete deletecollection get list patch update watch]
  rolebindings.rbac.authorization.k8s.io                     []                 []              [create delete deletecollection get list patch update watch]
  roles.rbac.authorization.k8s.io                            []                 []              [create delete deletecollection get list patch update watch]
  networkpolicies.extensions                                 []                 []              [create delete deletecollection patch update create delete deletecollection get list patch update watch get list watch]
  networkpolicies.networking.k8s.io                          []                 []              [create delete deletecollection patch update create delete deletecollection get list patch update watch get list watch]
  configmaps                                                 []                 []              [create delete deletecollection patch update get list watch]
  endpoints                                                  []                 []              [create delete deletecollection patch update get list watch]
  persistentvolumeclaims                                     []                 []              [create delete deletecollection patch update get list watch]
  pods                                                       []                 []              [create delete deletecollection patch update get list watch]
  replicationcontrollers/scale                               []                 []              [create delete deletecollection patch update get list watch]
  replicationcontrollers                                     []                 []              [create delete deletecollection patch update get list watch]
  services                                                   []                 []              [create delete deletecollection patch update get list watch]
  daemonsets.apps                                            []                 []              [create delete deletecollection patch update get list watch]
  deployments.apps/scale                                     []                 []              [create delete deletecollection patch update get list watch]
  deployments.apps                                           []                 []              [create delete deletecollection patch update get list watch]
  replicasets.apps/scale                                     []                 []              [create delete deletecollection patch update get list watch]
  replicasets.apps                                           []                 []              [create delete deletecollection patch update get list watch]
  statefulsets.apps/scale                                    []                 []              [create delete deletecollection patch update get list watch]
  statefulsets.apps                                          []                 []              [create delete deletecollection patch update get list watch]
  horizontalpodautoscalers.autoscaling                       []                 []              [create delete deletecollection patch update get list watch]
  cronjobs.batch                                             []                 []              [create delete deletecollection patch update get list watch]
  jobs.batch                                                 []                 []              [create delete deletecollection patch update get list watch]
  daemonsets.extensions                                      []                 []              [create delete deletecollection patch update get list watch]
  deployments.extensions/scale                               []                 []              [create delete deletecollection patch update get list watch]
  deployments.extensions                                     []                 []              [create delete deletecollection patch update get list watch]
  ingresses.extensions                                       []                 []              [create delete deletecollection patch update get list watch]
  replicasets.extensions/scale                               []                 []              [create delete deletecollection patch update get list watch]
  replicasets.extensions                                     []                 []              [create delete deletecollection patch update get list watch]
  replicationcontrollers.extensions/scale                    []                 []              [create delete deletecollection patch update get list watch]
  poddisruptionbudgets.policy                                []                 []              [create delete deletecollection patch update get list watch]
  deployments.apps/rollback                                  []                 []              [create delete deletecollection patch update]
  deployments.extensions/rollback                            []                 []              [create delete deletecollection patch update]
  catalogsources.operators.coreos.com                        []                 []              [create update patch delete get list watch]
  clusterserviceversions.operators.coreos.com                []                 []              [create update patch delete get list watch]
  installplans.operators.coreos.com                          []                 []              [create update patch delete get list watch]
  packagemanifests.operators.coreos.com                      []                 []              [create update patch delete get list watch]
  subscriptions.operators.coreos.com                         []                 []              [create update patch delete get list watch]
  buildconfigs/instantiate                                   []                 []              [create]
  buildconfigs/instantiatebinary                             []                 []              [create]
  builds/clone                                               []                 []              [create]
  deploymentconfigrollbacks                                  []                 []              [create]
  deploymentconfigs/instantiate                              []                 []              [create]
  deploymentconfigs/rollback                                 []                 []              [create]
  imagestreamimports                                         []                 []              [create]
  localresourceaccessreviews                                 []                 []              [create]
  localsubjectaccessreviews                                  []                 []              [create]
  podsecuritypolicyreviews                                   []                 []              [create]
  podsecuritypolicyselfsubjectreviews                        []                 []              [create]
  podsecuritypolicysubjectreviews                            []                 []              [create]
  resourceaccessreviews                                      []                 []              [create]
  routes/custom-host                                         []                 []              [create]
  subjectaccessreviews                                       []                 []              [create]
  subjectrulesreviews                                        []                 []              [create]
  deploymentconfigrollbacks.apps.openshift.io                []                 []              [create]
  deploymentconfigs.apps.openshift.io/instantiate            []                 []              [create]
  deploymentconfigs.apps.openshift.io/rollback               []                 []              [create]
  localsubjectaccessreviews.authorization.k8s.io             []                 []              [create]
  localresourceaccessreviews.authorization.openshift.io      []                 []              [create]
  localsubjectaccessreviews.authorization.openshift.io       []                 []              [create]
  resourceaccessreviews.authorization.openshift.io           []                 []              [create]
  subjectaccessreviews.authorization.openshift.io            []                 []              [create]
  subjectrulesreviews.authorization.openshift.io             []                 []              [create]
  buildconfigs.build.openshift.io/instantiate                []                 []              [create]
  buildconfigs.build.openshift.io/instantiatebinary          []                 []              [create]
  builds.build.openshift.io/clone                            []                 []              [create]
  imagestreamimports.image.openshift.io                      []                 []              [create]
  routes.route.openshift.io/custom-host                      []                 []              [create]
  podsecuritypolicyreviews.security.openshift.io             []                 []              [create]
  podsecuritypolicyselfsubjectreviews.security.openshift.io  []                 []              [create]
  podsecuritypolicysubjectreviews.security.openshift.io      []                 []              [create]
  jenkins.build.openshift.io                                 []                 []              [edit view view admin edit view]
  builds                                                     []                 []              [get create delete deletecollection get list patch update watch get list watch]
  builds.build.openshift.io                                  []                 []              [get create delete deletecollection get list patch update watch get list watch]
  projects                                                   []                 []              [get delete get delete get patch update]
  projects.project.openshift.io                              []                 []              [get delete get delete get patch update]
  namespaces                                                 []                 []              [get get list watch]
  pods/attach                                                []                 []              [get list watch create delete deletecollection patch update]
  pods/exec                                                  []                 []              [get list watch create delete deletecollection patch update]
  pods/portforward                                           []                 []              [get list watch create delete deletecollection patch update]
  pods/proxy                                                 []                 []              [get list watch create delete deletecollection patch update]
  services/proxy                                             []                 []              [get list watch create delete deletecollection patch update]
  routes/status                                              []                 []              [get list watch update]
  routes.route.openshift.io/status                           []                 []              [get list watch update]
  appliedclusterresourcequotas                               []                 []              [get list watch]
  bindings                                                   []                 []              [get list watch]
  builds/log                                                 []                 []              [get list watch]
  deploymentconfigs/log                                      []                 []              [get list watch]
  deploymentconfigs/status                                   []                 []              [get list watch]
  events                                                     []                 []              [get list watch]
  imagestreams/status                                        []                 []              [get list watch]
  limitranges                                                []                 []              [get list watch]
  namespaces/status                                          []                 []              [get list watch]
  pods/log                                                   []                 []              [get list watch]
  pods/status                                                []                 []              [get list watch]
  replicationcontrollers/status                              []                 []              [get list watch]
  resourcequotas/status                                      []                 []              [get list watch]
  resourcequotas                                             []                 []              [get list watch]
  resourcequotausages                                        []                 []              [get list watch]
  rolebindingrestrictions                                    []                 []              [get list watch]
  deploymentconfigs.apps.openshift.io/log                    []                 []              [get list watch]
  deploymentconfigs.apps.openshift.io/status                 []                 []              [get list watch]
  controllerrevisions.apps                                   []                 []              [get list watch]
  rolebindingrestrictions.authorization.openshift.io         []                 []              [get list watch]
  builds.build.openshift.io/log                              []                 []              [get list watch]
  imagestreams.image.openshift.io/status                     []                 []              [get list watch]
  appliedclusterresourcequotas.quota.openshift.io            []                 []              [get list watch]
  imagestreams/layers                                        []                 []              [get update get]
  imagestreams.image.openshift.io/layers                     []                 []              [get update get]
  builds/details                                             []                 []              [update]
  builds.build.openshift.io/details                          []                 []              [update]


Name:         basic-user
Labels:       &lt;none&gt;
Annotations:  openshift.io/description: A user that can get basic information about projects.
	              rbac.authorization.kubernetes.io/autoupdate: true
PolicyRule:
	Resources                                           Non-Resource URLs  Resource Names  Verbs
	  ---------                                           -----------------  --------------  -----
	  selfsubjectrulesreviews                             []                 []              [create]
	  selfsubjectaccessreviews.authorization.k8s.io       []                 []              [create]
	  selfsubjectrulesreviews.authorization.openshift.io  []                 []              [create]
	  clusterroles.rbac.authorization.k8s.io              []                 []              [get list watch]
	  clusterroles                                        []                 []              [get list]
	  clusterroles.authorization.openshift.io             []                 []              [get list]
	  storageclasses.storage.k8s.io                       []                 []              [get list]
	  users                                               []                 [~]             [get]
	  users.user.openshift.io                             []                 [~]             [get]
	  projects                                            []                 []              [list watch]
	  projects.project.openshift.io                       []                 []              [list watch]
	  projectrequests                                     []                 []              [list]
	  projectrequests.project.openshift.io                []                 []              [list]

Name:         cluster-admin
Labels:       kubernetes.io/bootstrapping=rbac-defaults
Annotations:  rbac.authorization.kubernetes.io/autoupdate: true
PolicyRule:
Resources  Non-Resource URLs  Resource Names  Verbs
---------  -----------------  --------------  -----
*.*        []                 []              [*]
           [*]                []              [*]

...</pre>
</div>
</div>
</li>
<li>
<p>To view the current set of cluster role bindings, which shows the users and
groups that are bound to various roles:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe clusterrolebinding.rbac
Name:         alertmanager-main
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Role:
  Kind:  ClusterRole
  Name:  alertmanager-main
Subjects:
  Kind            Name               Namespace
  ----            ----               ---------
  ServiceAccount  alertmanager-main  openshift-monitoring


Name:         basic-users
Labels:       &lt;none&gt;
Annotations:  rbac.authorization.kubernetes.io/autoupdate: true
Role:
  Kind:  ClusterRole
  Name:  basic-user
Subjects:
  Kind   Name                  Namespace
  ----   ----                  ---------
  Group  system:authenticated


Name:         cloud-credential-operator-rolebinding
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Role:
  Kind:  ClusterRole
  Name:  cloud-credential-operator-role
Subjects:
  Kind            Name     Namespace
  ----            ----     ---------
  ServiceAccount  default  openshift-cloud-credential-operator


Name:         cluster-admin
Labels:       kubernetes.io/bootstrapping=rbac-defaults
Annotations:  rbac.authorization.kubernetes.io/autoupdate: true
Role:
  Kind:  ClusterRole
  Name:  cluster-admin
Subjects:
  Kind   Name            Namespace
  ----   ----            ---------
  Group  system:masters


Name:         cluster-admins
Labels:       &lt;none&gt;
Annotations:  rbac.authorization.kubernetes.io/autoupdate: true
Role:
  Kind:  ClusterRole
  Name:  cluster-admin
Subjects:
  Kind   Name                   Namespace
  ----   ----                   ---------
  Group  system:cluster-admins
  User   system:admin


Name:         cluster-api-manager-rolebinding
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Role:
  Kind:  ClusterRole
  Name:  cluster-api-manager-role
Subjects:
  Kind            Name     Namespace
  ----            ----     ---------
  ServiceAccount  default  openshift-machine-api

...</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="viewing-local-roles-using-rbac">Viewing local roles and bindings</h3>
<div class="paragraph">
<p>You can use the <code>oc</code> CLI to view local roles and bindings by using the
<code>oc describe</code> command.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install the <code>oc</code> CLI.</p>
</li>
<li>
<p>Obtain permission to view the local roles and bindings:</p>
<div class="ulist">
<ul>
<li>
<p>Users with the <code>cluster-admin</code> default cluster role bound cluster-wide can
perform any action on any resource, including viewing local roles and bindings.</p>
</li>
<li>
<p>Users with the <code>admin</code> default cluster role bound locally can view and manage
roles and bindings in that project.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To view the current set of local role bindings, which show the users and groups
that are bound to various roles for the current project:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe rolebinding.rbac</pre>
</div>
</div>
</li>
<li>
<p>To view the local role bindings for a different project, add the <code>-n</code> flag
to the command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe rolebinding.rbac -n joe-project
Name:         admin
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Role:
  Kind:  ClusterRole
  Name:  admin
Subjects:
  Kind  Name        Namespace
  ----  ----        ---------
  User  kube:admin


Name:         system:deployers
Labels:       &lt;none&gt;
Annotations:  openshift.io/description:
                Allows deploymentconfigs in this namespace to rollout pods in
                this namespace.  It is auto-managed by a controller; remove
                subjects to disa...
Role:
  Kind:  ClusterRole
  Name:  system:deployer
Subjects:
  Kind            Name      Namespace
  ----            ----      ---------
  ServiceAccount  deployer  joe-project


Name:         system:image-builders
Labels:       &lt;none&gt;
Annotations:  openshift.io/description:
                Allows builds in this namespace to push images to this
                namespace.  It is auto-managed by a controller; remove subjects
                to disable.
Role:
  Kind:  ClusterRole
  Name:  system:image-builder
Subjects:
  Kind            Name     Namespace
  ----            ----     ---------
  ServiceAccount  builder  joe-project


Name:         system:image-pullers
Labels:       &lt;none&gt;
Annotations:  openshift.io/description:
                Allows all pods in this namespace to pull images from this
                namespace.  It is auto-managed by a controller; remove subjects
                to disable.
Role:
  Kind:  ClusterRole
  Name:  system:image-puller
Subjects:
  Kind   Name                                Namespace
  ----   ----                                ---------
  Group  system:serviceaccounts:joe-project</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="adding-roles-using-rbac">Adding roles to users</h3>
<div class="paragraph">
<p>You can use  the <code>oc adm</code> administrator CLI to manage the roles and bindings.</p>
</div>
<div class="paragraph">
<p>Binding, or adding, a role to users or groups gives the user or group the access
that is granted by the role. You can add and remove roles to and from users and
groups using <code>oc adm policy</code> commands.</p>
</div>
<div class="paragraph">
<p>You can bind any of the default cluster roles to local users or groups in your
project.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add a role to a user in a specific project:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc adm policy add-role-to-user &lt;role&gt; &lt;user&gt; -n &lt;project&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example, you can add the <code>admin</code> role to the <code>alice</code> user in <code>joe</code> project
by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc adm policy add-role-to-user admin alice -n joe</pre>
</div>
</div>
</li>
<li>
<p>View the local role bindings and verify the addition in the output:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe rolebinding.rbac -n &lt;project&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example, to view the local role bindings for the <code>joe</code> project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe rolebinding.rbac -n joe
Name:         admin
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Role:
  Kind:  ClusterRole
  Name:  admin
Subjects:
  Kind  Name        Namespace
  ----  ----        ---------
  User  kube:admin


Name:         admin-0
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Role:
  Kind:  ClusterRole
  Name:  admin
Subjects:
  Kind  Name   Namespace
  ----  ----   ---------
  User  alice <b class="conum">(1)</b>


Name:         system:deployers
Labels:       &lt;none&gt;
Annotations:  openshift.io/description:
                Allows deploymentconfigs in this namespace to rollout pods in
                this namespace.  It is auto-managed by a controller; remove
                subjects to disa...
Role:
  Kind:  ClusterRole
  Name:  system:deployer
Subjects:
  Kind            Name      Namespace
  ----            ----      ---------
  ServiceAccount  deployer  joe


Name:         system:image-builders
Labels:       &lt;none&gt;
Annotations:  openshift.io/description:
                Allows builds in this namespace to push images to this
                namespace.  It is auto-managed by a controller; remove subjects
                to disable.
Role:
  Kind:  ClusterRole
  Name:  system:image-builder
Subjects:
  Kind            Name     Namespace
  ----            ----     ---------
  ServiceAccount  builder  joe


Name:         system:image-pullers
Labels:       &lt;none&gt;
Annotations:  openshift.io/description:
                Allows all pods in this namespace to pull images from this
                namespace.  It is auto-managed by a controller; remove subjects
                to disable.
Role:
  Kind:  ClusterRole
  Name:  system:image-puller
Subjects:
  Kind   Name                                Namespace
  ----   ----                                ---------
  Group  system:serviceaccounts:joe</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>alice</code> user has been added to the <code>admins</code> <code>RoleBinding</code>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-local-role-using-rbac">Creating a local role</h3>
<div class="paragraph">
<p>You can create a local role for a project and then bind it to a user.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To create a local role for a project, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create role &lt;name&gt; --verb=&lt;verb&gt; --resource=&lt;resource&gt; -n &lt;project&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In this command, specify:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>&lt;name&gt;</code>, the local role&#8217;s name</p>
</li>
<li>
<p><code>&lt;verb&gt;</code>, a comma-separated list of the verbs to apply to the role</p>
</li>
<li>
<p><code>&lt;resource&gt;</code>, the resources that the role applies to</p>
</li>
<li>
<p><code>&lt;project&gt;</code>, the project name</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>For example, to create a local role that allows a user to view pods in the
<code>blue</code> project, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create role podview --verb=get --resource=pod -n blue</pre>
</div>
</div>
</li>
<li>
<p>To bind the new role to a user, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc adm policy add-role-to-user podview user2 --role-namespace=blue -n blue</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-cluster-role-using-rbac">Creating a cluster role</h3>
<div class="paragraph">
<p>You can create a cluster role.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To create a cluster role, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create clusterrole &lt;name&gt; --verb=&lt;verb&gt; --resource=&lt;resource&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In this command, specify:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;name&gt;</code>, the local role&#8217;s name</p>
</li>
<li>
<p><code>&lt;verb&gt;</code>, a comma-separated list of the verbs to apply to the role</p>
</li>
<li>
<p><code>&lt;resource&gt;</code>, the resources that the role applies to</p>
<div class="paragraph">
<p>For example, to create a cluster role that allows a user to view pods, run the
following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create clusterrole podviewonly --verb=get --resource=pod</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="local-role-binding-commands-using-rbac">Local role binding commands</h3>
<div class="paragraph">
<p>When you manage a user or group&#8217;s associated roles for local role bindings using the
following operations, a project may be specified with the <code>-n</code> flag. If it is
not specified, then the current project is used.</p>
</div>
<div class="paragraph">
<p>You can use the following commands for local RBAC management.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Local role binding operations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$ oc adm policy who-can <em>&lt;verb&gt;</em> <em>&lt;resource&gt;</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates which users can perform an action on a resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$ oc adm policy add-role-to-user <em>&lt;role&gt;</em> <em>&lt;username&gt;</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds a specified role to specified users in the current project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$ oc adm policy remove-role-from-user <em>&lt;role&gt;</em> <em>&lt;username&gt;</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes a given role from specified users in the current project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$ oc adm policy remove-user <em>&lt;username&gt;</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes specified users and all of their roles in the current project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$ oc adm policy add-role-to-group <em>&lt;role&gt;</em> <em>&lt;groupname&gt;</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds a given role to specified groups in the current project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$ oc adm policy remove-role-from-group <em>&lt;role&gt;</em> <em>&lt;groupname&gt;</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes a given role from specified groups in the current project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$ oc adm policy remove-group <em>&lt;groupname&gt;</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes specified groups and all of their roles in the current project.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="cluster-role-binding-commands-using-rbac">Cluster role binding commands</h3>
<div class="paragraph">
<p>You can also manage cluster role bindings using the following
operations. The <code>-n</code> flag is not used for these operations because
cluster role bindings use non-namespaced resources.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Cluster role binding operations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$ oc adm policy add-cluster-role-to-user <em>&lt;role&gt;</em> <em>&lt;username&gt;</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds a given role to specified users for all projects in the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$ oc adm policy remove-cluster-role-from-user <em>&lt;role&gt;</em> <em>&lt;username&gt;</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes a given role from specified users for all projects in the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$ oc adm policy add-cluster-role-to-group <em>&lt;role&gt;</em> <em>&lt;groupname&gt;</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds a given role to specified groups for all projects in the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$ oc adm policy remove-cluster-role-from-group <em>&lt;role&gt;</em> <em>&lt;groupname&gt;</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes a given role from specified groups for all projects in the cluster.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="removing-the-kubeadmin-user">Removing the kubeadmin user</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="understanding-kubeadmin-removing-kubeadmin">The kubeadmin user</h3>
<div class="paragraph">
<p>OpenShift Enterprise creates a cluster administrator, <code>kubeadmin</code>, after the
installation process completes.</p>
</div>
<div class="paragraph">
<p>This user has the <code>cluster-admin</code> role automatically applied and is treated
as the root user for the cluster. The password is dynamically generated
and unique to your OpenShift Enterprise environment. After installation
completes the password is provided in the installation program&#8217;s output.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">INFO Install complete!
INFO Run 'export KUBECONFIG=&lt;your working directory&gt;/auth/kubeconfig' to manage the cluster with 'oc', the OpenShift CLI.
INFO The cluster is ready when 'oc login -u kubeadmin -p &lt;provided&gt;' succeeds (wait a few minutes).
INFO Access the OpenShift web-console here: https://console-openshift-console.apps.demo1.openshift4-beta-abcorp.com
INFO Login to the console with user: kubeadmin, password: &lt;provided&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="removing-kubeadmin-removing-kubeadmin">Removing the kubeadmin user</h3>
<div class="paragraph">
<p>After you define an identity provider and create a new <code>cluster-admin</code>
user, you can remove the <code>kubeadmin</code> to improve cluster security.</p>
</div>
<div class="paragraph">
<p>WARNING</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>If you follow this procedure before another user is a <code>cluster-admin</code>,
then OpenShift Enterprise must be reinstalled. It is not possible to undo
this command.</p>
</div>
</div>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have configured at least one identity provider.</p>
</li>
<li>
<p>You must have added the <code>cluster-admin</code> role to a user.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Remove the <code>kubeadmin</code> secrets:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc delete secrets kubeadmin -n kube-system</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-ldap-failover">Configuring LDAP failover</h2>
<div class="sectionbody">
<div id="sssd-for-ldap-overview-sssd-ldap-failover" class="paragraph">
<p>OpenShift Enterprise provides an authentication
provider for use with Lightweight Directory Access Protocol (LDAP) setups, but
it can connect to only a single LDAP server. During OpenShift Enterprise installation,
you can configure the System Security
Services Daemon (SSSD) for LDAP failover to ensure access to your cluster if one
LDAP server fails.</p>
</div>
<div class="paragraph">
<p>The setup for this configuration is advanced and requires a separate
authentication server, also called an <strong>remote basic authentication server</strong>, for
OpenShift Enterprise to communicate with. You configure this server
to pass extra attributes, such as email addresses, to OpenShift Enterprise so it can
display them in the web console.</p>
</div>
<div class="paragraph">
<p>This topic describes how to complete this set up on a dedicated physical or
virtual machine (VM), but you can also configure SSSD in containers.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>You must complete all sections of this topic.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="sssd-for-ldap-prereqs-sssd-ldap-failover">Prerequisites for configuring basic remote authentication</h3>
<div class="ulist">
<ul>
<li>
<p>Before starting setup, you need to know the following information about your
LDAP server:</p>
<div class="ulist">
<ul>
<li>
<p>Whether the directory server is powered by
<a href="http://www.freeipa.org/page/Main_Page">FreeIPA</a>, Active Directory, or another
LDAP solution.</p>
</li>
<li>
<p>The Uniform Resource Identifier (URI) for the LDAP server, for example,
<code>ldap.example.com</code>.</p>
</li>
<li>
<p>The location of the CA certificate for the LDAP server.</p>
</li>
<li>
<p>Whether the LDAP server corresponds to RFC 2307 or RFC2307bis for user groups.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Prepare the servers:</p>
<div class="ulist">
<ul>
<li>
<p><code>remote-basic.example.com</code>: A VM to use as the remote basic authentication server.</p>
<div class="ulist">
<ul>
<li>
<p>Select an operating system that includes SSSD version 1.12.0 for this server
such as Red Hat Enterprise Linux 7.0 or later.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>openshift.example.com</code>: A new installation of OpenShift Enterprise.</p>
<div class="ulist">
<ul>
<li>
<p>You must not
have an authentication method configured for this cluster.</p>
</li>
<li>
<p>Do not start OpenShift Enterprise on this cluster.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sssd-generating-certificates-sssd-ldap-failover">Generating and sharing certificates with the remote basic authentication server</h3>
<div class="paragraph">
<p>Complete the following steps on the first master host listed in the Ansible host inventory file,
by default <strong><em>/etc/ansible/hosts</em></strong>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To ensure that communication between the remote basic authentication server and
OpenShift Enterprise is trustworthy, create a set of Transport Layer Security (TLS)
certificates to use during the other phases of this set up. Run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openshift start \
    --public-master=https://openshift.example.com:8443 \
    --write-config=/etc/origin/</pre>
</div>
</div>
<div class="paragraph">
<p>The output inclues the <strong><em>/etc/origin/master/ca.crt</em></strong> and
<strong><em>/etc/origin/master/ca.key</em></strong> signing certificates.</p>
</div>
</li>
<li>
<p>Use the signing certificate to generate keys to use on the remote basic
authentication server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /etc/origin/remote-basic/
# oc adm ca create-server-cert \
    --cert='/etc/origin/remote-basic/remote-basic.example.com.crt' \
    --key='/etc/origin/remote-basic/remote-basic.example.com.key' \
    --hostnames=remote-basic.example.com \ <b class="conum">(1)</b>
    --signer-cert='/etc/origin/master/ca.crt' \
    --signer-key='/etc/origin/master/ca.key' \
    --signer-serial='/etc/origin/master/ca.serial.txt'</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A comma-separated list of all the host names and interface IP addresses that need to access the
remote basic authentication server.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The certificate files that you generate are valid for two years. You can alter
this period by changing the <code>--expire-days</code> and <code>--signer-expire-days</code> values,
but for security reasons, do not make them greater than 730.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you do not list all host names and interface IP addresses that need to access the
remote basic authentication server, the HTTPS connection will fail.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Copy the necessary certificates and key to the remote basic authentication server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /etc/origin/master/ca.crt \
      root@remote-basic.example.com:/etc/pki/CA/certs/

# scp /etc/origin/remote-basic/remote-basic.example.com.crt \
      root@remote-basic.example.com:/etc/pki/tls/certs/

# scp /etc/origin/remote-basic/remote-basic.example.com.key \
      root@remote-basic.example.com:/etc/pki/tls/private/</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sssd-configuring-sssd-sssd-ldap-failover">Configuring SSSD for LDAP failover</h3>
<div class="paragraph">
<p>Complete these steps on the remote basic authentication server.</p>
</div>
<div class="paragraph">
<p>You can configure the SSSD to retrieve attributes, such as email addresses and
display names, and pass them to OpenShift Enterprise to display in the web interface.
In the following steps, you configure the SSSD to provide email addresses to
OpenShift Enterprise.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the required SSSD and the web server components:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install -y sssd \
                 sssd-dbus \
                 realmd \
                 httpd \
                 mod_session \
                 mod_ssl \
                 mod_lookup_identity \
                 mod_authnz_pam \
                 php \
                 mod_php</pre>
</div>
</div>
</li>
<li>
<p>Set up SSSD to authenticate this VM against the LDAP server. If the LDAP server
is a FreeIPA or Active Directory environment, then use <code>realmd</code> to join
this machine to the domain.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># realm join ldap.example.com</pre>
</div>
</div>
<div class="paragraph">
<p>For more advanced cases, see the
<a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System-Level_Authentication_Guide/authconfig-ldap.html">System-Level Authentication Guide</a></p>
</div>
</li>
<li>
<p>To use SSSD to manage failover situations for LDAP, add more entries to the
 <strong><em>/etc/sssd/sssd.conf</em></strong> file on the <code>ldap_uri</code> line. Systems that are
enrolled with FreeIPA can automatically handle failover by using DNS SRV records.</p>
</li>
<li>
<p>Modify the <code>[domain/DOMAINNAME]</code> section of the <strong><em>/etc/sssd/sssd.conf</em></strong> file
and add this attribute:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[domain/example.com]
...
ldap_user_extra_attrs = mail <b class="conum">(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specify the correct attribute to retrieve email addresses for your LDAP
solution. For IPA, specify <code>mail</code>. Other LDAP solutions might use another
attribute, such as <code>email</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Confirm that the <code>domain</code> parameter in the <strong><em>/etc/sssd/sssd.conf</em></strong> file
contains only the domain name listed in the <code>[domain/DOMAINNAME]</code> section.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">domains = example.com</pre>
</div>
</div>
</li>
<li>
<p>Grant Apache permission to retrieve the email attribute. Add the following
lines to the <code>[ifp]</code> section of the <strong><em>/etc/sssd/sssd.conf</em></strong> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[ifp]
user_attributes = +mail
allowed_uids = apache, root</pre>
</div>
</div>
</li>
<li>
<p>To ensure that all of the changes are applied properly, restart SSSD:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ systemctl restart sssd.service</pre>
</div>
</div>
</li>
<li>
<p>Test that the user information can be retrieved properly:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ getent passwd &lt;username&gt;
username:*:12345:12345:Example User:/home/username:/usr/bin/bash</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the mail attribute you specified returns an email address from
your domain:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dbus-send --print-reply --system --dest=org.freedesktop.sssd.infopipe \
    /org/freedesktop/sssd/infopipe org.freedesktop.sssd.infopipe.GetUserAttr \
    string:username \ <b class="conum">(1)</b>
    array:string:mail <b class="conum">(2)</b>

method return time=1528091855.672691 sender=:1.2787 -&gt; destination=:1.2795 serial=13 reply_serial=2
   array [
      dict entry(
         string "mail"
         variant             array [
               string "username@example.com"
            ]
      )
   ]</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Provide a user name in your LDAP solution.</p>
</li>
<li>
<p>Specify the attribute that you configured.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Attempt to log into the VM as an LDAP user and confirm that you can log in
using LDAP credentials. You can use either the local console or a remote service
like SSH to log in.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, all users can log into the remote basic authentication server by using
their LDAP credentials. You can change this behavior:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you use IPA joined systems,
<a href="https://www.freeipa.org/page/Howto/HBAC_and_allow_all">configure host-based access control</a>.</p>
</li>
<li>
<p>If you use Active Directory joined systems, use a
<a href="https://docs.pagure.org/SSSD.sssd/design_pages/active_directory_gpo_integration.html">group policy object</a>.</p>
</li>
<li>
<p>For other cases, see the
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system-level_authentication_guide/sssd">SSSD configuration</a> documentation.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sssd-configuring-apache-sssd-ldap-failover">Configuring Apache to use SSSD</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <strong><em>/etc/pam.d/openshift</em></strong> file that contains the
following contents:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">auth required pam_sss.so
account required pam_sss.so</pre>
</div>
</div>
<div class="paragraph">
<p>This configuration enables PAM, the pluggable authentication module, to use
<code>pam_sss.so</code> to determine authentication and access control when an
authentication request is issued for the <code>openshift</code> stack.</p>
</div>
</li>
<li>
<p>Edit the <strong><em>/etc/httpd/conf.modules.d/55-authnz_pam.conf</em></strong> file and uncomment
the following line:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">LoadModule authnz_pam_module modules/mod_authnz_pam.so</pre>
</div>
</div>
</li>
<li>
<p>To configure the Apache <strong><em>httpd.conf</em></strong> file for remote basic authentication,
create the <strong><em>openshift-remote-basic-auth.conf</em></strong> file in the
<strong><em>/etc/httpd/conf.d</em></strong> directory. Use the following template to provide your
required settings and values:</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Carefully review the template and customize its contents to fit your
environment.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">LoadModule request_module modules/mod_request.so
LoadModule php7_module modules/libphp7.so

# Nothing needs to be served over HTTP.  This virtual host simply redirects to
# HTTPS.
&lt;VirtualHost *:80&gt;
  DocumentRoot /var/www/html
  RewriteEngine              On
  RewriteRule     ^(.*)$     https://%{HTTP_HOST}$1 [R,L]
&lt;/VirtualHost&gt;

&lt;VirtualHost *:443&gt;
  # This needs to match the certificates you generated.  See the CN and X509v3
  # Subject Alternative Name in the output of:
  # openssl x509 -text -in /etc/pki/tls/certs/remote-basic.example.com.crt
  ServerName remote-basic.example.com

  DocumentRoot /var/www/html

  # Secure all connections with TLS
  SSLEngine on
  SSLCertificateFile /etc/pki/tls/certs/remote-basic.example.com.crt
  SSLCertificateKeyFile /etc/pki/tls/private/remote-basic.example.com.key
  SSLCACertificateFile /etc/pki/CA/certs/ca.crt

  # Require that TLS clients provide a valid certificate
  SSLVerifyClient require
  SSLVerifyDepth 10

  # Other SSL options that may be useful
  # SSLCertificateChainFile ...
  # SSLCARevocationFile ...

  # Send logs to a specific location to make them easier to find
  ErrorLog logs/remote_basic_error_log
  TransferLog logs/remote_basic_access_log
  LogLevel warn

  # PHP script that turns the Apache REMOTE_USER env var
  # into a JSON formatted response that OpenShift understands
  &lt;Location /check_user.php&gt;
    # all requests not using SSL are denied
    SSLRequireSSL
    # denies access when SSLRequireSSL is applied
    SSLOptions +StrictRequire
    # Require both a valid basic auth user (so REMOTE_USER is always set)
    # and that the CN of the TLS client matches that of the OpenShift master
    &lt;RequireAll&gt;
      Require valid-user
      Require expr %{SSL_CLIENT_S_DN_CN} == 'system:openshift-master'
    &lt;/RequireAll&gt;
    # Use basic auth since OpenShift will call this endpoint with a basic challenge
    AuthType Basic
    AuthName openshift
    AuthBasicProvider PAM
    AuthPAMService openshift

    # Store attributes in environment variables. Specify the email attribute that
    # you confirmed.
    LookupOutput Env
    LookupUserAttr mail REMOTE_USER_MAIL
    LookupUserGECOS REMOTE_USER_DISPLAY_NAME

    # Other options that might be useful

    # While REMOTE_USER is used as the sub field and serves as the immutable ID,
    # REMOTE_USER_PREFERRED_USERNAME could be used to have a different username
    # LookupUserAttr &lt;attr_name&gt; REMOTE_USER_PREFERRED_USERNAME

    # Group support may be added in a future release
    # LookupUserGroupsIter REMOTE_USER_GROUP
  &lt;/Location&gt;

  # Deny everything else
  &lt;Location ~ "^((?!\/check_user\.php).)*$"&gt;
      Deny from all
  &lt;/Location&gt;
&lt;/VirtualHost&gt;</pre>
</div>
</div>
</li>
<li>
<p>Create the <strong><em>check_user.php</em></strong> script in the <strong><em>/var/www/html</em></strong> directory.
Include the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;?php
// Get the user based on the Apache var, this should always be
// set because we 'Require valid-user' in the configuration
$user = apache_getenv('REMOTE_USER');

// However, we assume it may not be set and
// build an error response by default
$data = array(
    'error' =&gt; 'remote PAM authentication failed'
);

// Build a success response if we have a user
if (!empty($user)) {
    $data = array(
        'sub' =&gt; $user
    );
    // Map of optional environment variables to optional JSON fields
    $env_map = array(
        'REMOTE_USER_MAIL' =&gt; 'email',
        'REMOTE_USER_DISPLAY_NAME' =&gt; 'name',
        'REMOTE_USER_PREFERRED_USERNAME' =&gt; 'preferred_username'
    );

    // Add all non-empty environment variables to JSON data
    foreach ($env_map as $env_name =&gt; $json_name) {
        $env_data = apache_getenv($env_name);
        if (!empty($env_data)) {
            $data[$json_name] = $env_data;
        }
    }
}

// We always output JSON from this script
header('Content-Type: application/json', true);

// Write the response as JSON
echo json_encode($data);
?&gt;</pre>
</div>
</div>
</li>
<li>
<p>Enable Apache to load the module. Modify the
<strong><em>/etc/httpd/conf.modules.d/55-lookup_identity.conf</em></strong> file and uncomment the
following line:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">LoadModule lookup_identity_module modules/mod_lookup_identity.so</pre>
</div>
</div>
</li>
<li>
<p>Set an SELinux boolean so that SElinux allows Apache to connect to SSSD over
D-BUS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># setsebool -P httpd_dbus_sssd on</pre>
</div>
</div>
</li>
<li>
<p>Set a boolean to tell SELinux that it is acceptable for Apache to contact the
PAM subsystem:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># setsebool -P allow_httpd_mod_auth_pam on</pre>
</div>
</div>
</li>
<li>
<p>Start Apache:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start httpd.service</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sssd-for-ldap-configure-openshift-sssd-ldap-failover">Configuring OpenShift Enterprise to use SSSD as the basic remote authentication server</h3>
<div class="paragraph">
<p>Modify the default configuration of your cluster to use the new identity
provider that you created. Complete the following steps on the first master host
listed in the Ansible host inventory file.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the <strong><em>/etc/origin/master/master-config.yaml</em></strong> file.</p>
</li>
<li>
<p>Locate the <code>identityProviders</code> section and replace it with the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  identityProviders:
  - name: sssd
    challenge: true
    login: true
    mappingMethod: claim
    provider:
      apiVersion: v1
      kind: BasicAuthPasswordIdentityProvider
      url: https://remote-basic.example.com/check_user.php
      ca: /etc/origin/master/ca.crt
      certFile: /etc/origin/master/openshift-master.crt
      keyFile: /etc/origin/master/openshift-master.key</pre>
</div>
</div>
</li>
<li>
<p>Start OpenShift Enterprise with the updated configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openshift start \
    --public-master=https://openshift.example.com:8443 \
    --master-config=/etc/origin/master/master-config.yaml \
    --node-config=/etc/origin/node-node1.example.com/node-config.yaml</pre>
</div>
</div>
</li>
<li>
<p>Test a login by using the <code>oc</code> CLI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc login https://openshift.example.com:8443</pre>
</div>
</div>
<div class="paragraph">
<p>You can log in only with valid LDAP credentials.</p>
</div>
</li>
<li>
<p>List the identities and confirm that an email address is displayed for each
user name. Run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get identity -o yaml</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-the-user-agent">Configuring the user agent</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="user-agent-overview-configuring-user-agent">About the user agent</h3>
<div class="paragraph">
<p>OpenShift Enterprise implements a user agent that can be used to prevent an
application developer&#8217;s CLI accessing the OpenShift Enterprise API. If a client uses
a particular library or binary file, they cannot access the OpenShift Enterprise API.</p>
</div>
<div class="paragraph">
<p>You construct user agents for the OpenShift Enterprise CLI from a set of values
within OpenShift Enterprise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;command&gt;/&lt;version&gt; (&lt;platform&gt;/&lt;architecture&gt;) &lt;client&gt;/&lt;git_commit&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example, when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&lt;command&gt; = <code>oc</code></p>
</li>
<li>
<p>&lt;version&gt; = The client version. For example, <code>v4.1.0</code>. Requests made against the Kubernetes
API at <code>/api</code> receive the Kubernetes version, while requests made against the
OpenShift Enterprise API at <code>/oapi</code> receive the OpenShift Enterprise version (as specified
by <code>oc version</code>)</p>
</li>
<li>
<p>&lt;platform&gt; = <code>linux</code></p>
</li>
<li>
<p>&lt;architecture&gt; = <code>amd64</code></p>
</li>
<li>
<p>&lt;client&gt; = <code>openshift</code>, or <code>kubernetes</code> depending on if the request is made against the Kubernetes API at <code>/api</code>, or the OpenShift Enterprise API at <code>/oapi</code></p>
</li>
<li>
<p>&lt;git_commit&gt; = The Git commit of the client version (for example, <code>f034127</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>the user agent is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">oc/v3.3.0 (linux/amd64) openshift/f034127</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="user-agent-configuring-configuring-user-agent">Configuring the user agent</h3>
<div class="paragraph">
<p>As an OpenShift Enterprise administrator, you can prevent clients from accessing the
API with the <code>userAgentMatching</code> configuration setting of a master
configuration.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Modify the master configuration file to include the user agent configuration.
For example, the following user agent denies the Kubernetes 1.2 client binary,
OKD 1.1.3 binary, and the POST and PUT <code>httpVerbs</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">policyConfig:
  userAgentMatchingConfig:
    defaultRejectionMessage: "Your client is too old.  Go to https://example.org to update it."
    deniedClients:
    - regex: '\w+/v(?:(?:1\.1\.1)|(?:1\.0\.1)) \(.+/.+\) openshift/\w{7}'
    - regex: '\w+/v(?:1\.1\.3) \(.+/.+\) openshift/\w{7}'
      httpVerbs:
      - POST
      - PUT
    - regex: '\w+/v1\.2\.0 \(.+/.+\) kubernetes/\w{7}'
      httpVerbs:
      - POST
      - PUT
    requiredClients: null</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example denies clients that do not exactly match an expected
client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">policyConfig:
  userAgentMatchingConfig:
    defaultRejectionMessage: "Your client is too old.  Go to https://example.org to update it."
    deniedClients: []
    requiredClients:
    - regex: '\w+/v1\.1\.3 \(.+/.+\) openshift/\w{7}'
    - regex: '\w+/v1\.2\.0 \(.+/.+\) kubernetes/\w{7}'
      httpVerbs:
      - POST
      - PUT</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding-and-creating-service-accounts">Understanding and creating service accounts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="service-accounts-overview-understanding-service-accounts">Service accounts overview</h3>
<div class="paragraph">
<p>A service account is an OpenShift Enterprise account that allows a component to
directly access the API. Service accounts are API objects that exist within each project.
Service accounts provide a flexible way to control API
access without sharing a regular user&#8217;s credentials.</p>
</div>
<div class="paragraph">
<p>When you use the OpenShift Enterprise CLI or web console, your API token
authenticates you to the API. You can associate a component with a service account
so that they can access the API without using a regular user&#8217;s credentials.
For example, service accounts can allow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Replication controllers to make API calls to create or delete pods.</p>
</li>
<li>
<p>Applications inside containers to make API calls for discovery purposes.</p>
</li>
<li>
<p>External applications to make API calls for monitoring or integration purposes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each service account&#8217;s user name is derived from its project and name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">system:serviceaccount:&lt;project&gt;:&lt;name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Every service account is also a member of two groups:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">system:serviceaccounts</dt>
<dd>
<p>Includes all service accounts in the system.</p>
</dd>
<dt class="hdlist1">system:serviceaccounts:&lt;project&gt;</dt>
<dd>
<p>Includes all service accounts in the
specified project.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Each service account automatically contains two secrets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An API token</p>
</li>
<li>
<p>Credentials for the OpenShift Container Registry</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The generated API token and registry credentials do not expire, but you can
revoke them by deleting the secret. When you delete the secret, a new one is
automatically generated to take its place.</p>
</div>
</div>
<div class="sect2">
<h3 id="service-accounts-enabling-authentication-understanding-service-accounts">Enabling service account authentication</h3>
<div class="paragraph">
<p>Service accounts authenticate to the API using tokens signed by a private RSA
key. The authentication layer verifies the signature using a matching public RSA
key.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To enable service account token generation, update the <code><strong>serviceAccountConfig</strong></code>
stanza in the <strong><em>/etc/origin/master/master-config.yml</em></strong> file on the master to
specify a <code><strong>privateKeyFile</strong></code> (for signing), and a matching public key file in
the <code><strong>publicKeyFiles</strong></code> list:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">serviceAccountConfig:
  ...
  masterCA: ca.crt <b class="conum">(1)</b>
  privateKeyFile: serviceaccounts.private.key <b class="conum">(2)</b>
  publicKeyFiles:
  - serviceaccounts.public.key <b class="conum">(3)</b>
  - ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>CA file to validate the API server&#8217;s serving certificate.</p>
</li>
<li>
<p>Private RSA key file for token signing.</p>
</li>
<li>
<p>Public RSA key files for token verification. If you provide private key
files, then the public key component is used. You can specify multiple public
key files, and a token is accepted if it can be validated by one of the
public keys. This allows rotation of the signing key while still accepting
tokens generated by the previous signer.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="service-accounts-managing-understanding-service-accounts">Creating service accounts</h3>
<div class="paragraph">
<p>You can create a service account in a project and grant it permissions by
binding it to a role.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>(Optional) To view the service accounts in the current project:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get sa

NAME       SECRETS   AGE
builder    2         2d
default    2         2d
deployer   2         2d</pre>
</div>
</div>
</li>
<li>
<p>To create a new service account in the current project:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create sa &lt;service_account_name&gt; <b class="conum">(1)</b>

serviceaccount "robot" created</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>To create a service account in a different project, specify <code>-n &lt;project_name&gt;</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>(Optional) View the secrets for the service account:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe sa robot
Name:		robot
Namespace:	project1
Labels:		&lt;none&gt;
Annotations:	&lt;none&gt;

Image pull secrets:	robot-dockercfg-qzbhb

Mountable secrets: 	robot-token-f4khf
                   	robot-dockercfg-qzbhb

Tokens:            	robot-token-f4khf
                   	robot-token-z8h44</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="service-accounts-configuration-parameters-understanding-service-accounts">Service account configuration parameters</h3>
<div class="paragraph">
<p>You can provide values for the following service account parameters in the
<strong><em>/etc/origin/master/master-config.yml</em></strong> file on the master host.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Service account configuration parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>LimitSecretReferences</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Boolean</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Controls whether or not to allow a service account to reference any secret in a
namespace without explicitly referencing them.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>ManagedNames</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>String</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A list of service account names that is automatically created in each namespace.
If no names are specified, the <code>ServiceAccountsController</code> service does not
start.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>MasterCA</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>String</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The CA that verifies the TLS connection back to the master. The service account
controller automatically injects the contents of this file into pods so they
can verify connections to the master.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>PrivateKeyFile</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>String</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A file that contains a PEM-encoded private RSA key, which is used to sign
service account tokens. If no private key is specified, the service account
<code>TokensController</code> service does not start.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>PublicKeyFiles</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>String</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A list of files, each of which contains a PEM-encoded public RSA key. If any file
contains a private key, the public portion of the key is used. The list of
public keys is used to verify presented service account tokens. Each key is
tried in order until the list is exhausted or verification succeeds. If no keys
are specified, no service account authentication is available.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>ServiceAccountConfig</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The parameter that contains the other listed service account parameters.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="service-accounts-granting-roles-understanding-service-accounts">Examples of granting roles to service accounts</h3>
<div class="paragraph">
<p>You can grant roles to service accounts in the same way that you grant roles
to a regular user account.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can modify the service accounts for the current project. For example, to add
the <code>view</code> role to the <code>robot</code> service account in the <code>top-secret</code> project:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc policy add-role-to-user view system:serviceaccount:top-secret:robot</pre>
</div>
</div>
</li>
<li>
<p>You can also grant access to a specific service account in a project. For
example, from the project to which the service account belongs, use
the <code>-z</code> flag and specify the <code>&lt;serviceaccount_name&gt;</code></p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc policy add-role-to-user &lt;role_name&gt; -z &lt;serviceaccount_name&gt;</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to grant access to a specific service account in a project, use the
<code>-z</code> flag. Using this flag helps prevent typos and ensures that access
is granted to only the specified service account.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>To modify a different namespace, you can use the <code>-n</code> option to indicate the
project namespace it applies to, as shown in the following examples.</p>
<div class="ulist">
<ul>
<li>
<p>For example, to allow all service accounts in all projects to view resources in
the <code>top-secret</code> project:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc policy add-role-to-group view system:serviceaccounts -n top-secret</pre>
</div>
</div>
</li>
<li>
<p>To allow all service accounts in the <code>managers</code> project to edit resources in the
<code>top-secret</code> project:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc policy add-role-to-group edit system:serviceaccounts:managers -n top-secret</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-service-accounts-in-applications">Using service accounts in applications</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="service-accounts-overview-using-service-accounts">Service accounts overview</h3>
<div class="paragraph">
<p>A service account is an OpenShift Enterprise account that allows a component to
directly access the API. Service accounts are API objects that exist within each project.
Service accounts provide a flexible way to control API
access without sharing a regular user&#8217;s credentials.</p>
</div>
<div class="paragraph">
<p>When you use the OpenShift Enterprise CLI or web console, your API token
authenticates you to the API. You can associate a component with a service account
so that they can access the API without using a regular user&#8217;s credentials.
For example, service accounts can allow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Replication controllers to make API calls to create or delete pods.</p>
</li>
<li>
<p>Applications inside containers to make API calls for discovery purposes.</p>
</li>
<li>
<p>External applications to make API calls for monitoring or integration purposes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each service account&#8217;s user name is derived from its project and name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">system:serviceaccount:&lt;project&gt;:&lt;name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Every service account is also a member of two groups:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">system:serviceaccounts</dt>
<dd>
<p>Includes all service accounts in the system.</p>
</dd>
<dt class="hdlist1">system:serviceaccounts:&lt;project&gt;</dt>
<dd>
<p>Includes all service accounts in the
specified project.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Each service account automatically contains two secrets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An API token</p>
</li>
<li>
<p>Credentials for the OpenShift Container Registry</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The generated API token and registry credentials do not expire, but you can
revoke them by deleting the secret. When you delete the secret, a new one is
automatically generated to take its place.</p>
</div>
</div>
<div class="sect2">
<h3 id="service-accounts-default-using-service-accounts">Default service accounts</h3>
<div class="paragraph">
<p>Your OpenShift Enterprise cluster contains default service accounts for
cluster management and generates more service accounts for each project.</p>
</div>
<div class="sect3">
<h4 id="default-cluster-service-accountsusing-service-accounts">Default cluster service accounts</h4>
<div class="paragraph">
<p>Several infrastructure controllers run using service account credentials. The
following service accounts are created in the OpenShift Enterprise infrastructure
project (<code>openshift-infra</code>) at server start, and given the following roles
cluster-wide:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service Account</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>replication-controller</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assigned the <code>system:replication-controller</code> role</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deployment-controller</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assigned the <code>system:deployment-controller</code> role</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>build-controller</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assigned the <code>system:build-controller</code> role. Additionally, the
<code>build-controller</code> service account is included in the privileged
Security Context Constraint in order to create privileged
build pods.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="default-service-accounts-and-roles-using-service-accounts">Default project service accounts and roles</h4>
<div class="paragraph">
<p>Three service accounts are automatically created in each project:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service Account</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>builder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used by build pods. It is given the <code>system:image-builder</code> role, which allows
pushing images to any imagestream in the project using the internal Docker
registry.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deployer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used by deployment pods and given the <code>system:deployer</code> role, which allows
viewing and modifying replication controllers and pods in the project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to run all other pods unless they specify a different service account.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All service accounts in a project are given the <code>system:image-puller</code> role,
which allows pulling images from any imagestream in the project using the
internal container image registry.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="service-accounts-managing-using-service-accounts">Creating service accounts</h3>
<div class="paragraph">
<p>You can create a service account in a project and grant it permissions by
binding it to a role.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>(Optional) To view the service accounts in the current project:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get sa

NAME       SECRETS   AGE
builder    2         2d
default    2         2d
deployer   2         2d</pre>
</div>
</div>
</li>
<li>
<p>To create a new service account in the current project:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create sa &lt;service_account_name&gt; <b class="conum">(1)</b>

serviceaccount "robot" created</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>To create a service account in a different project, specify <code>-n &lt;project_name&gt;</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>(Optional) View the secrets for the service account:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe sa robot
Name:		robot
Namespace:	project1
Labels:		&lt;none&gt;
Annotations:	&lt;none&gt;

Image pull secrets:	robot-dockercfg-qzbhb

Mountable secrets: 	robot-token-f4khf
                   	robot-dockercfg-qzbhb

Tokens:            	robot-token-f4khf
                   	robot-token-z8h44</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="service-accounts-using-credentials-inside-a-container-using-service-accounts">Using a service account&#8217;s credentials inside a container</h3>
<div class="paragraph">
<p>When a pod is created, it specifies a service account (or uses the default
service account), and is allowed to use that service account&#8217;s API credentials
and referenced secrets.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>View the API token for the pod&#8217;s service account in the
<strong><em>/var/run/secrets/kubernetes.io/serviceaccount/token</em></strong> file.</p>
</li>
<li>
<p>Set the token value to the <code>Token</code> variable:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ TOKEN="$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)"</pre>
</div>
</div>
</li>
<li>
<p>Use the token to make API calls as the pod&#8217;s service account. For example,
call the <code>users/~</code> API to get information about the user identified
by the token:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ curl --cacert /var/run/secrets/kubernetes.io/serviceaccount/ca.crt \
    "https://openshift.default.svc.cluster.local/oapi/v1/users/~" \
    -H "Authorization: Bearer $TOKEN"

kind: "User"
apiVersion: "user.openshift.io/v1"
metadata:
  name: "system:serviceaccount:top-secret:robot"
  selflink: "/oapi/v1/users/system:serviceaccount:top-secret:robot"
  creationTimestamp: null
identities: null
groups:
  - "system:serviceaccounts"
  - "system:serviceaccounts:top-secret"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="service-accounts-using-credentials-externally-using-service-accounts">Using a service account&#8217;s credentials externally</h3>
<div class="paragraph">
<p>You can distribute a service account&#8217;s token to external applications that need to
authenticate to the API.</p>
</div>
<div class="paragraph">
<p>In order to pull an image, the authenticated user must have <code>get</code> rights on the
requested <code>imagestreams/layers</code>. In order to push an image, the authenticated
user must have <code>update</code> rights on the requested <code>imagestreams/layers</code>.</p>
</div>
<div class="paragraph">
<p>By default, all service accounts in a project have rights to pull any image in
the same project, and the <strong>builder</strong> service account has rights to push any image
in the same project.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>View the service account&#8217;s API token:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe secret &lt;secret-name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe secret robot-token-uzkbh -n top-secret

Name:		robot-token-uzkbh
Labels:		&lt;none&gt;
Annotations:	kubernetes.io/service-account.name=robot,kubernetes.io/service-account.uid=49f19e2e-16c6-11e5-afdc-3c970e4b7ffe

Type:	kubernetes.io/service-account-token

Data

token:	eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...</pre>
</div>
</div>
</li>
<li>
<p>Log in using the token that you obtained:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc login --token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...

Logged into "https://server:8443" as "system:serviceaccount:top-secret:robot" using the token provided.

You don't have any projects. You can try to create a new project, by running

    $ oc new-project &lt;projectname&gt;</pre>
</div>
</div>
</li>
<li>
<p>Confirm that you logged in as the service account:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc whoami

system:serviceaccount:top-secret:robot</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-a-service-account-as-an-oauth-client">Using a service account as an OAuth client</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="service-accounts-as-oauth-clients-using-service-accounts-as-oauth-client">Service accounts as OAuth clients</h3>
<div class="paragraph">
<p>You can use a service account as a constrained form of OAuth client.
Service accounts can request only a subset of scopes that
allow access to some basic user information
and role-based power inside of the service account&#8217;s own namespace:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>user:info</code></p>
</li>
<li>
<p><code>user:check-access</code></p>
</li>
<li>
<p><code>role:&lt;any_role&gt;:&lt;serviceaccount_namespace&gt;</code></p>
</li>
<li>
<p><code>role:&lt;any_role&gt;:&lt;serviceaccount_namespace&gt;:!</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using a service account as an OAuth client:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>client_id</code> is <code>system:serviceaccount:&lt;serviceaccount_namespace&gt;:&lt;serviceaccount_name&gt;</code>.</p>
</li>
<li>
<p><code>client_secret</code> can be any of the API tokens for that service account. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc sa get-token &lt;serviceaccount_name&gt;</pre>
</div>
</div>
</li>
<li>
<p>To get <code>WWW-Authenticate</code> challenges, set an
<code>serviceaccounts.openshift.io/oauth-want-challenges</code> annotation on the service
account to <code>true</code>.</p>
</li>
<li>
<p><code>redirect_uri</code> must match an annotation on the service account.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="redirect-uris-for-service-accounts-using-service-accounts-as-oauth-client">Redirect URIs for Service Accounts as OAuth Clients</h4>
<div class="paragraph">
<p>Annotation keys must have the prefix
<code>serviceaccounts.openshift.io/oauth-redirecturi.</code> or
<code>serviceaccounts.openshift.io/oauth-redirectreference.</code> such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">serviceaccounts.openshift.io/oauth-redirecturi.&lt;name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In its simplest form, the annotation can be used to directly specify valid
redirect URIs. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">"serviceaccounts.openshift.io/oauth-redirecturi.first":  "https://example.com"
"serviceaccounts.openshift.io/oauth-redirecturi.second": "https://other.com"</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>first</code> and <code>second</code> postfixes in the above example are used to separate the
two valid redirect URIs.</p>
</div>
<div class="paragraph">
<p>In more complex configurations, static redirect URIs may not be enough. For
example, perhaps you want all ingresses for a route to be considered valid. This
is where dynamic redirect URIs via the
<code>serviceaccounts.openshift.io/oauth-redirectreference.</code> prefix come into play.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">"serviceaccounts.openshift.io/oauth-redirectreference.first": "{\"kind\":\"OAuthRedirectReference\",\"apiVersion\":\"v1\",\"reference\":{\"kind\":\"Route\",\"name\":\"jenkins\"}}"</pre>
</div>
</div>
<div class="paragraph">
<p>Since the value for this annotation contains serialized JSON data, it is easier
to see in an expanded format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{
  "kind": "OAuthRedirectReference",
  "apiVersion": "v1",
  "reference": {
    "kind": "Route",
    "name": "jenkins"
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Now you can see that an <code>OAuthRedirectReference</code> allows us to reference the
route named <code>jenkins</code>. Thus, all ingresses for that route will now be considered
valid.  The full specification for an <code>OAuthRedirectReference</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{
  "kind": "OAuthRedirectReference",
  "apiVersion": "v1",
  "reference": {
    "kind": ..., <b class="conum">(1)</b>
    "name": ..., <b class="conum">(2)</b>
    "group": ... <b class="conum">(3)</b>
  }
}</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>kind</code> refers to the type of the object being referenced. Currently, only <code>route</code> is supported.</p>
</li>
<li>
<p><code>name</code> refers to the name of the object. The object must be in the same namespace as the service account.</p>
</li>
<li>
<p><code>group</code> refers to the group of the object. Leave this blank, as the group for a route is the empty string.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Both annotation prefixes can be combined to override the data provided by the
reference object. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">"serviceaccounts.openshift.io/oauth-redirecturi.first":  "custompath"
"serviceaccounts.openshift.io/oauth-redirectreference.first": "{\"kind\":\"OAuthRedirectReference\",\"apiVersion\":\"v1\",\"reference\":{\"kind\":\"Route\",\"name\":\"jenkins\"}}"</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>first</code> postfix is used to tie the annotations together. Assuming that the
<code>jenkins</code> route had an ingress of <strong><em>https://example.com</em></strong>, now
<strong><em>https://example.com/custompath</em></strong> is considered valid, but
<strong><em>https://example.com</em></strong> is not.  The format for partially supplying override
data is as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Scheme</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>"https://"</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Hostname</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>"//website.com"</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Port</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>"//:8000"</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Path</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>"examplepath"</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Specifying a host name override will replace the host name data from the
referenced object, which is not likely to be desired behavior.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Any combination of the above syntax can be combined using the following format:</p>
</div>
<div class="paragraph">
<p><code>&lt;scheme:&gt;//&lt;hostname&gt;&lt;:port&gt;/&lt;path&gt;</code></p>
</div>
<div class="paragraph">
<p>The same object can be referenced more than once for more flexibility:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">"serviceaccounts.openshift.io/oauth-redirecturi.first":  "custompath"
"serviceaccounts.openshift.io/oauth-redirectreference.first": "{\"kind\":\"OAuthRedirectReference\",\"apiVersion\":\"v1\",\"reference\":{\"kind\":\"Route\",\"name\":\"jenkins\"}}"
"serviceaccounts.openshift.io/oauth-redirecturi.second":  "//:8000"
"serviceaccounts.openshift.io/oauth-redirectreference.second": "{\"kind\":\"OAuthRedirectReference\",\"apiVersion\":\"v1\",\"reference\":{\"kind\":\"Route\",\"name\":\"jenkins\"}}"</pre>
</div>
</div>
<div class="paragraph">
<p>Assuming that the route named <code>jenkins</code> has an ingress of
<strong><em>https://example.com</em></strong>, then both <strong><em>https://example.com:8000</em></strong> and
<strong><em>https://example.com/custompath</em></strong> are considered valid.</p>
</div>
<div class="paragraph">
<p>Static and dynamic annotations can be used at the same time to achieve the
desired behavior:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">"serviceaccounts.openshift.io/oauth-redirectreference.first": "{\"kind\":\"OAuthRedirectReference\",\"apiVersion\":\"v1\",\"reference\":{\"kind\":\"Route\",\"name\":\"jenkins\"}}"
"serviceaccounts.openshift.io/oauth-redirecturi.second": "https://other.com"</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scoping-tokens">Scoping tokens</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="tokens-scoping-about-configuring-internal-oauth">About scoping tokens</h3>
<div class="paragraph">
<p>You can created scoped tokens to delegate some of your permissions to another
user or service account.
For example, a project administrator might want to delegate the
power to create pods.</p>
</div>
<div class="paragraph">
<p>A scoped token is a token that identifies as a given user but is limited to
certain actions by its scope. Only a user with the <code>cluster-admin</code> role can create
scoped tokens.</p>
</div>
<div class="paragraph">
<p>Scopes are evaluated by converting the set of scopes for a token into a set of
<code>PolicyRules</code>. Then, the request is matched against those rules. The request
attributes must match at least one of the scope rules to be passed to the
"normal" authorizer for further authorization checks.</p>
</div>
<div class="sect3">
<h4 id="scoping-tokens-user-scopes-configuring-internal-oauth">User scopes</h4>
<div class="paragraph">
<p>User scopes are focused on getting information about a given user. They are
intent-based, so the rules are automatically created for you:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>user:full</code> - Allows full read/write access to the API with all of the user&#8217;s permissions.</p>
</li>
<li>
<p><code>user:info</code> - Allows read-only access to information about the user, such as name and groups.</p>
</li>
<li>
<p><code>user:check-access</code> - Allows access to <code>self-localsubjectaccessreviews</code> and <code>self-subjectaccessreviews</code>.
These are the variables where you pass an empty user and groups in your request object.</p>
</li>
<li>
<p><code>user:list-projects</code> - Allows read-only access to list the projects the user has access to.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="scoping-tokens-role-scope-configuring-internal-oauth">Role scope</h4>
<div class="paragraph">
<p>The role scope allows you to have the same level of access as a given role
filtered by namespace.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>role:&lt;cluster-role name&gt;:&lt;namespace or * for all&gt;</code> - Limits the scope to the
rules specified by the cluster-role, but only in the specified namespace .</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Caveat: This prevents escalating access. Even if the role allows access to
resources like secrets, rolebindings, and roles, this scope will deny access
to those resources. This helps prevent unexpected escalations. Many people do
not think of a role like <code>edit</code> as being an escalating role, but with access to
a secret it is.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>role:&lt;cluster-role name&gt;:&lt;namespace or * for all&gt;:!</code> -  This is similar to the
example above, except that including the bang causes this scope to allow
escalating access.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="managing-security-context-constraints">Managing Security Context Constraints</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="security-context-constraints-about-configuring-internal-oauth">About Security Context Constraints</h3>
<div class="paragraph">
<p>Similar to the way that RBAC resources control user access, administrators can
use <em>Security Context Constraints</em> (SCCs) to control permissions for pods. These
permissions include actions that a <em>pod</em>, a collection of containers, can
perform and what resources it can access. You can use SCCs to define a set of
conditions that a pod must run with in order to be accepted into the system.</p>
</div>
<div class="paragraph">
<p>SCCs allow an administrator to control:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Whether a pod can run rivileged containers.</p>
</li>
<li>
<p>The capabilities that a container can request.</p>
</li>
<li>
<p>The use of host directories as volumes.</p>
</li>
<li>
<p>The SELinux context of the container.</p>
</li>
<li>
<p>The container user ID.</p>
</li>
<li>
<p>The use of host namespaces and networking.</p>
</li>
<li>
<p>The allocation of an <code>FSGroup</code> that owns the pod&#8217;s volumes.</p>
</li>
<li>
<p>The configuration of allowable supplemental groups.</p>
</li>
<li>
<p>Whether a container requires the use of a read only root file system.</p>
</li>
<li>
<p>The usage of volume types.</p>
</li>
<li>
<p>The configuration of allowable <code>seccomp</code> profiles.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Docker has a
<a href="https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities">default list of capabilities</a>
that are allowed for each container of a pod. The
containers use the capabilities from this default list, but pod manifest authors
can alter it by requesting additional capabilities or removing some of the
default behaviors. Use the <code>allowedCapabilities</code>, <code>defaultAddCapabilities</code>, and
<code>requiredDropCapabilities</code> parameters to control such requests from the
pods and to dictate which capabilities can be requested, which ones must be
added to each container, and which ones must be forbidden.</p>
</div>
<div class="paragraph">
<p>The cluster contains eight default SCCs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>anyuid</code></p>
</li>
<li>
<p><code>hostaccess</code></p>
</li>
<li>
<p><code>hostmount-anyuid</code></p>
</li>
<li>
<p><code>hostnetwork</code></p>
</li>
<li>
<p><code>node-exporter</code></p>
</li>
<li>
<p><code>nonroot</code></p>
</li>
<li>
<p><code>privileged</code></p>
</li>
<li>
<p><code>restricted</code></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Do not modify the default SCCs. Customizing the default SCCs can lead to issues
when OpenShift Enterprise is upgraded.
Instead, create new SCCs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>privileged</code> SCC allows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Users to run privileged pods</p>
</li>
<li>
<p>Pods to mount host directories as volumes</p>
</li>
<li>
<p>Pods to run as any user</p>
</li>
<li>
<p>Pods to run with any MCS label</p>
</li>
<li>
<p>Pods to use the host&#8217;s IPC namespace</p>
</li>
<li>
<p>Pods to use the host&#8217;s PID namespace</p>
</li>
<li>
<p>Pods to use any FSGroup</p>
</li>
<li>
<p>Pods to use any supplemental group</p>
</li>
<li>
<p>Pods to use any seccomp profiles</p>
</li>
<li>
<p>Pods to request any capabilities</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>restricted</code> SCC:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensures that pods cannot run as privileged.</p>
</li>
<li>
<p>Ensures that pods cannot mount host directory volumes.</p>
</li>
<li>
<p>Requires that a pod run as a user in a pre-allocated range of UIDs.</p>
</li>
<li>
<p>Requires that a pod run with a pre-allocated MCS label.</p>
</li>
<li>
<p>Allows pods to use any FSGroup.</p>
</li>
<li>
<p>Allows pods to use any supplemental group.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>For more information about each SCC, see the <code>kubernetes.io/description</code>
annotation available on the SCC.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>SCCs are comprised of settings and strategies that control the security features
a pod has access to. These settings fall into three categories:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Controlled by a boolean</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fields of this type default to the most restrictive value. For example,
<code>AllowPrivilegedContainer</code> is always set to <code>false</code> if unspecified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Controlled by an allowable set</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fields of this type are checked against the set to ensure their value is
allowed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Controlled by a strategy</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Items that have a strategy to generate a value provide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A mechanism to generate the value, and</p>
</li>
<li>
<p>A mechanism to ensure that a specified value falls into the set of allowable
values.</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="authorization-SCC-strategies-configuring-internal-oauth">SCC Strategies</h4>
<div class="olist arabic">
<div class="title">RunAsUser</div>
<ol class="arabic">
<li>
<p><code>MustRunAs</code> - Requires a <code>runAsUser</code> to be configured. Uses the configured
<code>runAsUser</code> as the default. Validates against the configured <code>runAsUser</code>.</p>
</li>
<li>
<p><code>MustRunAsRange</code> - Requires minimum and maximum values to be defined if not
using pre-allocated values. Uses the minimum as the default. Validates against
the entire allowable range.</p>
</li>
<li>
<p><code>MustRunAsNonRoot</code> - Requires that the pod be submitted with a non-zero
<code>runAsUser</code> or have the <code>USER</code> directive defined in the image. No default
provided.</p>
</li>
<li>
<p><code>RunAsAny</code> - No default provided. Allows any <code>runAsUser</code> to be specified.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">SELinuxContext</div>
<ol class="arabic">
<li>
<p><code>MustRunAs</code> - Requires <code>seLinuxOptions</code> to be configured if not using
pre-allocated values. Uses <code>seLinuxOptions</code> as the default. Validates against
<code>seLinuxOptions</code>.</p>
</li>
<li>
<p><code>RunAsAny</code> - No default provided. Allows any <code>seLinuxOptions</code> to be
specified.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">SupplementalGroups</div>
<ol class="arabic">
<li>
<p><code>MustRunAs</code> - Requires at least one range to be specified if not using
pre-allocated values. Uses the minimum value of the first range as the default.
Validates against all ranges.</p>
</li>
<li>
<p><code>RunAsAny</code> - No default provided. Allows any <code>supplementalGroups</code> to be
specified.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">FSGroup</div>
<ol class="arabic">
<li>
<p><code>MustRunAs</code> - Requires at least one range to be specified if not using
pre-allocated values. Uses the minimum value of the first range as the default.
Validates against the first ID in the first range.</p>
</li>
<li>
<p><code>RunAsAny</code> - No default provided. Allows any <code>fsGroup</code> ID to be specified.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="authorization-controlling-volumes-configuring-internal-oauth">Controlling volumes</h4>
<div class="paragraph">
<p>The usage of specific volume types can be controlled by setting the <code>volumes</code>
field of the SCC. The allowable values of this field correspond to the volume
sources that are defined when creating a volume:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#azurefilevolume"><code>azureFile</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#azurediskvolume"><code>azureDisk</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#flocker"><code>flocker</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#flexvolume"><code>flexVolume</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#hostpath"><code>hostPath</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#emptydir"><code>emptyDir</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#gcepersistentdisk"><code>gcePersistentDisk</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#awselasticblockstore"><code>awsElasticBlockStore</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#gitrepo"><code>gitRepo</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#secret"><code>secret</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#nfs"><code>nfs</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#iscsi"><code>iscsi</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#glusterfs"><code>glusterfs</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#persistentvolumeclaim"><code>persistentVolumeClaim</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#rbd"><code>rbd</code></a></p>
</li>
<li>
<p><code>cinder</code></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#cephfs"><code>cephFS</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#downwardapi"><code>downwardAPI</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#fc-fibre-channel"><code>fc</code></a></p>
</li>
<li>
<p><code>configMap</code></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#vspherevolume"><code>vsphereVolume</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#quobyte"><code>quobyte</code></a></p>
</li>
<li>
<p><code>photonPersistentDisk</code></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#projected"><code>projected</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#portworxvolume"><code>portworxVolume</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#scaleio"><code>scaleIO</code></a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#storageos"><code>storageos</code></a></p>
</li>
<li>
<p><strong>*</strong> (a special value to allow the use of all volume types)</p>
</li>
<li>
<p><code>none</code> (a special value to disallow the use of all volumes types. Exist only for backwards compatibility)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The recommended minimum set of allowed volumes for new SCCs are <code>configMap</code>,
<code>downwardAPI</code>, <code>emptyDir</code>, <code>persistentVolumeClaim</code>, <code>secret</code>, and <code>projected</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The list of allowable volume types is not exhaustive because new types are
added with each release of OpenShift Enterprise.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>For backwards compatibility, the usage of <code>allowHostDirVolumePlugin</code> overrides
settings in the <code>volumes</code> field. For example, if <code>allowHostDirVolumePlugin</code>
is set to false but allowed in the <code>volumes</code> field, then the <code>hostPath</code>
value will be removed from <code>volumes</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="admission-configuring-internal-oauth">Admission</h4>
<div class="paragraph">
<p><em>Admission control</em> with SCCs allows for control over the creation of resources
based on the capabilities granted to a user.</p>
</div>
<div class="paragraph">
<p>In terms of the SCCs, this means that an admission controller can inspect the
user information made available in the context to retrieve an appropriate set of
SCCs. Doing so ensures the pod is authorized to make requests about its
operating environment or to generate a set of constraints to apply to the pod.</p>
</div>
<div class="paragraph">
<p>The set of SCCs that admission uses to authorize a pod are determined by the
user identity and groups that the user belongs to. Additionally, if the pod
specifies a service account, the set of allowable SCCs includes any constraints
accessible to the service account.</p>
</div>
<div class="paragraph">
<p>Admission uses the following approach to create the final security context for
the pod:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Retrieve all SCCs available for use.</p>
</li>
<li>
<p>Generate field values for security context settings that were not specified
on the request.</p>
</li>
<li>
<p>Validate the final settings against the available constraints.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If a matching set of constraints is found, then the pod is accepted. If the
request cannot be matched to an SCC, the pod is rejected.</p>
</div>
<div class="paragraph">
<p>A pod must validate every field against the SCC. The following are examples for
just two of the fields that must be validated:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>These examples are in the context of a strategy using the preallocated values.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>A FSGroup SCC strategy of <code>MustRunAs</code></strong></p>
</div>
<div class="paragraph">
<p>If the pod defines a <code>fsGroup</code> ID, then that ID must equal the default
<code>fsGroup</code> ID. Otherwise, the pod is not validated by that SCC and the next SCC
is evaluated.</p>
</div>
<div class="paragraph">
<p>If the <code>SecurityContextConstraints.fsGroup</code> field has value <code>RunAsAny</code>
and the pod specification omits the <code>Pod.spec.securityContext.fsGroup</code>,
then this field is considered valid. Note that it is possible that during
validation, other SCC settings will reject other pod fields and thus cause the
pod to fail.</p>
</div>
<div class="paragraph">
<p><strong>A <code>SupplementalGroups</code> SCC strategy of <code>MustRunAs</code></strong></p>
</div>
<div class="paragraph">
<p>If the pod specification defines one or more <code>supplementalGroups</code> IDs, then
the pod&#8217;s IDs must equal one of the IDs in the namespace&#8217;s
<code>openshift.io/sa.scc.supplemental-groups</code> annotation. Otherwise, the pod is not
validated by that SCC and the next SCC is evaluated.</p>
</div>
<div class="paragraph">
<p>If the <code>SecurityContextConstraints.supplementalGroups</code> field has value <code>RunAsAny</code>
and the pod specification omits the <code>Pod.spec.securityContext.supplementalGroups</code>,
then this field is considered valid. Note that it is possible that during
validation, other SCC settings will reject other pod fields and thus cause the
pod to fail.</p>
</div>
</div>
<div class="sect3">
<h4 id="scc-prioritization-configuring-internal-oauth">SCC prioritization</h4>
<div class="paragraph">
<p>SCCs have a priority field that affects the ordering when attempting to
validate a request by the admission controller. A higher priority
SCC is moved to the front of the set when sorting. When the complete set
of available SCCs are determined they are ordered by:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Highest priority first, nil is considered a 0 priority</p>
</li>
<li>
<p>If priorities are equal, the SCCs will be sorted from most restrictive to least restrictive</p>
</li>
<li>
<p>If both priorities and restrictions are equal the SCCs will be sorted by name</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>By default, the <code>anyuid</code> SCC granted to cluster administrators is given priority
in their SCC set. This allows cluster administrators to run pods as any
user by without specifying a <code>RunAsUser</code> on the pod&#8217;s <code>SecurityContext</code>. The
administrator may still specify a <code>RunAsUser</code> if they wish.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security-context-constraints-pre-allocated-values-configuring-internal-oauth">About pre-allocated Security Context Constraints values</h3>
<div class="paragraph">
<p>The admission controller is aware of certain conditions in the Security Context
Constraints (SCCs) that trigger it to look up pre-allocated values from a namespace and
populate the SCC before processing the pod. Each SCC
strategy is evaluated independently of other strategies, with the pre-allocated
values, where allowed, for each policy aggregated with pod specification values
to make the final values for the various IDs defined in the running pod.</p>
</div>
<div class="paragraph">
<p>The following SCCs cause the admission controller to look for pre-allocated
values when no ranges are defined in the pod specification:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A <code>RunAsUser</code> strategy of <code>MustRunAsRange</code> with no minimum or maximum set.
Admission looks for the <code>openshift.io/sa.scc.uid-range</code> annotation to populate
range fields.</p>
</li>
<li>
<p>An <code>SELinuxContext</code> strategy of <code>MustRunAs</code> with no level set. Admission
looks for the <code>openshift.io/sa.scc.mcs</code> annotation to populate the level.</p>
</li>
<li>
<p>A <code>FSGroup</code> strategy of <code>MustRunAs</code>. Admission looks for the
<code>openshift.io/sa.scc.supplemental-groups</code> annotation.</p>
</li>
<li>
<p>A <code>SupplementalGroups</code> strategy of <code>MustRunAs</code>. Admission looks for the
<code>openshift.io/sa.scc.supplemental-groups</code> annotation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>During the generation phase, the security context provider uses default values
for any parameter values that are not specifically set in the pod. Default values
are based on the selected strategy:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>RunAsAny</code> and <code>MustRunAsNonRoot</code> strategies do not provide default
values. If the pod needs a parameter value, such as a group ID, you
must define the value in the pod specification.</p>
</li>
<li>
<p><code>MustRunAs</code> (single value) strategies provide a default value that is
always used. For example, for group IDs, even if the pod specification defines
its own ID value, the namespace&#8217;s default parameter value also appears in the pod&#8217;s
groups.</p>
</li>
<li>
<p><code>MustRunAsRange</code> and <code>MustRunAs</code> (range-based) strategies provide the
minimum value of the range. As with a single value <code>MustRunAs</code> strategy, the
namespace&#8217;s default parameter value appears in the running pod. If a range-based
strategy is configurable with multiple ranges, it provides the minimum value
of the first configured range.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><code>FSGroup</code> and <code>SupplementalGroups</code> strategies fall back to the
<code>openshift.io/sa.scc.uid-range</code> annotation if the
<code>openshift.io/sa.scc.supplemental-groups</code> annotation does not exist on the
namespace. If neither exists, the SCC is not created.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, the annotation-based <code>FSGroup</code> strategy configures itself with a
single range based on the minimum value for the annotation. For example, if your
annotation reads <code>1/3</code>, the <code>FSGroup</code> strategy configures itself with a
minimum and maximum value of <code>1</code>. If you want to allow more groups to be accepted for
the <code>FSGroup</code> field, you can configure a custom SCC that does not use the
annotation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>openshift.io/sa.scc.supplemental-groups</code> annotation accepts a comma-delimited
list of blocks in the format of <code>&lt;start&gt;/&lt;length</code> or <code>&lt;start&gt;-&lt;end&gt;</code>.
The <code>openshift.io/sa.scc.uid-range</code> annotation accepts only a single block.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="security-context-constraints-example-configuring-internal-oauth">Example Security Context Constraints</h3>
<div class="paragraph">
<p>The following examples show the Security Context Constraint (SCC) format and
annotations:</p>
</div>
<div class="listingblock">
<div class="title">Annotated <code>priviledged</code> SCC</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">allowHostDirVolumePlugin: true
allowHostIPC: true
allowHostNetwork: true
allowHostPID: true
allowHostPorts: true
allowPrivilegedContainer: true
allowedCapabilities: <b class="conum">(1)</b>
- '*'
apiVersion: v1
defaultAddCapabilities: [] <b class="conum">(2)</b>
fsGroup: <b class="conum">(3)</b>
  type: RunAsAny
groups: <b class="conum">(4)</b>
- system:cluster-admins
- system:nodes
kind: SecurityContextConstraints
metadata:
  annotations:
    kubernetes.io/description: 'privileged allows access to all privileged and host
      features and the ability to run as any user, any group, any fsGroup, and with
      any SELinux context.  WARNING: this is the most relaxed SCC and should be used
      only for cluster administration. Grant with caution.'
  creationTimestamp: null
  name: privileged
priority: null
readOnlyRootFilesystem: false
requiredDropCapabilities: [] <b class="conum">(5)</b>
runAsUser: <b class="conum">(6)</b>
  type: RunAsAny
seLinuxContext: <b class="conum">(7)</b>
  type: RunAsAny
seccompProfiles:
- '*'
supplementalGroups: <b class="conum">(8)</b>
  type: RunAsAny
users: <b class="conum">(9)</b>
- system:serviceaccount:default:registry
- system:serviceaccount:default:router
- system:serviceaccount:openshift-infra:build-controller
volumes:
- '*'</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A list of capabilities that a pod can request. An empty list means
that none of capabilities can be requested while the special symbol <code><strong>*</strong></code>
allows any capabilities.</p>
</li>
<li>
<p>A list of additional capabilities that are added to any pod.</p>
</li>
<li>
<p>The <code>FSGroup</code> strategy, which dictates the allowable values for the
Security Context.</p>
</li>
<li>
<p>The groups that can access this SCC.</p>
</li>
<li>
<p>A list of capabilities that are be dropped from a pod.</p>
</li>
<li>
<p>The <code>runAsUser</code> strategy type, which dictates the allowable values for the
Security Context.</p>
</li>
<li>
<p>The <code>seLinuxContext</code> strategy type, which dictates the allowable values for
the Security Context.</p>
</li>
<li>
<p>The <code>supplementalGroups</code> strategy, which dictates the allowable supplemental
groups for the Security Context.</p>
</li>
<li>
<p>The users who can access this SCC.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>users</code> and <code>groups</code> fields on the SCC control which users can access the
SCC.
By default, cluster administrators, nodes, and the build controller are granted
access to the privileged SCC. All authenticated users are granted access to the
restricted SCC.</p>
</div>
<div class="listingblock">
<div class="title">Without explicit <code>runAsUser</code> setting</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Pod
metadata:
  name: security-context-demo
spec:
  securityContext: <b class="conum">(1)</b>
  containers:
  - name: sec-ctx-demo
    image: gcr.io/google-samples/node-hello:1.0</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>When a container or pod does not request a user ID under which it should be run,
the effective UID depends on the SCC that emits this pod. Because restricted SCC
is granted to all authenticated users by default, it will be available to all
users and service accounts and used in most cases. The restricted SCC uses
<code>MustRunAsRange</code> strategy for constraining and defaulting the possible values of
the <code>securityContext.runAsUser</code> field. The admission plug-in will look for the
<code>openshift.io/sa.scc.uid-range</code> annotation on the current project to populate
range fields, as it does not provide this range. In the end, a container will
have <code>runAsUser</code> equal to the first value of the range that is
hard to predict because every project has different ranges.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">With explicit <code>runAsUser</code> setting</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Pod
metadata:
  name: security-context-demo
spec:
  securityContext:
    runAsUser: 1000 <b class="conum">(1)</b>
  containers:
    - name: sec-ctx-demo
      image: gcr.io/google-samples/node-hello:1.0</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A container or pod that requests a specific user ID will be accepted by
OpenShift Enterprise only when a service account or a user is granted access to a SCC
that allows such a user ID. The SCC can allow arbitrary IDs, an ID that falls
into a range, or the exact user ID specific to the request.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This configuration is valid for SELinux, fsGroup, and Supplemental Groups.</p>
</div>
</div>
<div class="sect2">
<h3 id="security-context-constraints-creating-configuring-internal-oauth">Creating Security Context Constraints</h3>
<div class="paragraph">
<p>You can create a Security Context Constraint (SCC) by using the CLI.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must install the <code>oc</code> command line.</p>
</li>
<li>
<p>Your account must have <code>cluster-admin</code> privileges to create SCCs.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Define the SCC in a JSON or YAML file:</p>
<div class="listingblock">
<div class="title">Security Context Constraint Object Definition</div>
<div class="content">
<pre class="nowrap">kind: SecurityContextConstraints
apiVersion: v1
metadata:
  name: scc-admin
allowPrivilegedContainer: true
runAsUser:
  type: RunAsAny
seLinuxContext:
  type: RunAsAny
fsGroup:
  type: RunAsAny
supplementalGroups:
  type: RunAsAny
users:
- my-admin-user
groups:
- my-admin-group</pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, you can add drop capabilities to an SCC by setting the
<code><strong>requiredDropCapabilities</strong></code> field with the desired values. Any specified
capabilities will be dropped from the container. For example, to create an SCC
with the <code><strong>KILL</strong></code>, <code><strong>MKNOD</strong></code>, and <code><strong>SYS_CHROOT</strong></code> required drop capabilities, add
the following to the SCC object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">requiredDropCapabilities:
- KILL
- MKNOD
- SYS_CHROOT</pre>
</div>
</div>
<div class="paragraph">
<p>You can see the list of possible values in the
<a href="https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities">Docker
documentation</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Because capabilities are passed to the Docker, you can use a special <code>ALL</code> value
to drop all possible capabilities.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Then, run <code>oc create</code> passing the file to create it:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create -f scc_admin.yaml
securitycontextconstraints "scc-admin" created</pre>
</div>
</div>
</li>
<li>
<p>Verify that the SCC was created:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get scc scc-admin
NAME        PRIV      CAPS      SELINUX    RUNASUSER   FSGROUP    SUPGROUP   PRIORITY   READONLYROOTFS   VOLUMES
scc-admin   true      []        RunAsAny   RunAsAny    RunAsAny   RunAsAny   &lt;none&gt;     false            [awsElasticBlockStore azureDisk azureFile cephFS cinder configMap downwardAPI emptyDir fc flexVolume flocker gcePersistentDisk gitRepo glusterfs iscsi nfs persistentVolumeClaim photonPersistentDisk quobyte rbd secret vsphere]</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="role-based-access-to-ssc-configuring-internal-oauth">Role-based access to Security Context Constraints</h3>
<div class="paragraph">
<p>You can specify SCCs as resources that are handled by RBAC. This allows
you to scope access to your SCCs to a certain project or to the entire
cluster. Assigning users, groups, or service accounts directly to an
SCC retains cluster-wide scope.</p>
</div>
<div class="paragraph">
<p>To include access to SCCs for your role, specify the <code>scc</code> resource
when creating a role.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create role &lt;role-name&gt; --verb=use --resource=scc --resource-name=&lt;scc-name&gt; -n &lt;namespace&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following role definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
...
  name: role-name <b class="conum">(1)</b>
  namespace: namespace <b class="conum">(2)</b>
...
rules:
- apiGroups:
  - security.openshift.io <b class="conum">(3)</b>
  resourceNames:
  - scc-name <b class="conum">(4)</b>
  resources:
  - securitycontextconstraints <b class="conum">(5)</b>
  verbs: <b class="conum">(6)</b>
  - use</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The role&#8217;s name.</p>
</li>
<li>
<p>Namespace of the defined role. Defaults to <code>default</code> if not specified.</p>
</li>
<li>
<p>The API group that includes the SecurityContextConstraint resource.
Automatically defined when <code>scc</code> is specified as a resource.</p>
</li>
<li>
<p>An example name for an SCC you want to have access.</p>
</li>
<li>
<p>Name of the resource group that allows users to specify SCC names in
the <code>resourceNames</code> field.</p>
</li>
<li>
<p>A list of verbs to apply to the role.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A local or cluster role with such a rule allows the subjects that are
bound to it with a RoleBinding or a ClusterRoleBinding to use the
user-defined SCC called <code>scc-name</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Because RBAC is designed to prevent escalation, even project administrators
will be unable to grant access to an SCC. By defualt, they are not
allowed to use the verb <code>use</code> on SCC resources, including the
<code>restricted</code> SCC.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="security-context-constraints-command-reference-configuring-internal-oauth">Security Context Constraints reference commands</h3>
<div class="paragraph">
<p>You can manage SCCs in your instance as normal API objects using the CLI.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You must have <code>cluster-admin</code> privileges to manage SCCs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Do not modify the default SCCs. Customizing the default SCCs can lead to issues
when upgrading. Instead, create new SCCs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="listing-security-context-constraints-configuring-internal-oauth">Listing SCCs</h4>
<div class="paragraph">
<p>To get a current list of SCCs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get scc

NAME               PRIV    CAPS   SELINUX     RUNASUSER          FSGROUP     SUPGROUP    PRIORITY   READONLYROOTFS   VOLUMES
anyuid             false   []     MustRunAs   RunAsAny           RunAsAny    RunAsAny    10         false            [configMap downwardAPI emptyDir persistentVolumeClaim projected secret]
hostaccess         false   []     MustRunAs   MustRunAsRange     MustRunAs   RunAsAny    &lt;none&gt;     false            [configMap downwardAPI emptyDir hostPath persistentVolumeClaim projected secret]
hostmount-anyuid   false   []     MustRunAs   RunAsAny           RunAsAny    RunAsAny    &lt;none&gt;     false            [configMap downwardAPI emptyDir hostPath nfs persistentVolumeClaim projected secret]
hostnetwork        false   []     MustRunAs   MustRunAsRange     MustRunAs   MustRunAs   &lt;none&gt;     false            [configMap downwardAPI emptyDir persistentVolumeClaim projected secret]
node-exporter      false   []     RunAsAny    RunAsAny           RunAsAny    RunAsAny    &lt;none&gt;     false            [*]
nonroot            false   []     MustRunAs   MustRunAsNonRoot   RunAsAny    RunAsAny    &lt;none&gt;     false            [configMap downwardAPI emptyDir persistentVolumeClaim projected secret]
privileged         true    [*]    RunAsAny    RunAsAny           RunAsAny    RunAsAny    &lt;none&gt;     false            [*]
restricted         false   []     MustRunAs   MustRunAsRange     MustRunAs   RunAsAny    &lt;none&gt;     false            [configMap downwardAPI emptyDir persistentVolumeClaim projected secret]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="examining-a-security-context-constraints-object-configuring-internal-oauth">Examining an SCC</h4>
<div class="paragraph">
<p>To examine a particular SCC, use <code>oc get</code>, <code>oc describe</code>, or <code>oc
edit</code>. For example, to examine the <code>restricted</code> SCC:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc describe scc restricted
Name:					restricted
Priority:				&lt;none&gt;
Access:
  Users:				&lt;none&gt;
  Groups:				system:authenticated
Settings:
  Allow Privileged:			false
  Default Add Capabilities:		&lt;none&gt;
  Required Drop Capabilities:		KILL,MKNOD,SYS_CHROOT,SETUID,SETGID
  Allowed Capabilities:			&lt;none&gt;
  Allowed Seccomp Profiles:		&lt;none&gt;
  Allowed Volume Types:			configMap,downwardAPI,emptyDir,persistentVolumeClaim,projected,secret
  Allow Host Network:			false
  Allow Host Ports:			false
  Allow Host PID:			false
  Allow Host IPC:			false
  Read Only Root Filesystem:		false
  Run As User Strategy: MustRunAsRange
    UID:				&lt;none&gt;
    UID Range Min:			&lt;none&gt;
    UID Range Max:			&lt;none&gt;
  SELinux Context Strategy: MustRunAs
    User:				&lt;none&gt;
    Role:				&lt;none&gt;
    Type:				&lt;none&gt;
    Level:				&lt;none&gt;
  FSGroup Strategy: MustRunAs
    Ranges:				&lt;none&gt;
  Supplemental Groups Strategy: RunAsAny
    Ranges:				&lt;none&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>To preserve customized SCCs during upgrades, do not edit settings on
the default SCCs.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="deleting-security-context-constraints-configuring-internal-oauth">Deleting an SCC</h4>
<div class="paragraph">
<p>To delete an SCC:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc delete scc &lt;scc_name&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you delete a default SCC, it will regenerate when you restart the cluster.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="updating-security-context-constraints-configuring-internal-oauth">Updating an SCC</h4>
<div class="paragraph">
<p>To update an existing SCC:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc edit scc &lt;scc_name&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>To preserve customized SCCs during upgrades, do not edit settings on
the default SCCs.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="impersonating-the-system:admin-user">Impersonating the <code>system:admin</code> user</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="authentication-api-impersonation-impersonating-system-admin">API impersonation</h3>
<div class="paragraph">
<p>A request to the OpenShift Enterprise API can include an <code>Impersonate-User</code> header,
which indicates that the requester wants the request handled as though
it came from the specified user.</p>
</div>
<div class="paragraph">
<p>Before User A can impersonate User B, User A is authenticated.
Then, an authorization check occurs to ensure that User A is allowed to
impersonate the user named User B. If User A is requesting to impersonate a
service account, <code>system:serviceaccount:namespace:name</code>, OpenShift Enterprise confirms
that User A can impersonate the <code>serviceaccount</code> named <code>name</code> in
<code>namespace</code>. If the check fails, the request fails with a 403 (Forbidden) error
code.</p>
</div>
<div class="paragraph">
<p>By default, project administrators and editors can impersonate
service accounts in their namespace.
The <code>sudoers</code> role allows a user to
impersonate <code>system:admin</code>, which in turn has cluster administrator permissions.
The ability to impersonate <code>system:admin</code> grants some protection against typos,
but not security, for someone
administering the cluster. For example, running <code>oc delete nodes --all</code> fails,
but running <code>oc delete nodes --all --as=system:admin</code> succeeds.</p>
</div>
</div>
<div class="sect2">
<h3 id="impersonation-system-admin-user-impersonating-system-admin">Impersonating the <code>system:admin</code> user</h3>
<div class="paragraph">
<p>You can grant a user permission to impersonate <code>system:admin</code>, which grants them
cluster administrator permissions.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To grant a user permission to impersonate <code>system:admin</code>, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create clusterrolebinding &lt;any_valid_name&gt; --clusterrole=sudoer --user=&lt;username&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-project-as-another-user">Creating a project as another user</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Impersonation allows you to create a project as a different user.</p>
</div>
<div class="sect2">
<h3 id="authentication-api-impersonation-creating-project-other-user">API impersonation</h3>
<div class="paragraph">
<p>A request to the OpenShift Enterprise API can include an <code>Impersonate-User</code> header,
which indicates that the requester wants the request handled as though
it came from the specified user.</p>
</div>
<div class="paragraph">
<p>Before User A can impersonate User B, User A is authenticated.
Then, an authorization check occurs to ensure that User A is allowed to
impersonate the user named User B. If User A is requesting to impersonate a
service account, <code>system:serviceaccount:namespace:name</code>, OpenShift Enterprise confirms
that User A can impersonate the <code>serviceaccount</code> named <code>name</code> in
<code>namespace</code>. If the check fails, the request fails with a 403 (Forbidden) error
code.</p>
</div>
<div class="paragraph">
<p>By default, project administrators and editors can impersonate
service accounts in their namespace.
The <code>sudoers</code> role allows a user to
impersonate <code>system:admin</code>, which in turn has cluster administrator permissions.
The ability to impersonate <code>system:admin</code> grants some protection against typos,
but not security, for someone
administering the cluster. For example, running <code>oc delete nodes --all</code> fails,
but running <code>oc delete nodes --all --as=system:admin</code> succeeds.</p>
</div>
</div>
<div class="sect2">
<h3 id="impersonation-project-creation-creating-project-other-user">Impersonating a user when you create a project</h3>
<div class="paragraph">
<p>You can impersonate a different user when you create a project request. Because
<code>system:authenticated:oauth</code> is the only bootstrap group that can
create project requests, you must impersonate that group.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To create a project request on behalf of a different user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc new-project &lt;project&gt; --as=&lt;user&gt; \
--as-group=system:authenticated --as-group=system:authenticated:oauth</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-04-12 23:56:12 UTC
</div>
</div>
</body>
</html>